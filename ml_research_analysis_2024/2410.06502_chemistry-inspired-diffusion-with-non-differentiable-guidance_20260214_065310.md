---
ver: rpa2
title: Chemistry-Inspired Diffusion with Non-Differentiable Guidance
arxiv_id: '2410.06502'
source_url: https://arxiv.org/abs/2410.06502
tags:
- guidance
- molecules
- optimization
- geoldm
- diffusion
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of generating stable molecular
  geometries using diffusion models, particularly when labeled data is scarce. The
  proposed method, CHEM GUIDE, leverages domain knowledge from quantum chemistry (specifically
  the GFN2-xTB method) as a non-differentiable oracle to guide the diffusion process.
---

# Chemistry-Inspired Diffusion with Non-Differentiable Guidance

## Quick Facts
- arXiv ID: 2410.06502
- Source URL: https://arxiv.org/abs/2410.06502
- Reference count: 40
- Primary result: CHEM GUIDE improves molecular stability by reducing atomic forces and enhancing validity using non-differentiable quantum chemistry guidance

## Executive Summary
This paper introduces CHEM GUIDE, a novel approach for generating stable molecular geometries using diffusion models when labeled data is scarce. The method leverages domain knowledge from quantum chemistry through the GFN2-xTB method as a non-differentiable oracle, using zeroth-order optimization to estimate gradients analytically. CHEM GUIDE significantly improves molecular stability metrics while maintaining compatibility with both explicit and implicit guidance in diffusion models, enabling joint optimization of molecular properties and stability.

## Method Summary
CHEM GUIDE addresses the challenge of generating stable molecular geometries by using non-differentiable guidance from quantum chemistry methods. Rather than relying on neural networks, the approach employs zeroth-order optimization techniques to estimate gradients analytically, allowing the diffusion process to be steered toward desired molecular properties and stability. The method uses the GFN2-xTB method as a black-box oracle to evaluate molecular stability and guide the generation process. CHEM GUIDE is compatible with both explicit and implicit guidance frameworks in diffusion models, enabling joint optimization of multiple molecular properties beyond just stability, including polarizability, dipole moment, and energy gaps.

## Key Results
- Significant improvement in molecular stability through reduction of atomic forces
- Enhanced validity and stability of generated molecules, bringing them closer to ground state
- Effective generalization to molecular optimization tasks beyond stability
- Compatibility with both explicit and implicit guidance in diffusion models
- Successful joint optimization of molecular properties and stability

## Why This Works (Mechanism)
CHEM GUIDE works by bridging the gap between diffusion models and domain-specific knowledge through non-differentiable guidance. The method exploits the fact that certain domain knowledge (like quantum chemistry stability criteria) cannot be easily expressed as differentiable loss functions. By using zeroth-order optimization to estimate gradients from the non-differentiable GFN2-xTB oracle, CHEM GUIDE can effectively guide the diffusion process toward chemically stable configurations without requiring labeled training data. The approach leverages the computational efficiency of GFN2-xTB while maintaining the generative capabilities of diffusion models.

## Foundational Learning
- **Diffusion Models**: Why needed - Core generative framework for molecular geometry generation. Quick check - Understand how noise is gradually removed from molecular structures during sampling.
- **Zeroth-Order Optimization**: Why needed - Enables gradient estimation without differentiable oracle functions. Quick check - Verify ability to estimate gradients from function evaluations only.
- **GFN2-xTB Method**: Why needed - Provides computationally efficient quantum chemistry calculations for molecular stability. Quick check - Confirm accuracy of atomic force calculations for small molecules.
- **Molecular Stability Metrics**: Why needed - Quantifies success of generated molecular geometries. Quick check - Understand relationship between atomic forces and chemical stability.
- **Implicit vs Explicit Guidance**: Why needed - Determines how guidance is integrated into diffusion sampling. Quick check - Distinguish between classifier-free guidance and direct property optimization.

## Architecture Onboarding

**Component Map**: Diffusion Model -> CHEM GUIDE Oracle -> Zeroth-Order Optimizer -> Property Evaluation

**Critical Path**: 
1. Diffusion model generates molecular geometries
2. CHEM GUIDE queries GFN2-xTB oracle for stability metrics
3. Zeroth-order optimizer estimates gradients from oracle responses
4. Gradients guide diffusion process toward stable configurations
5. Final molecules evaluated for stability and validity

**Design Tradeoffs**:
- Computational efficiency vs accuracy (GFN2-xTB vs DFT)
- Black-box oracle vs differentiable guidance
- Gradient estimation accuracy vs sample efficiency
- Property optimization vs molecular diversity

**Failure Signatures**:
- Poor molecular validity despite stability optimization
- Converged to local minima with suboptimal properties
- Inefficient gradient estimation requiring excessive oracle queries
- Loss of molecular diversity during optimization

**First Experiments**:
1. Validate zeroth-order gradient estimation accuracy on simple molecular properties
2. Test compatibility with different diffusion model architectures
3. Benchmark stability improvements against baseline diffusion generation

## Open Questions the Paper Calls Out
None

## Limitations
- Reliance on GFN2-xTB accuracy may limit comparison to more rigorous quantum mechanical methods
- Zeroth-order optimization may face challenges in high-dimensional molecular spaces
- Performance in generating diverse molecular scaffolds beyond stability optimization needs validation
- Scalability to very large molecular systems (>100 atoms) remains uncertain

## Confidence

High confidence:
- Core methodology of using non-differentiable domain knowledge for guiding diffusion models
- Reported improvements in molecular stability metrics

Medium confidence:
- Claims regarding compatibility with both explicit and implicit guidance
- Effectiveness of joint optimization for multiple properties

Low confidence:
- Scalability to very large molecular systems
- Ability to maintain diversity while optimizing for specific properties

## Next Checks
1. Benchmark CHEM GUIDE against more computationally expensive but accurate quantum mechanical methods (e.g., DFT) to assess quality of generated molecular geometries
2. Test method's ability to generate diverse molecular scaffolds while optimizing for multiple properties simultaneously, particularly in underexplored chemical spaces
3. Evaluate scalability of zeroth-order optimization approach to large molecular systems (>100 atoms) and compare efficiency with gradient-based alternatives