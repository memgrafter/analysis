---
ver: rpa2
title: 'Retrieval-Retro: Retrieval-based Inorganic Retrosynthesis with Expert Knowledge'
arxiv_id: '2410.21341'
source_url: https://arxiv.org/abs/2410.21341
tags:
- material
- materials
- precursor
- reference
- information
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: "This paper introduces Retrieval-Retro, a novel approach for inorganic\
  \ retrosynthesis planning that leverages retrieval of reference materials to predict\
  \ possible precursor sets for target materials. The method uses two complementary\
  \ retrievers\u2014a Masked Precursor Completion (MPC) retriever and a Neural Reaction\
  \ Energy (NRE) retriever\u2014to identify relevant reference materials from a knowledge\
  \ base."
---

# Retrieval-Retro: Retrieval-based Inorganic Retrosynthesis with Expert Knowledge

## Quick Facts
- **arXiv ID**: 2410.21341
- **Source URL**: https://arxiv.org/abs/2410.21341
- **Reference count**: 40
- **Primary result**: Retrieval-Retro outperforms baseline methods in inorganic retrosynthesis, particularly in realistic year-split settings, demonstrating ability to discover novel synthesis pathways

## Executive Summary
This paper introduces Retrieval-Retro, a novel approach for inorganic retrosynthesis planning that leverages retrieval of reference materials to predict possible precursor sets for target materials. The method uses two complementary retrievers—a Masked Precursor Completion (MPC) retriever and a Neural Reaction Energy (NRE) retriever—to identify relevant reference materials from a knowledge base. Unlike prior approaches that directly use precursor information from references, Retrieval-Retro implicitly extracts this information using attention mechanisms, enabling the discovery of novel synthesis recipes. The NRE retriever incorporates thermodynamic driving forces (ΔG) to identify the most feasible precursor sets. Experiments show Retrieval-Retro outperforms baseline methods, particularly in realistic year-split settings, and demonstrates strong capability in discovering new synthetic pathways for inorganic materials.

## Method Summary
Retrieval-Retro addresses inorganic retrosynthesis planning by retrieving reference materials from a knowledge base and implicitly extracting precursor information through attention mechanisms rather than directly using precursor sets. The approach employs two retrievers: an MPC retriever that finds reference materials with similar precursor patterns, and an NRE retriever that identifies materials with thermodynamically favorable precursor sets based on formation energy calculations. The retrieved reference materials are processed through self-attention and cross-attention layers to enhance their representations and extract relevant precursor information. A classifier then predicts the precursor set for the target material. The model is trained using BCE loss on a dataset of 33,343 synthesis recipes from 24,304 papers, with evaluation conducted under both subset and year-split settings to assess performance on novel synthesis patterns.

## Key Results
- Retrieval-Retro achieves higher Top-K accuracy than baseline methods, especially on "new case" materials not similar to training data
- Year-split evaluation shows significant performance enhancement over baselines, proving efficacy in real-world inorganic material synthesis
- The combination of MPC and NRE retrievers outperforms using either retriever alone, demonstrating the value of complementary retrieval strategies

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Implicit precursor extraction through attention layers enables discovery of novel synthesis recipes beyond reference material precursors.
- Mechanism: Instead of directly using precursor information from retrieved reference materials, the model uses self-attention and cross-attention layers to enhance and extract precursor information from the representations of reference materials. This allows the model to learn favorable synthesis recipes by selectively attending to information from various reference materials without being constrained to their explicit precursor sets.
- Core assumption: The representation of reference materials contains sufficient information about their synthesis pathways that can be extracted through attention mechanisms.
- Evidence anchors:
  - [abstract] "Instead of directly employing the precursor information of reference materials, we propose implicitly extracting it with various attention layers, which enables the model to learn novel synthesis recipes more effectively."
  - [section 3.2] "Rather than the precursor set of the reference materials, the model effectively accesses the synthetic recipes of reference materials without explicitly using precursor information, thus enabling the discovery of novel synthetic recipes for the target material."
- Break condition: If the reference material representations don't contain adequate synthesis pathway information, or if the attention mechanisms fail to extract this information effectively.

### Mechanism 2
- Claim: The NRE retriever complements the MPC retriever by providing thermodynamically feasible precursor sets independent of existing synthesis patterns.
- Mechanism: The NRE retriever uses formation energy data to identify reference materials whose precursor sets have favorable thermodynamic driving forces (negative ΔG) for synthesizing the target material. This provides complementary information to the MPC retriever, which relies on precursor similarity patterns in the literature.
- Core assumption: Thermodynamic feasibility (negative ΔG) is a strong indicator of synthesis success and can be predicted from composition alone.
- Evidence anchors:
  - [abstract] "Moreover, during retrieval, we consider the thermodynamic relationship between target material and precursors, which is essential domain expertise in identifying the most probable precursor set among various options."
  - [section 3.1] "the greater (more negative) thermodynamic driving force (∆G) between the target material and the precursor set, the more feasible it is to actually form the target material through the precursor set"
- Break condition: If thermodynamic predictions from composition are inaccurate, or if thermodynamic feasibility alone is insufficient for successful synthesis.

### Mechanism 3
- Claim: Year-split evaluation demonstrates realistic performance and ability to discover truly novel synthesis pathways.
- Mechanism: By training on materials from papers published up to 2014 and testing on materials from 2017-2020, the model must generalize to synthesis patterns not present in the training data, validating its ability to discover novel recipes.
- Core assumption: Materials synthesized in later years often use novel synthesis pathways not present in earlier literature.
- Evidence anchors:
  - [section 4.1] "under the year split setting, the training set includes synthesis recipes from papers published up to 2014, the validation set includes recipes from papers published in 2015 and 2016, and the test set includes recipes from papers published between 2017 and 2020"
  - [section 4.2] "There is a significant performance enhancement over baseline methods in the year split setting... proving Retrieval-Retro's efficacy in real-world inorganic material synthesis processes"
- Break condition: If synthesis patterns don't evolve over time, or if the year split doesn't create sufficient novelty in the test set.

## Foundational Learning

- Concept: Composition-based representation learning for inorganic materials
  - Why needed here: Inorganic materials have complex structures that are computationally expensive to represent directly, so composition vectors and composition graphs are used instead
  - Quick check question: Why can't we use molecular graphs like in organic retrosynthesis for inorganic materials?

- Concept: Attention mechanisms for information extraction
  - Why needed here: To implicitly extract synthesis pathway information from reference material representations without directly using their precursor sets
  - Quick check question: How do self-attention and cross-attention layers work together to extract precursor information?

- Concept: Thermodynamic driving forces in synthesis
  - Why needed here: To identify which precursor sets are most likely to successfully synthesize the target material based on formation energy considerations
  - Quick check question: What does a negative ΔG value indicate about the feasibility of a synthesis reaction?

## Architecture Onboarding

- Component map: Target material encoder → MPC retriever → NRE retriever → Reference enhancing (self-attention) → Precursor extraction (cross-attention) → Classifier
- Critical path: Composition graph → GNN encoding → Retrieval (MPC + NRE) → Attention layers → Precursor prediction
- Design tradeoffs: Explicit precursor use (simple but limited to known recipes) vs. implicit extraction (more flexible but requires effective attention mechanisms)
- Failure signatures: 
  - Low performance on "new case" materials indicates inability to discover novel synthesis pathways
  - Poor performance with random retrieval indicates importance of retrieval quality
  - Training instability might indicate issues with attention layer implementation
- First 3 experiments:
  1. Compare implicit vs. explicit precursor extraction on subset vs. new cases
  2. Test with only MPC retriever vs. only NRE retriever vs. both retrievers
  3. Evaluate performance across different GNN backbone architectures

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does Retrieval-Retro's performance scale with the size of the knowledge base, and what are the diminishing returns or potential saturation points?
- Basis in paper: [explicit] The paper mentions that larger knowledge bases lead to more accurate predictions, but does not explore the upper limits or saturation points.
- Why unresolved: The study only explores a limited range of knowledge base sizes, leaving open questions about scalability and efficiency.
- What evidence would resolve it: Experiments testing performance with significantly larger knowledge bases and analysis of the point at which additional data no longer improves results.

### Open Question 2
- Question: Can Retrieval-Retro's implicit precursor extraction method be effectively applied to other domains beyond inorganic retrosynthesis, such as organic synthesis or materials property prediction?
- Basis in paper: [inferred] The method relies on attention mechanisms and retrieval of reference materials, which are general techniques applicable to various domains.
- Why unresolved: The paper focuses specifically on inorganic retrosynthesis and does not explore generalization to other domains.
- What evidence would resolve it: Experiments applying Retrieval-Retro's core components to organic synthesis or materials property prediction tasks.

### Open Question 3
- Question: What is the impact of including additional thermodynamic variables (beyond Gibbs free energy) such as temperature, pressure, and reaction time on Retrieval-Retro's performance?
- Basis in paper: [explicit] The paper mentions these factors as limitations in the broader impacts section but does not explore their incorporation.
- Why unresolved: The current model only considers formation energy at standard conditions, ignoring synthesis parameters that affect reaction feasibility.
- What evidence would resolve it: Experiments incorporating additional thermodynamic variables into the NRE retriever and comparing performance with the current model.

## Limitations
- Lack of detailed architectural specifications, particularly regarding the GNN backbone configuration and attention layer parameters
- Year-split evaluation may not fully capture the model's ability to discover genuinely novel synthesis pathways if underlying synthesis principles remain relatively constant over time
- Thermodynamic feasibility assumption (negative ΔG indicating successful synthesis) may not always hold true due to kinetic barriers and other practical considerations

## Confidence
- **High Confidence**: The effectiveness of implicit precursor extraction through attention mechanisms (supported by direct statements and experimental validation)
- **Medium Confidence**: The complementarity of MPC and NRE retrievers (experimentally shown but mechanism could be explored further)
- **Medium Confidence**: Year-split evaluation demonstrating realistic performance (valid approach but limited by potential temporal consistency in synthesis patterns)

## Next Checks
1. **Cross-dataset validation**: Test Retrieval-Retro on inorganic retrosynthesis datasets from different sources to verify generalizability beyond the original dataset.
2. **Kinetic barrier analysis**: Incorporate kinetic factors alongside thermodynamic driving forces to assess whether this improves precursor set prediction accuracy.
3. **Attention visualization study**: Perform attention visualization on the self-attention and cross-attention layers to empirically verify that the model is indeed extracting meaningful synthesis pathway information from reference material representations.