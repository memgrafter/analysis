---
ver: rpa2
title: 'FreqMark: Frequency-Based Watermark for Sentence-Level Detection of LLM-Generated
  Text'
arxiv_id: '2410.10876'
source_url: https://arxiv.org/abs/2410.10876
tags:
- text
- watermark
- token
- detection
- llm-generated
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper addresses the problem of detecting LLM-generated text
  in mixed-text scenarios, where human-authored and AI-generated content are combined.
  The authors propose FreqMark, a novel watermarking technique that embeds detectable
  frequency-based watermarks in LLM-generated text during the token sampling process.
---

# FreqMark: Frequency-Based Watermark for Sentence-Level Detection of LLM-Generated Text

## Quick Facts
- arXiv ID: 2410.10876
- Source URL: https://arxiv.org/abs/2410.10876
- Authors: Zhenyu Xu; Kun Zhang; Victor S. Sheng
- Reference count: 24
- Primary result: FreqMark achieves AUC improvement of up to 0.98 and F1 score of 0.95 in sentence-level detection

## Executive Summary
This paper addresses the challenge of detecting LLM-generated text in mixed-text scenarios where human-authored and AI-generated content are combined. The authors propose FreqMark, a novel watermarking technique that embeds detectable frequency-based watermarks in LLM-generated text during the token sampling process. The method leverages periodic signals to guide token selection, creating a watermark that can be detected using Short-Time Fourier Transform (STFT) analysis. This approach enables precise sentence-level identification of LLM-generated content while maintaining compatibility with common token sampling strategies.

## Method Summary
FreqMark embeds watermarks by guiding token selection based on periodic signals during the LLM sampling process. Specifically, token ranks are selected according to predefined amplitude values from a periodic guiding signal, creating a detectable frequency pattern in the generated text. The watermark is detected using STFT analysis on the retrieved sequence of rank information. The method is compatible with common token sampling strategies like temperature scaling and top-k sampling, though optimal performance is achieved with temperature=0 to ensure precise watermark embedding. The detection process involves reconstructing logits distributions from the generated text, extracting rank sequences, and applying STFT analysis to identify watermark frequency patterns.

## Key Results
- Achieves AUC improvement of up to 0.98 in sample-level detection
- Achieves F1 score of 0.95 in sentence-level detection
- Maintains high detectability even under adversarial attacks up to 30-40% token modification

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Periodic signal embedding creates detectable frequency patterns in LLM token sequences
- Mechanism: The method embeds watermarks by guiding token selection based on periodic signals during the LLM sampling process. Specifically, token ranks are selected according to predefined amplitude values from a periodic guiding signal, creating a detectable frequency pattern in the generated text.
- Core assumption: The periodic signal can be reliably reconstructed from the generated text's logits distribution, even after the text generation process.
- Evidence anchors:
  - [abstract] "The method leverages periodic signals to guide token selection, creating a watermark that can be detected with Short-Time Fourier Transform (STFT) analysis."
  - [section] "The rank of token wt, denoted R(wt), is selected such that: R(wt) = a(t mod k) where k is the period of the guiding signal and t is the token position."
  - [corpus] Weak evidence - no direct mention of periodic signal reconstruction in related papers.
- Break condition: If the sampling process mixes with other methods like beam search or nucleus sampling, the accuracy of detection may decrease as the reconstructed logits may no longer align with the original.

### Mechanism 2
- Claim: STFT analysis enables fine-grained, sentence-level detection of LLM-generated content
- Mechanism: Short-Time Fourier Transform is applied to the retrieved sequence of rank information from the watermark signal. The sliding window approach allows for sentence-level detection by analyzing frequency components within individual segments of text.
- Core assumption: The watermark signal is sufficiently strong and consistent across the text to be detectable through frequency analysis.
- Evidence anchors:
  - [abstract] "The method leverages periodic signals to guide token selection, creating a watermark that can be detected with Short-Time Fourier Transform (STFT) analysis."
  - [section] "To detect the watermark embedded in the generated text, we employ STFT analysis. This signal processing technique enables the examination of the frequency characteristics of the rank sequence extracted from the text."
  - [corpus] Weak evidence - no direct mention of STFT analysis in related papers.
- Break condition: If the text undergoes aggressive paraphrasing or heavy token substitutions, the watermark may become less distinguishable, though the results show it remains highly detectable up to about 30-40% token modification.

### Mechanism 3
- Claim: Compatibility with common token sampling strategies while maintaining watermark detectability
- Mechanism: The watermark embedding process is compatible with common token sampling strategies such as temperature scaling and top-k sampling. The periodic guiding signal dictates which rank to select for the next token, allowing the watermark to be embedded while maintaining text quality.
- Core assumption: The LLM sampling process can be controlled to follow the periodic signal precisely without mixing with other sampling methods.
- Evidence anchors:
  - [section] "The watermark embedding process is compatible with common token sampling strategies, such as temperature scaling and top-k sampling."
  - [section] "We chose a temperature of 0 to eliminate randomness, ensuring the watermark embedding follows the periodic signal precisely. Although compatible with sampling strategies like top-k and temperature scaling, we avoid mixing methods to maintain accurate watermark evaluation."
  - [corpus] Weak evidence - no direct mention of compatibility with sampling strategies in related papers.
- Break condition: Mixing sampling methods with the watermarking process may decrease detection accuracy as the reconstructed logits may no longer align with the original.

## Foundational Learning

- Concept: Token sampling and probability distributions in LLMs
  - Why needed here: Understanding how LLMs generate text by predicting tokens based on preceding context and computing probability distributions is crucial for grasping how watermarks can be embedded during this process.
  - Quick check question: How does an LLM determine the probability distribution for the next token given a sequence of previous tokens?

- Concept: Signal processing and Fourier analysis
  - Why needed here: STFT analysis is used to detect the embedded watermark by examining the frequency characteristics of the rank sequence extracted from the text.
  - Quick check question: What is the purpose of using Short-Time Fourier Transform in watermark detection?

- Concept: Adversarial attacks on text generation
  - Why needed here: Understanding various attack scenarios such as paraphrasing and token substitution helps in evaluating the robustness of the watermarking technique.
  - Quick check question: How might paraphrasing or token substitution affect the detectability of an embedded watermark?

## Architecture Onboarding

- Component map: Token Sampling Module -> Logits Reconstruction Module -> STFT Analysis Module -> Evaluation Module
- Critical path:
  1. Generate text using LLM with periodic signal-guided token selection
  2. Reconstruct logits distribution from the generated text
  3. Extract rank sequence and apply STFT analysis
  4. Detect watermark presence and evaluate accuracy
- Design tradeoffs:
  - Frequency pattern strength vs. text quality: Higher amplitude values in the periodic signal increase watermark detectability but may affect text coherence
  - Sampling strategy compatibility vs. watermark robustness: Using common sampling strategies maintains text quality but may reduce watermark strength compared to more controlled methods
- Failure signatures:
  - Low AUC scores indicate weak watermark detectability
  - High FPR or FNR suggest issues with distinguishing between watermarked and non-watermarked text
  - Poor performance on mixed-text scenarios indicates limitations in fine-grained detection
- First 3 experiments:
  1. Generate a balanced dataset of pure human-written and pure watermarked text to evaluate basic watermark performance
  2. Create a mixed-content dataset with interspersed human-written and LLM-generated segments to test sentence-level detection
  3. Apply various attack scenarios (paraphrasing, token substitution, translation) to assess watermark robustness under adversarial conditions

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does FreqMark's performance degrade with aggressive paraphrasing or highly structured texts with limited variability?
- Basis in paper: [explicit] The authors mention that in cases of extreme text transformations, such as aggressive paraphrasing, heavy token substitutions, or highly structured texts with limited variability, the watermark may become less distinguishable.
- Why unresolved: The paper only briefly mentions this limitation without providing specific data or thresholds for performance degradation under such conditions.
- What evidence would resolve it: Experiments measuring FreqMark's detection accuracy and AUC on texts subjected to varying degrees of aggressive paraphrasing or highly structured content, with clear performance metrics at each level of transformation.

### Open Question 2
- Question: Can FreqMark be effectively combined with other LLM-generated text detection methods to improve overall accuracy?
- Basis in paper: [inferred] The paper compares FreqMark against several baselines but does not explore potential synergies or combinations with other detection methods.
- Why unresolved: The authors only evaluate FreqMark in isolation and do not investigate how it might complement or enhance other detection techniques.
- What evidence would resolve it: Experimental results comparing ensemble methods that combine FreqMark with other detection approaches, showing improvements in accuracy, robustness, or false positive/negative rates.

### Open Question 3
- Question: How does the watermark detection performance vary across different LLM architectures beyond GPT-3.5 and Llama-2?
- Basis in paper: [explicit] The authors state that the method generalizes well across various LLM architectures but only test on GPT-3.5 and Llama-2.
- Why unresolved: The paper provides limited empirical evidence for the claim of broad compatibility across different LLM architectures.
- What evidence would resolve it: Comprehensive testing of FreqMark on a diverse range of LLM architectures, including both transformer-based and non-transformer models, with detailed performance metrics for each.

## Limitations
- Sampling strategy compatibility uncertainty: While claimed to be compatible with common strategies, optimal performance requires temperature=0, creating uncertainty about real-world applicability
- Short text detection constraints: The method shows limitations in detecting watermarks in very short text segments (less than 20 tokens)
- Adversarial robustness boundaries: Performance degrades significantly when paraphrasing exceeds 40% token modification

## Confidence

**High Confidence**: The core mechanism of using periodic signals for watermark embedding and STFT for detection is well-established and the evaluation results are clearly presented. The mathematical framework for rank selection and watermark detection is sound.

**Medium Confidence**: The performance claims are based on controlled experimental conditions with specific parameters (temperature=0, fixed window sizes). Real-world performance may vary depending on implementation details and varying text generation conditions.

**Low Confidence**: The exact implementation details of how the periodic signal guides token selection during sampling are not fully specified, which could affect reproducibility and real-world deployment.

## Next Checks
1. **Mixed Sampling Strategy Evaluation**: Test the watermark detection performance under varying temperature and top-k sampling parameters (e.g., temperature 0.5, top-k 40) to verify the claimed compatibility with common sampling strategies.

2. **Real-World Dataset Testing**: Evaluate the method on naturally occurring mixed-text scenarios from diverse sources, rather than the controlled mixed-realnewslike dataset, to assess practical deployment viability.

3. **Adaptive Window Size Analysis**: Implement and test an adaptive window size mechanism for STFT analysis to improve detection accuracy in variable-length text segments, particularly for short text detection scenarios.