---
ver: rpa2
title: Retrosynthesis prediction enhanced by in-silico reaction data augmentation
arxiv_id: '2402.00086'
source_url: https://arxiv.org/abs/2402.00086
tags:
- data
- in-silico
- reactions
- retrosynthesis
- retrowise
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the problem of data scarcity in ML-based retrosynthesis
  prediction. The proposed method, RetroWISE, generates in-silico reaction data by
  leveraging unpaired data (products or reactants) with a base model trained on real
  paired data.
---

# Retrosynthesis prediction enhanced by in-silico reaction data augmentation

## Quick Facts
- arXiv ID: 2402.00086
- Source URL: https://arxiv.org/abs/2402.00086
- Authors: Xu Zhang; Yiming Mo; Wenguan Wang; Yi Yang
- Reference count: 9
- Primary result: 8.6% improvement in top-1 accuracy on USPTO-50K test dataset

## Executive Summary
This paper addresses data scarcity in ML-based retrosynthesis prediction by introducing RetroWISE, a self-boosting framework that generates in-silico reaction data from unpaired products or reactants. The approach uses a base model trained on real paired data to create synthetic reactions, which are then filtered for chemical plausibility and diversity before augmenting the training set. Experimental results demonstrate that RetroWISE achieves state-of-the-art performance with an 8.6% improvement in top-1 accuracy on USPTO-50K, while particularly excelling at rare transformation predictions.

## Method Summary
RetroWISE operates through a three-stage process: first, a base forward synthesis and retrosynthesis model are trained on real paired reaction data; second, these base models generate in-silico reactions from unpaired products or reactants; third, a filter process with template matching and molecular similarity comparison selects high-quality synthetic reactions to augment the real paired data for retraining. The framework specifically targets the data scarcity problem in retrosynthesis prediction by leveraging both forward and reverse synthesis capabilities to create chemically plausible reactions that expand the model's exposure to diverse chemical transformations.

## Key Results
- Achieves 8.6% improvement in top-1 accuracy on USPTO-50K test dataset compared to state-of-the-art models
- Consistently improves prediction accuracy for rare transformations that traditional models struggle with
- Demonstrates effectiveness across multiple benchmark datasets including USPTO-MIT and USPTO-Full

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The model improves by leveraging unpaired data to generate in-silico reactions that augment real paired training data
- Mechanism: RetroWISE uses a base model trained on real paired data to generate synthetic reactions from unpaired reactants or products, then retrains a new model on the augmented dataset. This creates a self-boosting cycle where generated data improves the model, which in turn generates better data.
- Core assumption: The base model can generate chemically plausible reactions from unpaired data that are similar in quality to real reactions
- Evidence anchors:
  - [abstract] "RetroWISE, a self-boosting framework that employs a base model inferred from real paired data to perform in-silico reaction generation and augmentation using unpaired data"
  - [section] "Specifically, RetroWISE uses real paired data R = {(xn, yn)}n, where xn represents the product and yn denotes the corresponding reactant(s), to train a base forward synthesis model gy x and a base retrosynthesis model fx y as the preparation."
  - [corpus] Weak evidence - related papers focus on template-free approaches but don't explicitly discuss unpaired data augmentation
- Break condition: If the base model cannot generate chemically plausible reactions from unpaired data, the quality of in-silico reactions will be too low to improve model performance

### Mechanism 2
- Claim: The filter process improves in-silico reaction quality by ensuring chemical plausibility and diversity
- Mechanism: The filter uses template matching to ensure reactions follow known chemical patterns, then uses molecular similarity comparison to ensure diversity while maintaining validity. This removes low-quality reactions that could degrade model performance.
- Core assumption: Reactions that match known templates and have sufficient molecular similarity to unpaired data are chemically plausible and diverse enough to improve learning
- Evidence anchors:
  - [abstract] "Moreover, to enhance the quality of in-silico reactions, RetroWISE incorporates a filter process with chemical awareness, which consists of a template matching step and a molecular similarity comparison step"
  - [section] "The filter employs RDKit to eliminate in-silico reactions that contain wrong reactants or products SMILES. Subsequently, the template matching step selects chemical templates... For the second step, we set the threshold to be 0.55 to do a molecular similarity comparison."
  - [corpus] No direct evidence - filter process details not discussed in related papers
- Break condition: If the threshold for molecular similarity is too high, the filter may eliminate too many diverse reactions, limiting the model's exposure to varied chemical transformations

### Mechanism 3
- Claim: RetroWISE particularly improves performance on rare transformations by exposing the model to more diverse chemical patterns
- Mechanism: By generating in-silico reactions from unpaired data, the model encounters chemical transformations that appear infrequently in real data. This expanded exposure helps the model generalize better to rare cases that it might otherwise struggle with.
- Core assumption: Rare transformations in real data have corresponding unpaired data that can be used to generate representative in-silico reactions
- Evidence anchors:
  - [abstract] "Moreover, it consistently improves the prediction accuracy of rare transformations"
  - [section] "Retrosynthesis prediction also faces the challenge of handling rare transformations that involve uncommon reactants, products, or reaction mechanisms... We conduct an analysis of RetroWISE and the baseline both trained on USPTO-50K and report the accuracy on all the test subsets in Fig.4."
  - [corpus] No direct evidence - rare transformation handling not discussed in related papers
- Break condition: If rare transformations don't have corresponding unpaired data or the base model cannot generate them accurately, the improvement on rare cases will be limited

## Foundational Learning

- Concept: Chemical reaction representation using SMILES
  - Why needed here: The model operates directly on SMILES strings as input/output, so understanding how molecules are encoded as text is essential for interpreting the approach
  - Quick check question: What does the SMILES string "c1ccccc1" represent, and why is this notation useful for ML models?

- Concept: Molecular similarity metrics (Tanimoto coefficient)
  - Why needed here: The filter process uses molecular similarity to ensure diversity while maintaining validity, and the evaluation compares predicted molecules to ground truth using similarity measures
  - Quick check question: If two molecules have a Tanimoto coefficient of 0.9, what does this indicate about their structural similarity?

- Concept: Transformer architecture and attention mechanisms
  - Why needed here: The baseline and RetroWISE models use transformer architectures, which are central to understanding how the model processes sequential molecular data
  - Quick check question: In a transformer's attention mechanism, what is the purpose of scaling the dot product by 1/√d?

## Architecture Onboarding

- Component map: Base model training -> Unpaired data processing -> In-silico generation -> Filtering -> Retraining -> Evaluation
- Critical path: Base model training → Unpaired data processing → In-silico generation → Filtering → Retraining → Evaluation
- Design tradeoffs:
  - Quality vs. quantity of in-silico reactions (tighter filtering reduces quantity but improves quality)
  - Computational cost of generation vs. training time (more in-silico reactions improve performance but increase training time)
  - Template matching vs. diversity (strict template matching ensures chemical validity but may limit exposure to novel reactions)
- Failure signatures:
  - Model performance plateaus despite adding more in-silico reactions (filter may be too strict)
  - Generated reactions contain chemically impossible structures (base model quality issue)
  - Rare transformation accuracy doesn't improve (unpaired data insufficient for rare cases)
- First 3 experiments:
  1. Train base models on USPTO-50K and evaluate generation quality on a small unpaired dataset
  2. Implement filter process and measure retention rate and quality of in-silico reactions
  3. Retrain model with filtered in-silico reactions and compare performance on rare transformations vs. baseline

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the quality and diversity of unpaired data affect the performance of RetroWISE?
- Basis in paper: [inferred] The paper mentions that RetroWISE relies on unpaired data to generate in-silico reactions, and the effectiveness of the model is influenced by the availability and quality of this data.
- Why unresolved: The paper does not provide a detailed analysis of how different sources or preprocessing methods for unpaired data impact the model's performance.
- What evidence would resolve it: Experiments comparing RetroWISE's performance using unpaired data from various sources (e.g., different databases, preprocessing methods) would provide insights into the impact of data quality and diversity.

### Open Question 2
- Question: Can iterative training improve the performance of RetroWISE, and what are its limitations?
- Basis in paper: [explicit] The paper mentions that RetroWISE could benefit from iterative training, but it also highlights potential drawbacks such as increased training and generation time.
- Why unresolved: The paper does not explore the extent to which iterative training can improve RetroWISE's performance or investigate strategies to mitigate its limitations.
- What evidence would resolve it: Experiments comparing the performance of RetroWISE with and without iterative training, along with an analysis of the trade-offs between performance gains and computational costs, would provide insights into the effectiveness of this approach.

### Open Question 3
- Question: How does RetroWISE perform on multistep retrosynthesis planning, and what are the challenges?
- Basis in paper: [inferred] The paper focuses on single-step retrosynthesis prediction, but the authors mention the potential application of RetroWISE to multistep retrosynthesis planning.
- Why unresolved: The paper does not evaluate RetroWISE's performance on multistep retrosynthesis or discuss the challenges involved in extending the model to handle multiple steps.
- What evidence would resolve it: Experiments comparing RetroWISE's performance on single-step and multistep retrosynthesis tasks, along with an analysis of the challenges and potential solutions for handling multiple steps, would provide insights into the model's capabilities and limitations in this context.

## Limitations
- Base model quality critically determines the chemical plausibility of generated in-silico reactions
- Computational overhead of generating synthetic reactions scales with dataset size and desired diversity
- Performance gains depend on availability of sufficient unpaired data for rare transformations

## Confidence
- RetroWISE framework design and implementation: **High**
- 8.6% improvement on USPTO-50K top-1 accuracy: **Medium** (based on single benchmark)
- Consistent improvement on rare transformations: **Medium** (limited ablation studies)
- Filter process effectiveness: **Low-Medium** (threshold values appear arbitrary)

## Next Checks
1. Conduct ablation study varying the molecular similarity threshold (0.4-0.7 range) to quantify the tradeoff between reaction diversity and quality
2. Test base model generation quality on chemical reactions outside the USPTO domain (e.g., pharmaceutical synthesis reactions) to assess generalizability
3. Measure computational overhead of in-silico reaction generation relative to baseline training time across different dataset sizes