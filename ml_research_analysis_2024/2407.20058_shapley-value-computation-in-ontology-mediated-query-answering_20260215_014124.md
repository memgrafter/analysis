---
ver: rpa2
title: Shapley Value Computation in Ontology-Mediated Query Answering
arxiv_id: '2407.20058'
source_url: https://arxiv.org/abs/2407.20058
tags:
- shapley
- query
- value
- which
- then
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: "This paper analyzes the computational complexity of computing\
  \ Shapley values in the context of ontology-mediated query answering (OMQA). The\
  \ authors focus on ontology-mediated queries (OMQs) composed of an ontology T in\
  \ the description logic ELHI\u22A5 and a connected, constant-free, homomorphism-closed\
  \ query q."
---

# Shapley Value Computation in Ontology-Mediated Query Answering

## Quick Facts
- arXiv ID: 2407.20058
- Source URL: https://arxiv.org/abs/2407.20058
- Authors: Meghyn Bienvenu; Diego Figueira; Pierre Lafourcade
- Reference count: 33
- Primary result: Establishes FP/#P-hard dichotomy for Shapley value computation in ontology-mediated query answering

## Executive Summary
This paper analyzes the computational complexity of computing Shapley values in ontology-mediated query answering (OMQA). The authors focus on ontology-mediated queries (OMQs) composed of an ontology T in the description logic ELHI⊥ and a connected, constant-free, homomorphism-closed query q. They establish a FP/#P-hard dichotomy for Shapley value computation, showing that it is tractable if the OMQ can be rewritten into a safe union of conjunctive queries (UCQ), and #P-hard otherwise. This result is strengthened to cover possibly disconnected queries with constants, provided the OMQ is non-first-order rewritable.

## Method Summary
The authors leverage recent connections between Shapley value computation and probabilistic query evaluation to establish their complexity results. They analyze the computational complexity of Shapley value computation for different classes of OMQs, particularly focusing on OMQs in the (ELHI⊥, UCQ) setting. The approach involves characterizing when OMQs are first-order rewritable into safe UCQs, and showing that non-FO-rewritable OMQs have minimal supports containing arbitrarily deep tree-like structures, which can be used to encode #P-hard problems.

## Key Results
- Establishes FP/#P-hard dichotomy for Shapley value computation in OMQA
- Shows tractability when OMQ can be rewritten into safe UCQ, #P-hard otherwise
- Strengthens results to cover disconnected queries with constants if non-FO-rewritable

## Why This Works (Mechanism)

### Mechanism 1
The paper establishes a FP/#P-hard dichotomy for Shapley value computation in ontology-mediated query answering by reducing to probabilistic query evaluation. The authors leverage known connections between Shapley value computation and probabilistic query evaluation (PQE), particularly through the equivalence of SVC and SPPQE for connected hom-closed queries. This works under the assumption that connected hom-closed queries in the ELHI⊥ ontology setting can be analyzed using the same complexity tools as in the database setting.

### Mechanism 2
Non-FO-rewritability of an ontology-mediated query implies #P-hardness of Shapley value computation. The authors show that for any non-FO-rewritable OMQ in (ELHI⊥, UCQ), there exist minimal supports containing arbitrarily deep tree-like structures, which can be used to encode counting independent sets in bipartite graphs—a known #P-hard problem. This relies on the assumption that the existence of arbitrarily large minimal supports is guaranteed for non-FO-rewritable OMQs, and these supports can be structured to enable the reduction.

### Mechanism 3
The Shapley value computation for certain query types (e.g., graph reachability) is inherently #P-hard due to the nature of the query itself. The authors reduce from the S-T CONNECTEDNESS problem, which is #P-hard, by constructing OMQs where the Shapley value computation directly corresponds to counting subgraphs with specific properties. This works under the assumption that the ontology-mediated query can be constructed such that its Shapley value computation is isomorphic to the S-T CONNECTEDNESS problem.

## Foundational Learning

- Concept: Ontology-Mediated Query Answering (OMQA)
  - Why needed here: The paper's primary focus is on computing Shapley values in the context of OMQA, which involves querying knowledge bases that combine ontologies with data.
  - Quick check question: What is the difference between a TBox and an ABox in a description logic knowledge base?

- Concept: Description Logics (DLs)
  - Why needed here: The paper works with ontologies formulated in the description logic ELHI⊥, which is a specific fragment of description logics.
  - Quick check question: What are the basic constructors in the ELHI⊥ description logic?

- Concept: Computational Complexity Classes (FP, #P)
  - Why needed here: The paper establishes complexity results for Shapley value computation, distinguishing between problems solvable in polynomial time (FP) and those that are #P-hard.
  - Quick check question: What is the difference between FP and #P complexity classes?

## Architecture Onboarding

- Component map: OMQ (T, q) -> Complexity Analysis Module -> Shapley Value Computation Module
- Critical path: 1. Parse input OMQ 2. Determine FO-rewritability and UCQ safety 3. Classify as FP or #P-hard 4. Compute Shapley values accordingly
- Design tradeoffs: Using ELHI⊥ as the ontology language allows for a clean complexity dichotomy but may limit expressiveness. Focusing on UCQs simplifies analysis but may exclude useful query types.
- Failure signatures: Incorrect classification due to errors in FO-rewritability check or safe UCQ characterization. Runtime issues when testing on large OMQs.
- First 3 experiments: 1. Implement simple OMQ in (ELHI⊥, UCQ) and verify FP tractability 2. Construct non-FO-rewritable OMQ and verify #P-hardness 3. Test reduction from S-T CONNECTEDNESS to Shapley value computation

## Open Questions the Paper Calls Out

### Open Question 1
Is there a dichotomy for Shapley value computation (SVC) for all Boolean UCQs (including disconnected queries and queries with constants)? This remains unresolved because existing results in the pure database setting do not cover UCQs that are disconnected or with constants, and this limitation carries over to the OMQA setting. A proof or counterexample showing that SVC is either #P-hard for all unsafe UCQs or admitting a full FP/#P-hard dichotomy for all Boolean UCQs would resolve this.

### Open Question 2
Does the equivalence between PQE(1/2; 1) and PQEq hold for the full class of C-hom-closed queries in the context of probabilistic OMQA? The authors only establish this equivalence for OMQs in (ELHI⊥, UCQ) and conjecture it might extend to the full class of C-hom-closed queries without providing a proof. A proof showing that PQE(1/2; 1) ≡P PQEq for all C-hom-closed queries, or a counterexample demonstrating a query where the equivalence does not hold, would resolve this.

### Open Question 3
Can the extension of the dichotomy results to tuple-generating dependencies (TGDs) or existential rules be achieved? The authors discuss the challenges of extending their results to ontologies formulated using TGDs, mentioning the lack of forest-shaped models and the need for unique-path conditions. A proof or counterexample showing that a dichotomy for SVC or probabilistic OMQA can or cannot be established for a class of OMQs whose ontologies are formulated using TGDs would resolve this.

## Limitations
- Complexity results are established for a specific fragment of ontology-mediated queries (OMQs) with ELHI⊥ TBoxes and connected constant-free homomorphism-closed queries.
- The reduction from Shapley value computation to probabilistic query evaluation assumes certain structural properties of the OMQs, which may not hold for all query types or ontology languages.
- The computational complexity results are theoretical; practical implementation and performance evaluation on real-world datasets are not discussed.

## Confidence
- High confidence: The FP/#P-hard dichotomy for Shapley value computation in OMQs with ELHI⊥ TBoxes and connected constant-free homomorphism-closed queries.
- Medium confidence: The extension of the dichotomy to possibly disconnected queries with constants, provided the OMQ is non-first-order rewritable.
- Low confidence: The practical implications and performance of the proposed methods on real-world datasets.

## Next Checks
1. Implement the FO-rewritability check and safe UCQ characterization to verify the classification of OMQs as tractable vs #P-hard.
2. Test the Shapley value computation algorithm on small, hand-crafted OMQs where the expected results are known.
3. Evaluate the performance of the proposed methods on larger, more complex OMQs to assess their practical applicability.