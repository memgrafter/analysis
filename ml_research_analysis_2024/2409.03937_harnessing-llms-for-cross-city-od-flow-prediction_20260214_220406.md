---
ver: rpa2
title: Harnessing LLMs for Cross-City OD Flow Prediction
arxiv_id: '2409.03937'
source_url: https://arxiv.org/abs/2409.03937
tags:
- city
- data
- flow
- cell
- destination
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces LLM-COD, a framework that uses large language
  models (LLMs) to predict origin-destination (OD) flows across cities. LLM-COD fine-tunes
  LLMs with a novel loss function integrating POI semantics and trip distance, enabling
  the model to capture spatial and functional relationships within urban spaces.
---

# Harnessing LLMs for Cross-City OD Flow Prediction

## Quick Facts
- arXiv ID: 2409.03937
- Source URL: https://arxiv.org/abs/2409.03937
- Reference count: 40
- Primary result: LLM-COD achieves 46% reduction in RMSE for cross-city OD flow prediction compared to best baseline model

## Executive Summary
This paper introduces LLM-COD, a framework that leverages large language models (LLMs) to predict origin-destination (OD) flows across different cities. The approach fine-tunes LLMs with a novel loss function integrating POI semantics and trip distance, enabling the model to capture universal patterns of human movement across cities. Experiments on Beijing, Chengdu, and Xi'an demonstrate that LLM-COD significantly outperforms state-of-the-art learning-based methods, achieving a 46% reduction in RMSE for 1,000m × 1,000m grids compared to the best baseline model.

## Method Summary
LLM-COD uses LLMs to predict OD flows by fine-tuning them with instruction-based prompts that encode spatial features of origin and destination locations. The model employs a novel loss function that combines weighted cross-entropy for POI prediction and travel cost prediction, integrating POI semantics with trip distance. The framework uses LoRA-based fine-tuning to adapt pre-trained LLMs to the OD prediction task, enabling knowledge transfer from a source city with abundant data to target cities with limited data.

## Key Results
- Achieves 46% reduction in RMSE for 1,000m × 1,000m grid OD flow prediction compared to best baseline
- Demonstrates robust performance across three major Chinese cities with varying characteristics
- Successfully captures true spatial distribution of OD flows with high CPC scores
- Shows effectiveness in handling varying OD flow and trip distance distributions across cities

## Why This Works (Mechanism)

### Mechanism 1
- Claim: LLM-COD leverages pre-trained language models to learn spatial and functional relationships between urban POIs and human mobility patterns
- Mechanism: Fine-tunes LLMs using a novel loss function integrating POI semantics and trip distance to capture universal patterns of human movement across cities
- Core assumption: People travel for specific purposes and follow similar patterns in Origin-Destination POIs across cities
- Evidence anchors:
  - [abstract] "Our approach leverages the advanced semantic understanding and contextual learning capabilities of LLMs to bridge the gap between cities with different characteristics"
  - [section] "Despite the considerable variations in their trips across different cities, people travel for specific purposes and tend to follow similar patterns in their Origin-Destination POIs"
- Break condition: If universal OD patterns across cities do not hold, model's ability to transfer knowledge between cities would be compromised

### Mechanism 2
- Claim: Instruction-tuning process with specific prompts enables LLMs to understand and generate OD flows in textual format
- Mechanism: Guides LLM with specific instruction format specifying spatial features of origin and destination
- Core assumption: LLMs can be effectively fine-tuned to understand spatial features and temporal information with structured instructions
- Evidence anchors:
  - [section] "Our next step is to fine-tune an LLM using instructions to establish the OD pair learning in textual format"
  - [section] "We guide the LLM with a specific instruction, as detailed in Table 2, which specifies the spatial features of the origin and destination"
- Break condition: If instruction format doesn't adequately capture spatial and temporal relationships, LLM may fail to generate meaningful OD predictions

### Mechanism 3
- Claim: New loss function integrating POI semantics with distance helps achieve robust performance across cities
- Mechanism: Combines weighted cross-entropy for POI prediction and travel cost prediction
- Core assumption: Combination of POI semantic information and travel distance in loss function captures complex relationships between origins and destinations
- Evidence anchors:
  - [section] "We introduce a new loss function that integrates POI semantics and trip distance during training"
  - [section] "During training, we aim to predict the spatial feature of each destination cell within the target urban area and the acceptable traveling cost to reach the destination cell"
- Break condition: If loss function doesn't adequately balance POI semantics and travel distance, model may overfit to one aspect and underperform in cross-city prediction

## Foundational Learning

- Concept: Transfer Learning
  - Why needed here: To leverage knowledge from source city with abundant data for target city with limited data
  - Quick check question: What are the key challenges in applying transfer learning to cross-city OD prediction, and how does LLM-COD address them?

- Concept: Spatial Feature Representation
  - Why needed here: To encode spatial distribution of POIs within grid cells for understanding functional relationships between locations
  - Quick check question: How does spatial feature representation capture diversity of POI types, and what impact does this have on OD flow prediction?

- Concept: Graph Neural Networks
  - Why needed here: To model complex spatial relationships between grid cells and capture interactions between neighboring regions
  - Quick check question: How can graph neural networks be integrated into LLM-COD framework to further improve spatial dependency modeling?

## Architecture Onboarding

- Component map: Data Collection -> Model Training -> Prediction -> Evaluation
- Critical path:
  1. Collect OD training dataset from source city (Beijing)
  2. Fine-tune LLM using instruction format and new loss function
  3. Create origin POI dataset in target city (Chengdu, Xi'an)
  4. Predict destination POIs and acceptable travel distances
  5. Match predicted destinations to grid cells and calculate OD matrix

- Design tradeoffs:
  - Grid size: Smaller grids provide more precise predictions but require more computational resources and may lead to data sparsity
  - POI categories: More categories improve urban function understanding but increase spatial feature complexity
  - Loss function weights: Balancing weights between POI semantics and travel distance is crucial for robust cross-city performance

- Failure signatures:
  - High RMSE values indicate poor prediction accuracy due to inadequate knowledge transfer or insufficient spatial feature representation
  - Low CPC values suggest failure to capture true OD flow distribution due to oversimplification or incorrect assumptions about universal patterns
  - Inconsistent performance across cities indicates overfitting to source city characteristics or failure to adapt to target city features

- First 3 experiments:
  1. Ablation study: Evaluate impact of removing city indicators from instruction format on cross-city performance
  2. Single POI strategy: Compare performance using single vs. multiple POI types per grid cell
  3. Loss function weight variation: Investigate effect of varying travel distance weight on predicting OD flows with different distance distributions

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How can the interpretability of the LLM-COD model's predictions be improved for urban planners and policymakers?
- Basis in paper: [explicit] The authors mention the importance of providing clear and understandable explanations of the model's predictions for practical applications in urban planning
- Why unresolved: Paper focuses on technical performance but doesn't address methods for enhancing interpretability or user understanding of decision-making process
- What evidence would resolve it: Research demonstrating effective techniques for explaining LLM-based predictions in user-friendly manner for urban planning context

### Open Question 2
- Question: How does performance vary when applied to cities with significantly different urban layouts and transportation systems?
- Basis in paper: [inferred] Authors discuss model's ability to transfer knowledge across cities but don't extensively explore scenarios with vastly different characteristics
- Why unresolved: Experiments focus on cities with some similarities; limited discussion on adaptability to diverse urban environments
- What evidence would resolve it: Comparative studies evaluating performance across wider range of cities with diverse urban layouts and transportation systems

### Open Question 3
- Question: What are the potential biases in the LLM-COD model's predictions, and how can they be mitigated?
- Basis in paper: [inferred] Authors don't address potential biases that could arise from training data or LLM pre-training biases
- Why unresolved: Paper focuses on performance metrics but doesn't discuss ethical implications or potential biases affecting accuracy and fairness
- What evidence would resolve it: Analysis of predictions across different demographic groups and urban areas, identifying biases and proposing mitigation methods

## Limitations
- Core mechanism relies on assumption of universal OD patterns across cities, which may not hold for cities with significantly different urban structures
- Limited validation on cities with substantially different characteristics from source city (Beijing)
- Potential for biases arising from training data or LLM pre-training that could affect prediction accuracy and fairness

## Confidence
- High: Empirical results demonstrate significant improvements over baselines
- Medium: Core assumptions about universal OD patterns and POI semantics integration require further validation
- Low: Limited exploration of model's performance on cities with vastly different urban layouts and transportation systems

## Next Checks
1. Cross-city validation on cities with substantially different urban layouts and transportation modes to test universality of OD patterns
2. Ablation studies to quantify individual contributions of POI semantics and distance components in loss function
3. Evaluation of model robustness when faced with varying levels of data sparsity in target cities