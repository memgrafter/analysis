---
ver: rpa2
title: Attack-Resilient Image Watermarking Using Stable Diffusion
arxiv_id: '2401.04247'
source_url: https://arxiv.org/abs/2401.04247
tags:
- image
- watermark
- zodiac
- quality
- watermarked
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the problem of robust digital image watermarking
  in the era of advanced generative AI models, such as Stable Diffusion, which can
  effectively remove existing watermarks. The proposed method, ZoDiac, uses a pre-trained
  Stable Diffusion model to inject watermarks into the trainable latent space of images,
  resulting in watermarks that are both invisible and robust to various attacks.
---

# Attack-Resilient Image Watermarking Using Stable Diffusion

## Quick Facts
- arXiv ID: 2401.04247
- Source URL: https://arxiv.org/abs/2401.04247
- Reference count: 40
- Outperforms state-of-the-art watermarking methods with detection rate above 98% and false positive rate below 6.4%

## Executive Summary
This paper introduces ZoDiac, a novel image watermarking method that leverages pre-trained diffusion models like Stable Diffusion to create watermarks that survive attacks from advanced generative AI models. The method injects watermarks into the Fourier space of the latent vectors in diffusion models, resulting in watermarks that are both invisible and robust to various attacks including the stable-diffusion-based attack (Zhao23). Experiments on three benchmarks demonstrate superior performance compared to state-of-the-art watermarking methods, with watermark detection rates above 98% and false positive rates below 6.4%.

## Method Summary
ZoDiac injects watermarks into the latent Fourier space of pre-trained diffusion models. The method begins with DDIM inversion to initialize the latent vector, then encodes the watermark in the Fourier space of this vector using a binary mask with radius 10. The watermarked latent vector is optimized through reconstruction loss minimization (combining L2, SSIM, and perceptual losses) to generate an image similar to the original while preserving the watermark. An adaptive image enhancement step blends the watermarked and original images based on SSIM thresholds to improve perceptual quality. Watermark detection involves DDIM inversion, Fourier transformation, and statistical testing using non-central chi-squared distributions.

## Key Results
- Achieves watermark detection rate above 98% across three benchmark datasets
- Maintains false positive rate below 6.4% against various attacks
- Outperforms state-of-the-art methods in robustness against composite attacks including the stable-diffusion-based attack
- Watermarked images achieve PSNR ~30dB, SSIM ~0.92, and LPIPS < 0.1

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Embedding watermarks in the latent Fourier space of a pre-trained diffusion model enhances robustness against attacks.
- Mechanism: The watermark is encoded in the low-frequency Fourier components of the latent vector, which are preserved during the diffusion denoising process and less susceptible to perturbations from common attacks.
- Core assumption: The diffusion denoising process inherently stabilizes the low-frequency components of the latent vector.
- Evidence anchors:
  - [abstract] "We hypothesize that the reciprocating denoising process in diffusion models may inherently enhance the robustness of the watermark when faced with strong attacks and validate the hypothesis."
  - [section 4.3] Table 2 shows that even with a single denoising step, ZoDiac significantly outperforms a variant without the diffusion process, indicating the denoising step contributes to robustness.
- Break condition: If the attack severely distorts the low-frequency components or if the diffusion model's denoising fails to preserve them, robustness may degrade.

### Mechanism 2
- Claim: Adaptive mixing of the watermarked and original images improves perceptual quality without significantly compromising watermark detectability.
- Mechanism: A modulating factor γ is optimized to blend the generated watermarked image with the original, achieving a desired SSIM threshold while minimizing visible artifacts.
- Core assumption: The watermark is robust enough to survive the blending process at an acceptable SSIM threshold.
- Evidence anchors:
  - [section 3.2.3] "Adaptive image enhancement automatically identifies the smallest γ that results in desired image quality through binary search."
  - [section 4.2] Table 1 shows ZoDiac achieves high SSIM (≈0.92) while maintaining high watermark detection rates.
- Break condition: If γ is set too high to improve image quality, the watermark may become undetectable.

### Mechanism 3
- Claim: Using DDIM inversion for latent vector initialization accelerates convergence and improves image quality.
- Mechanism: The latent vector is initialized from the DDIM inversion of the original image, providing a starting point that closely resembles the original and requires fewer optimization iterations.
- Core assumption: DDIM inversion produces a latent vector that maps back to a high-quality reconstruction of the original image.
- Evidence anchors:
  - [section 3.2.1] "Empirically, we find that using a randomly initialized latent vector can require hundreds of iterations when remapping, while using an initial latent vector from DDIM inversion converges in dozens of iterations while achieving a higher image quality."
  - [section B.1] Figure 5 demonstrates faster convergence and higher quality images with DDIM-initialized latents compared to random initialization.
- Break condition: If DDIM inversion fails to produce a faithful latent representation, image quality and convergence may suffer.

## Foundational Learning

- Concept: Diffusion models and the DDIM inversion process.
  - Why needed here: Understanding how ZoDiac leverages pre-trained diffusion models for watermark embedding and detection.
  - Quick check question: What is the difference between the forward diffusion process and the DDIM inversion process in stable diffusion models?

- Concept: Fourier transformation and its application in watermarking.
  - Why needed here: Comprehending how ZoDiac injects watermarks into the frequency domain of the latent vector for improved robustness.
  - Quick check question: Why does encoding watermarks in the Fourier space of the latent vector help preserve image quality and robustness?

- Concept: Statistical hypothesis testing using non-central chi-squared distributions.
  - Why needed here: Understanding how ZoDiac detects watermarks by testing for the presence of the watermark pattern in the Fourier-transformed latent vector.
  - Quick check question: How does the non-central chi-squared distribution relate to the statistical test used for watermark detection in ZoDiac?

## Architecture Onboarding

- Component map: Image → DDIM inversion → Latent vector initialization → Watermark encoding → Latent vector optimization → Adaptive image enhancement → Watermarked image
- Critical path: Image → DDIM inversion → Latent vector initialization → Watermark encoding → Latent vector optimization → Adaptive image enhancement → Watermarked image
- Design tradeoffs:
  - Image quality vs. watermark robustness: Higher SSIM thresholds improve image quality but may reduce watermark detectability.
  - Detection threshold vs. false positive rate: Stricter detection thresholds reduce false positives but may also decrease true positive rates.
  - Denoising steps vs. computation time: More denoising steps increase robustness but also increase computation time.
- Failure signatures:
  - Low watermark detection rate: Possible causes include insufficient denoising steps, inappropriate SSIM threshold, or strong attacks.
  - High false positive rate: Possible causes include low detection threshold or watermark patterns resembling natural image features.
  - Poor image quality: Possible causes include aggressive watermark injection or insufficient optimization iterations.
- First 3 experiments:
  1. Verify DDIM inversion: Input an image, perform DDIM inversion, and confirm the reconstructed image closely resembles the original.
  2. Test watermark encoding: Inject a watermark into a latent vector, generate an image, and visually inspect for watermark artifacts.
  3. Evaluate watermark detection: Apply watermark detection to a watermarked image and confirm the watermark is correctly identified.

## Open Questions the Paper Calls Out
The paper does not explicitly call out open questions, but the following remain unexplored:

## Limitations
- Computational cost of optimization-based watermark embedding may limit practical deployment at scale
- Performance on diverse image types beyond tested datasets not thoroughly explored
- Sensitivity to watermark pattern variations remains untested
- Robustness against future, unknown attack strategies remains unproven

## Confidence
- High confidence in the core mechanism of latent Fourier space watermarking and its demonstrated effectiveness against tested attacks
- Medium confidence in the scalability and practical deployment considerations due to computational costs
- Medium confidence in the generalizability to other diffusion models beyond stable-diffusion-2-1-base

## Next Checks
1. Test the watermark detection rate on a diverse dataset of 100 images from different domains (medical imaging, satellite imagery, product photography) to assess generalizability
2. Measure the average optimization time per image across different hardware configurations and compare against real-time watermarking requirements
3. Apply the watermark detection to watermarked images processed by a commercial compression algorithm not included in the current attack suite