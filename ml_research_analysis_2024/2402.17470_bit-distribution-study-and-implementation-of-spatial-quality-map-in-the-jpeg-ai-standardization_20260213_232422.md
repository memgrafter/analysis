---
ver: rpa2
title: Bit Distribution Study and Implementation of Spatial Quality Map in the JPEG-AI
  Standardization
arxiv_id: '2402.17470'
source_url: https://arxiv.org/abs/2402.17470
tags:
- image
- jpeg-ai
- quality
- distribution
- index
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This study analyzes spatial bit distribution in JPEG-AI VM 3.4
  and VVC intra codecs. Contrary to prior assumptions, VVC intra exhibits more flexible
  bit distribution through its adaptive block-size strategy, as revealed by bit distribution
  map (BDM) analysis.
---

# Bit Distribution Study and Implementation of Spatial Quality Map in the JPEG-AI Standardization

## Quick Facts
- arXiv ID: 2402.17470
- Source URL: https://arxiv.org/abs/2402.17470
- Reference count: 25
- Key outcome: Spatial quality index map improves JPEG-AI VM's adaptability, achieving up to 0.45 dB PSNR-Y gains

## Executive Summary
This study challenges the assumption that learned image codecs inherently achieve better spatial bit distribution than classical codecs. Through comprehensive analysis of JPEG-AI VM 3.4 and VVC intra codecs, the research reveals that VVC actually exhibits more flexible spatial bit distribution through its adaptive block-size strategy. Building on this insight, the authors propose a spatial quality index map for JPEG-AI VM that enables block-wise quantization step variation. This approach significantly improves visual quality and reduces bit consumption in less critical regions, with objective results showing PSNR-Y gains up to 0.45 dB when using VVC BDM-based quality maps.

## Method Summary
The study employs bit distribution map (BDM) analysis to compare spatial bit allocation between JPEG-AI VM and VVC intra codecs. A spatial quality index map is implemented by introducing quantization indices (-8 to +8) that multiply the latent tensor, enabling block-wise distribution of quantization steps. The quality index map is signaled through entropy coding of index differences. VVC BDM-based quality maps are applied by downsampling VVC BDMs to 16×16 resolution and quantizing them into five levels based on mean thresholds. The approach is evaluated on the JPEG-AI CTTC test dataset using PSNR-Y and bit rate metrics.

## Key Results
- VVC intra codec achieves more flexible spatial bit distribution than JPEG-AI VM through adaptive block-size strategy
- Spatial quality index map enables block-wise quantization step variation, improving visual quality in critical regions
- Objective performance gains of up to 0.45 dB PSNR-Y achieved using VVC BDM-based quality maps

## Why This Works (Mechanism)

### Mechanism 1
- Claim: VVC intra codec achieves more flexible spatial bit distribution than JPEG-AI VM through adaptive block-size strategy
- Mechanism: VVC uses variable block sizes (from 4×4 to 64×64) during encoding, allowing it to allocate bits more precisely to complex regions while saving bits in smooth areas
- Core assumption: Variable block sizes enable better adaptation to local image characteristics
- Evidence anchors:
  - [abstract]: "VVC intra displays a more adaptable bit distribution structure through the implementation of various block sizes"
  - [section II.A]: "In contrast, VVC encodes images on a block-by-block basis, dividing them into various shapes and sizes prior to compression"
  - [corpus]: Weak evidence - no directly related papers found that specifically discuss VVC's block-size strategy for bit distribution
- Break condition: If the variable block-size strategy becomes too computationally expensive or if the entropy coding cannot effectively handle the non-uniform block sizes

### Mechanism 2
- Claim: Spatial quality index map enables block-wise quantization step variation in JPEG-AI VM
- Mechanism: By introducing a quality index map Q that multiplies the latent tensor, different quantization steps can be applied to different 16×16 blocks, allowing more bits for important regions and fewer bits for less critical areas
- Core assumption: The encoder and decoder can efficiently signal and apply the quality index map without excessive overhead
- Evidence anchors:
  - [section III.A]: "To facilitate the spatial distribution of bits in the JPEG-AI VM, a spatial quality map was devised for the codec. This attribute enables different quantization steps to be allocated to diverse parts of the image"
  - [section III.A]: "Multiplying the latent tensor with Q yields a block-wise distribution of the original image"
  - [corpus]: Weak evidence - no directly related papers found that specifically discuss spatial quality maps in learned image compression
- Break condition: If the signaling overhead of the quality index map exceeds the bit savings from spatial adaptation, or if the entropy model cannot effectively compress the quality index differences

### Mechanism 3
- Claim: VVC BDM-based quality index map improves JPEG-AI VM objective performance by 0.45 dB PSNR-Y
- Mechanism: Using VVC's bit distribution pattern as a quality index map for JPEG-AI VM allows the learned codec to allocate bits similarly to the classical codec, which has been optimized through extensive research
- Core assumption: VVC's bit allocation strategy is optimal for human visual perception and can be effectively transferred to a learned codec
- Evidence anchors:
  - [abstract]: "by applying the VVC bit distribution strategy, the objective performance of JPEG-AI verification mode can be further improved, resulting in a maximum gain of 0.45 dB in PSNR-Y"
  - [section III.C]: "The PSNR-Y results obtained from implementing the VVC BDM-based quality index map on the JPEG-AI VM are presented... the PSNR-Y for the image 12 at 0.25 bpp increased from 33.24 dB to 33.69 dB, representing an increase of nearly 1.4%"
  - [corpus]: Weak evidence - no directly related papers found that specifically discuss transferring VVC's bit distribution strategy to learned codecs
- Break condition: If the VVC bit distribution pattern is not optimal for the specific characteristics of learned image compression, or if the computational complexity of applying VVC's strategy to JPEG-AI VM is prohibitive

## Foundational Learning

- Concept: Bit Distribution Map (BDM) analysis
  - Why needed here: Understanding how different codecs allocate bits across spatial regions is crucial for comparing their compression efficiency and developing improvement strategies
  - Quick check question: How is the variance of a BDM calculated, and what does it indicate about a codec's spatial bit distribution flexibility?

- Concept: Rate-Distortion Optimization (RDO)
  - Why needed here: RDO is the fundamental principle behind both VVC's block-size selection and JPEG-AI VM's quality index map optimization
  - Quick check question: What is the mathematical relationship between rate (R), distortion (D), and the Lagrange multiplier (λ) in RDO?

- Concept: Entropy modeling in learned image compression
  - Why needed here: Efficient entropy coding of both the latent representations and the quality index map is essential for achieving practical compression performance
  - Quick check question: How does the choice of entropy model (e.g., Gaussian, Gaussian mixture, autoregressive) affect the compression efficiency of learned image codecs?

## Architecture Onboarding

- Component map:
  - Analysis transform network: Maps input image to latent representation
  - Hyper encoder network: Generates side information for entropy modeling
  - Gain unit: Applies quantization steps to latent coefficients
  - Spatial quality index map: Provides block-wise quantization step variation
  - Synthesis transform network: Reconstructs image from quantized latent representation
  - Entropy model: Approximates the entropy of latent variables and quality indices

- Critical path:
  1. Input image → Analysis transform → Latent tensor
  2. Latent tensor → Quality index map multiplication → Quantized latent tensor
  3. Quantized latent tensor + Quality index map → Entropy coding → Bitstream
  4. Bitstream → Entropy decoding → Quantized latent tensor + Quality index map
  5. Quantized latent tensor + Quality index map → Synthesis transform → Reconstructed image

- Design tradeoffs:
  - Fixed vs. variable block sizes: Fixed sizes (JPEG-AI VM) offer simplicity and computational efficiency, while variable sizes (VVC) provide better adaptation to local image characteristics
  - Signaling overhead vs. compression gain: More complex spatial quality maps can improve visual quality but require additional bits to signal
  - Model complexity vs. runtime complexity: More sophisticated quality index maps may improve compression but increase computational requirements

- Failure signatures:
  - Quality index map variance too low: Indicates insufficient spatial adaptation
  - Quality index map variance too high: Suggests over-complexity leading to poor generalization
  - Bpp deviation from target: Indicates problems with entropy modeling or rate control
  - PSNR gains not matching subjective improvements: Suggests perceptual quality issues not captured by PSNR

- First 3 experiments:
  1. Implement basic BDM analysis: Generate and compare BDMs for JPEG-AI VM and VVC on a diverse set of images to quantify spatial bit distribution differences
  2. Test spatial quality index map with simple patterns: Apply quality index maps with uniform patterns (e.g., center-focused, edge-focused) to JPEG-AI VM and measure PSNR and bpp changes
  3. Evaluate VVC BDM transfer: Use VVC's BDM as a quality index map for JPEG-AI VM and compare objective performance with and without the quality index map

## Open Questions the Paper Calls Out

### Open Question 1
- Question: What is the optimal strategy for combining VVC's adaptive block-size approach with JPEG-AI's neural network architecture to achieve better bit distribution without excessive computational complexity?
- Basis in paper: [explicit] The paper notes that directly utilizing VVC's bit distribution strategy in JPEG-AI VM demands excessive complexity from the VVC encoder, but demonstrates potential quality improvements
- Why unresolved: The paper shows proof-of-concept improvements but doesn't propose a practical implementation method that balances quality gains with computational efficiency
- What evidence would resolve it: Experimental results comparing different hybrid approaches that maintain VVC's flexibility while preserving JPEG-AI's computational advantages

### Open Question 2
- Question: How does the spatial quality index map perform on diverse image types beyond the test set used in the paper, particularly for images with complex textures or high-frequency content?
- Basis in paper: [inferred] The paper demonstrates effectiveness on specific test images but doesn't systematically analyze performance across different image categories or content types
- Why unresolved: The evaluation is limited to a small subset of images from the JPEG-AI CTTC test dataset without comprehensive analysis of different image characteristics
- What evidence would resolve it: Large-scale experiments across diverse image databases showing consistent performance improvements and identifying failure modes

### Open Question 3
- Question: What is the fundamental relationship between the flexibility of spatial bit distribution and compression efficiency in learned image codecs compared to classical codecs?
- Basis in paper: [explicit] The paper challenges the assumption that learned codecs succeed due to spatial flexibility, finding that VVC actually has more flexible bit distribution despite classical design
- Why unresolved: The paper identifies the phenomenon but doesn't fully explain why this counterintuitive result occurs or its implications for codec design principles
- What evidence would resolve it: Theoretical analysis explaining the relationship between block structure, bit distribution flexibility, and compression performance across codec architectures

## Limitations

- Weak evidence base: Corpus search yielded zero directly related papers on VVC block-size strategy, spatial quality maps, or transferring VVC's bit distribution to learned codecs
- Limited validation: Results based on small subset of test images without comprehensive cross-validation on independent datasets
- Missing subjective evaluation: Reliance on PSNR-Y metrics without comprehensive subjective quality assessment using MS-SIM methodology

## Confidence

**High Confidence**: The claim that JPEG-AI VM uses fixed 16×16 block sizes is well-supported by the standard's architecture and verified through the BDM analysis showing uniform bit distribution patterns.

**Medium Confidence**: The assertion that VVC achieves more flexible spatial bit distribution through adaptive block sizes is supported by the observed BDM variance differences, but lacks direct evidence from comparative studies or ablation experiments isolating the block-size effect.

**Low Confidence**: The claim that VVC BDM-based quality index maps improve JPEG-AI VM objective performance by up to 0.45 dB PSNR-Y is based on limited test images and specific bpp points, without comprehensive validation across diverse content or comparison to alternative spatial adaptation strategies.

## Next Checks

1. **Cross-validation with independent datasets**: Apply the VVC BDM-based quality map to JPEG-AI VM on the Kodak and Tecnick datasets, comparing PSNR-Y improvements against the JPEG-AI CTTC results to verify generalizability.

2. **Ablation study of spatial adaptation**: Implement alternative spatial quality map strategies (e.g., edge-aware, texture-based, or learned quality maps) and compare their performance against the VVC BDM-based approach to isolate the contribution of VVC's specific bit distribution pattern.

3. **Subjective quality evaluation**: Conduct a comprehensive subjective quality assessment using the Multi Stimulus Impairment Scale (MS-SIM) methodology to validate whether the PSNR-Y improvements correspond to perceptible quality gains, particularly in ROI coding scenarios.