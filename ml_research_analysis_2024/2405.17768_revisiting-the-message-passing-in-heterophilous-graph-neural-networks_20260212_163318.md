---
ver: rpa2
title: Revisiting the Message Passing in Heterophilous Graph Neural Networks
arxiv_id: '2405.17768'
source_url: https://arxiv.org/abs/2405.17768
tags:
- nodes
- neighborhood
- node
- heterophilous
- which
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'This paper addresses the paradox of message-passing mechanisms
  working effectively in heterophilous graphs, where connected nodes have different
  labels. The authors reformulate message passing in heterophilous graph neural networks
  into a unified heterophilous message-passing (HTMP) mechanism, consisting of three
  steps: aggregating messages with explicit guidance, combining messages from multiple
  neighborhoods, and fusing intermediate representations.'
---

# Revisiting the Message Passing in Heterophilous Graph Neural Networks

## Quick Facts
- arXiv ID: 2405.17768
- Source URL: https://arxiv.org/abs/2405.17768
- Authors: Zhuonan Zheng, Yuanchen Bei, Sheng Zhou, Yao Ma, Ming Gu, HongJia XU, Chengyu Lai, Jiawei Chen, Jiajun Bu
- Reference count: 40
- Key outcome: This paper addresses the paradox of message-passing mechanisms working effectively in heterophilous graphs, where connected nodes have different labels. The authors reformulate message passing in heterophilous graph neural networks into a unified heterophilous message-passing (HTMP) mechanism, consisting of three steps: aggregating messages with explicit guidance, combining messages from multiple neighborhoods, and fusing intermediate representations. They reveal that the success of message passing in existing heterophilous GNNs is attributed to implicitly enhancing the compatibility matrix among classes. However, the full potential of the compatibility matrix is not completely achieved due to the existence of incomplete and noisy semantic neighborhoods in real-world heterophilous graphs. To bridge this gap, they introduce a new approach named CMGNN, which operates within the HTMP mechanism to explicitly leverage and improve the compatibility matrix. The proposed CMGNN achieves superior performance on 10 benchmark datasets compared to 13 well-established baselines.

## Executive Summary
This paper addresses a fundamental paradox in graph neural networks (GNNs): why message passing works effectively in heterophilous graphs where connected nodes have different labels. The authors introduce a unified heterophilous message-passing (HTMP) mechanism that reformulates existing HTGNNs into three core steps: aggregating messages with explicit guidance, combining messages from multiple neighborhoods, and fusing intermediate representations. Through empirical analysis, they reveal that the success of message passing in heterophilous graphs is attributed to implicitly enhancing the compatibility matrix among classes. However, they identify that real-world graphs have incomplete and noisy semantic neighborhoods that prevent the full potential of the compatibility matrix from being achieved. To address this limitation, the authors propose CMGNN, which explicitly leverages and improves the compatibility matrix by constructing supplementary neighborhood messages, achieving superior performance on 10 benchmark datasets.

## Method Summary
The authors reformulate message passing in heterophilous GNNs into a unified HTMP mechanism consisting of three steps: (1) aggregating messages with explicit guidance, (2) combining messages from multiple neighborhoods (ego, raw, and supplementary), and (3) fusing intermediate representations. They introduce CMGNN, which operates within this HTMP framework by explicitly leveraging the compatibility matrix to construct supplementary neighborhood messages based on class prototypes. The method uses semi-supervised learning with a 48%/32%/20% train/validation/test split, incorporating both cross-entropy loss and a discrimination loss to enhance class discriminability in the compatibility matrix. The compatibility matrix is estimated using node degrees, confidence scores, and semi-supervised labels.

## Key Results
- CMGNN achieves superior performance on 10 benchmark datasets compared to 13 well-established baselines
- The unified HTMP mechanism successfully captures the core operations of existing heterophilous GNNs
- Explicit enhancement of the compatibility matrix through CMGNN addresses the limitations of incomplete and noisy semantic neighborhoods
- The method demonstrates effectiveness across graphs with varying homophily levels (0.1-0.8)

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Message passing remains effective in heterophilous graphs because it implicitly enhances the compatibility matrix among classes.
- Mechanism: The compatibility matrix (CM) represents the probabilities of observing edges among nodes from different classes. When message passing is applied, it implicitly increases the distinctiveness between rows of the CM, making node representations of different classes more discriminative in heterophilous graphs.
- Core assumption: The effectiveness of message passing in existing HTGNNs is attributed to implicitly enhancing the compatibility matrix among classes.
- Evidence anchors:
  - [abstract] "Based on HTMP and empirical analysis, we reveal that the success of message passing in existing HTGNNs is attributed to implicitly enhancing the compatibility matrix among classes."
  - [section 4] "Observation 2 (Connection between CM and HTMP). The unified goal of various message passing in existing HTGNNs is to utilize and enhance the discriminability of CM on heterophilous graphs."
  - [corpus] Weak evidence. No direct citations to compatibility matrix enhancement in related works.
- Break condition: If the semantic neighborhoods in real-world graphs are too incomplete and noisy, preventing the implicit enhancement of the CM.

### Mechanism 2
- Claim: The full potential of the compatibility matrix is not completely achieved due to incomplete and noisy semantic neighborhoods in real-world heterophilous graphs.
- Mechanism: Nodes within real-world graphs might exhibit a semantic neighborhood that only reveals a fraction of the compatibility matrix, accompanied by noise. This leads to overlapping distributions of semantic neighborhoods among different classes, making the information redundant during message passing.
- Core assumption: Real-world graphs have incomplete and noisy semantic neighborhoods that limit the effectiveness of enhancing the compatibility matrix.
- Evidence anchors:
  - [abstract] "Moreover, we argue that the full potential of the compatibility matrix is not completely achieved due to the existence of incomplete and noisy semantic neighborhoods in real-world heterophilous graphs."
  - [section 4] "Drawing from previous observations, we contend that nodes within real-world graphs might exhibit a semantic neighborhood that only reveals a fraction of the compatibility matrix, accompanied by noise."
  - [corpus] Weak evidence. Limited discussion on semantic neighborhood completeness and noise in related works.
- Break condition: If the semantic neighborhoods are complete and noise-free, allowing the full potential of the CM to be achieved without additional interventions.

### Mechanism 3
- Claim: CMGNN explicitly leverages and improves the compatibility matrix to handle incomplete and noisy semantic neighborhoods.
- Mechanism: CMGNN introduces a supplementary neighborhood indicator and corresponding aggregation guidance based on the estimated compatibility matrix. It constructs desired neighborhood messages as supplementary for nodes and explicitly enhances the compatibility matrix by a targeted constraint.
- Core assumption: Explicitly leveraging and improving the compatibility matrix can mitigate the impact of incomplete and noisy semantic neighborhoods.
- Evidence anchors:
  - [abstract] "To bridge this gap, we introduce a new approach named CMGNN, which operates within the HTMP mechanism to explicitly leverage and improve the compatibility matrix."
  - [section 5] "To fill this gap, we further propose a method named Compatibility Matrix-Aware GNN (CMGNN), which leverages the CM to construct desired neighborhood messages as supplementary, providing valuable neighborhood information for nodes to mitigate the impact of incomplete and noisy semantic neighborhoods."
  - [corpus] Weak evidence. No direct citations to CMGNN or similar explicit compatibility matrix enhancement methods in related works.
- Break condition: If the estimated compatibility matrix is inaccurate, leading to ineffective supplementary messages.

## Foundational Learning

- Concept: Graph Neural Networks (GNNs) and their message-passing mechanism.
  - Why needed here: Understanding the basic operation of GNNs and how they aggregate information from neighboring nodes is essential to grasp the motivation behind revisiting message passing in heterophilous graphs.
  - Quick check question: How do traditional GNNs aggregate information from neighboring nodes, and what is the role of the message-passing mechanism?

- Concept: Homophily and heterophily in graphs.
  - Why needed here: Recognizing the difference between homophilous and heterophilous graphs is crucial to understanding why the message-passing mechanism may not be suitable for heterophilous graphs and the need for heterophilous GNNs.
  - Quick check question: What is the difference between homophily and heterophily in graphs, and how do they affect the performance of GNNs?

- Concept: Compatibility matrix and its role in graph analysis.
  - Why needed here: Understanding the concept of the compatibility matrix and how it represents the connection preferences among classes is essential to grasp the paper's main findings and the motivation behind CMGNN.
  - Quick check question: What is the compatibility matrix, and how does it relate to the connection preferences among classes in a graph?

## Architecture Onboarding

- Component map: HTMP mechanism (aggregate -> combine -> fuse) -> CMGNN (compatibility matrix estimation -> supplementary neighborhood construction -> discrimination enhancement)

- Critical path:
  1. Revisit existing message-passing mechanisms in heterophilous GNNs and reformulate them into the HTMP mechanism
  2. Analyze the effectiveness of message passing in heterophilous graphs and its relation to the compatibility matrix
  3. Identify the limitations of implicit compatibility matrix enhancement due to incomplete and noisy semantic neighborhoods
  4. Propose CMGNN to explicitly leverage and improve the compatibility matrix, addressing the identified limitations
  5. Evaluate the performance of CMGNN on benchmark datasets and compare it with existing methods

- Design tradeoffs:
  - Balancing the complexity of the HTMP mechanism with the effectiveness of handling heterophily
  - Tradeoff between the accuracy of compatibility matrix estimation and the computational cost of constructing supplementary neighborhoods
  - Choosing between different neighborhood indicators, aggregation guidances, and combine functions within the HTMP mechanism

- Failure signatures:
  - Poor performance on heterophilous graphs with low discriminative compatibility matrices
  - Inability to handle nodes with incomplete and noisy semantic neighborhoods effectively
  - High computational cost due to the construction of supplementary neighborhoods and compatibility matrix estimation

- First 3 experiments:
  1. Implement the HTMP mechanism and reproduce the performance of existing heterophilous GNNs to validate the unified framework
  2. Conduct experiments on synthetic datasets with varying levels of homophily, compatibility matrix discriminability, and node degrees to analyze the impact on simple GNNs
  3. Implement CMGNN and evaluate its performance on benchmark datasets, comparing it with existing methods and ablation studies to assess the effectiveness of explicit compatibility matrix enhancement

## Open Questions the Paper Calls Out

### Open Question 1
- Question: What is the precise mathematical relationship between the discriminability of the compatibility matrix and the performance of message passing on heterophilous graphs?
- Basis in paper: [explicit] The paper states that the success of message passing in HTGNNs is attributed to implicitly enhancing the compatibility matrix and that discriminability among classes in the CM is crucial.
- Why unresolved: While the paper demonstrates that enhancing CM discriminability improves performance, it does not quantify the exact relationship between CM discriminability metrics and node classification accuracy.
- What evidence would resolve it: Controlled experiments varying CM discriminability levels while measuring performance, along with statistical analysis of the correlation between discriminability metrics and accuracy.

### Open Question 2
- Question: How does the effectiveness of the supplementary neighborhood mechanism scale with the number of classes in a graph?
- Basis in paper: [inferred] The paper introduces supplementary neighborhood messages using class prototypes, but doesn't extensively analyze how this mechanism performs as class count increases.
- Why unresolved: The paper demonstrates effectiveness on datasets with 3-18 classes but doesn't provide a systematic analysis of scalability with class count.
- What evidence would resolve it: Experiments on synthetic graphs with varying numbers of classes, measuring performance and computational overhead as class count increases.

### Open Question 3
- Question: What are the theoretical limits of compatibility matrix estimation accuracy in semi-supervised settings with limited labeled data?
- Basis in paper: [explicit] The paper introduces a method for estimating the compatibility matrix using confidence-weighted pseudo labels from semi-supervised learning.
- Why unresolved: The paper doesn't analyze the theoretical bounds or limitations of this estimation approach, particularly in extremely low-label scenarios.
- What evidence would resolve it: Theoretical analysis of estimation error bounds and empirical studies on graphs with varying ratios of labeled to unlabeled nodes.

## Limitations
- The theoretical analysis connecting message passing to compatibility matrix enhancement relies heavily on empirical observations rather than rigorous proofs
- The claim that existing HTGNNs implicitly enhance compatibility matrices is supported by observational evidence but lacks direct analytical validation
- The paper assumes that real-world graphs have inherently incomplete and noisy semantic neighborhoods, but this assumption is not thoroughly validated across diverse datasets

## Confidence

- Mechanism 1 (Implicit CM enhancement): Medium - observational evidence exists but lacks rigorous proof
- Mechanism 2 (Incomplete/noisy neighborhoods): Medium - reasonable assumption but limited empirical validation
- Mechanism 3 (CMGNN effectiveness): High - strong empirical results across multiple benchmarks

## Next Checks
1. Conduct ablation studies on synthetic graphs with controlled homophily levels to isolate the effect of compatibility matrix enhancement on performance
2. Implement theoretical analysis to formally prove the relationship between message passing operations and compatibility matrix discriminability
3. Test CMGNN on graphs with known ground truth compatibility matrices to validate the effectiveness of the explicit enhancement approach