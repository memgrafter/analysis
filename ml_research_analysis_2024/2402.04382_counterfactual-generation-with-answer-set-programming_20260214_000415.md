---
ver: rpa2
title: Counterfactual Generation with Answer Set Programming
arxiv_id: '2402.04382'
source_url: https://arxiv.org/abs/2402.04382
tags:
- counterfactual
- features
- rules
- feature
- relationship
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper presents a framework called CFGS (Counterfactual Generation
  with s(CASP)) for generating counterfactual explanations from rule-based machine
  learning models. The framework uses answer set programming (ASP) and the s(CASP)
  goal-directed ASP system to automatically generate counterfactual explanations that
  take into account causal dependencies between features.
---

# Counterfactual Generation with Answer Set Programming

## Quick Facts
- arXiv ID: 2402.04382
- Source URL: https://arxiv.org/abs/2402.04382
- Authors: Sopam Dasgupta; Farhad Shakerin; JoaquÃ­n Arias; Elmer Salazar; Gopal Gupta
- Reference count: 31
- Key outcome: Presents CFGS framework for generating counterfactual explanations from rule-based ML models using ASP and s(CASP)

## Executive Summary
This paper introduces CFGS (Counterfactual Generation with s(CASP)), a framework that leverages answer set programming (ASP) and the s(CASP) goal-directed ASP system to generate counterfactual explanations from rule-based machine learning models. The framework constructs counterfactual explanations by navigating between imagined pre-intervention and post-intervention worlds, using ASP rules to model both scenarios and enable logical inference. CFGS can generate counterfactuals regardless of the RBML algorithm used, incorporating causal dependencies between features and allowing control over feature mutability and intervention costs.

## Method Summary
The CFGS framework takes rule-based ML models and translates them into ASP syntax, defining two worlds: the original instance with undesired outcome and the counterfactual instance with desired outcome. It uses s(CASP)'s dual rules to constructively execute negated queries, enabling traversal between these worlds. The framework incorporates causal rules to ensure realistic counterfactuals, applies mutability constraints to restrict which features can be changed, and measures intervention costs as the sum of changed features. Experiments demonstrate the framework's ability to efficiently compute counterfactual explanations while considering causal dependencies and feature constraints.

## Key Results
- CFGS can generate counterfactual explanations from any RBML algorithm that produces interpretable rules
- The framework successfully incorporates causal dependencies to produce realistic counterfactuals
- Experiments show efficient computation of counterfactuals with controlled intervention costs and feature mutability

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The framework generates counterfactual explanations by navigating between imagined worlds using ASP-based logical inference.
- Mechanism: The system defines pre-intervention (undesired outcome) and post-intervention (desired outcome) worlds, using ASP rules and s(CASP)'s dual rules to constructively execute negated queries and traverse between worlds.
- Core assumption: RBML rules are expressible in ASP syntax and can be manipulated through negation and dual rules.
- Evidence anchors: [abstract] CFGS utilizes ASP and s(CASP) to generate counterfactual explanations from RBML rules; [section 4.7] Overall rule restricting interventions between original and counterfactual instances.
- Break condition: RBML rules cannot be translated to ASP or s(CASP) fails to generate dual rules for negated queries.

### Mechanism 2
- Claim: Causal dependencies between features are modeled to produce realistic counterfactuals.
- Mechanism: Framework incorporates causal rules defining how changing one feature affects others, constraining the solution space to ensure generated counterfactuals are realistic and achievable.
- Core assumption: Causal dependencies exist between features and can be identified or learned from data.
- Evidence anchors: [section 2.2] Focus on generating counterfactuals through achievable interventions; [section 4.2.1] Using domain knowledge to identify cause-effect relations and incorporate into algorithm.
- Break condition: Causal dependencies not accurately captured, leading to unrealistic or unachievable counterfactuals.

### Mechanism 3
- Claim: The framework allows control over feature mutability and intervention cost.
- Mechanism: Rules restrict which features can be changed (immutable vs. mutable) and intervention direction for numerical features, with cost measured as sum of changed features.
- Core assumption: Users can specify mutable features and change direction for numerical features.
- Evidence anchors: [section 4.5] Rules constraining interventions on features; [section 4.6.1] Cost definition as sum total of intervened features.
- Break condition: Cost function misaligned with user expectations or mutability constraints too restrictive.

## Foundational Learning

- Concept: Answer Set Programming (ASP) and s(CASP)
  - Why needed here: ASP provides declarative knowledge representation and reasoning about counterfactual scenarios; s(CASP) enables goal-directed execution and dual rule generation.
  - Quick check question: How does s(CASP) differ from traditional ASP systems in handling negation?

- Concept: Causal Inference
  - Why needed here: Understanding causal relationships between features is crucial for generating realistic counterfactuals.
  - Quick check question: What is the difference between correlation and causation in the context of feature dependencies?

- Concept: Rule-Based Machine Learning (RBML)
  - Why needed here: Framework operates on rules generated by RBML algorithms, requiring understanding of how these rules represent decision-making processes.
  - Quick check question: How do decision trees and rule-based models differ in representing feature interactions?

## Architecture Onboarding

- Component map: RBML Rules -> ASP Translation -> Pre-intervention and Post-intervention Worlds -> Dual Rule Generation -> Mutability Constraints -> Cost Computation -> Counterfactual Explanations

- Critical path:
  1. Translate RBML rules to ASP syntax
  2. Define feature domains and properties
  3. Incorporate causal rules
  4. Generate counterfactual rules using dual rules
  5. Apply mutability constraints and compute intervention costs

- Design tradeoffs:
  - Expressiveness vs. efficiency: More complex causal rules increase realism but may slow computation
  - Generality vs. specificity: Framework works with any RBML but may not capture all model nuances

- Failure signatures:
  - No counterfactual generated: RBML rules may not be translatable to ASP or causal rules may be too restrictive
  - Unrealistic counterfactuals: Causal rules may be missing or incorrectly specified

- First 3 experiments:
  1. Test with a simple loan approval example (as in section 3) to verify basic functionality
  2. Introduce causal dependencies between features and verify realistic counterfactual generation
  3. Apply mutability constraints and verify that immutable features are not changed in counterfactuals

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the CFGS framework perform in terms of computational efficiency and scalability when applied to larger and more complex datasets?
- Basis in paper: [explicit] Experiments run on various datasets including adult dataset, but no detailed results on computational efficiency and scalability.
- Why unresolved: Paper lacks comprehensive analysis of computational efficiency and scalability for larger, more complex datasets.
- What evidence would resolve it: Experiments on larger datasets measuring computational time and resources, comparing performance with other state-of-the-art methods.

### Open Question 2
- Question: How does the CFGS framework handle missing or incomplete data in the input features?
- Basis in paper: [inferred] Paper does not explicitly mention handling missing or incomplete data, a common issue in real-world datasets.
- Why unresolved: No information on how CFGS addresses missing or incomplete data, which could impact accuracy and reliability of generated counterfactual explanations.
- What evidence would resolve it: Experiments on datasets with missing or incomplete data evaluating CFGS performance in handling such scenarios.

### Open Question 3
- Question: How does the CFGS framework handle the case where the original decision-making rules are not available or not interpretable?
- Basis in paper: [explicit] Framework relies on decision-making rules from RBML algorithms, but does not address scenarios where these rules are unavailable or uninterpretable.
- Why unresolved: No information on how CFGS handles situations where original decision-making rules are not available or not interpretable, potentially limiting real-world applicability.
- What evidence would resolve it: Experiments on datasets without available or interpretable rules, evaluating CFGS performance with alternative approaches.

## Limitations
- Dependence on accurate translation of RBML rules into ASP syntax, with limited empirical validation across diverse RBML architectures
- Reliance on domain expert input for causal dependencies rather than automated causal discovery, limiting scalability
- Simplistic cost function (sum of changed features) that may not capture real-world intervention costs accurately

## Confidence
- High confidence in ASP-based counterfactual generation mechanism
- Medium confidence in causal dependency modeling approach
- Low confidence in generalizability across all RBML algorithms

## Next Checks
1. Test the framework with RBML models beyond decision trees and rule-based learners (e.g., neural networks with rule extraction)
2. Validate counterfactual realism by conducting user studies with domain experts to assess whether generated counterfactuals are actionable
3. Compare intervention costs using more sophisticated cost metrics (e.g., incorporating feature importance or user-defined weights)