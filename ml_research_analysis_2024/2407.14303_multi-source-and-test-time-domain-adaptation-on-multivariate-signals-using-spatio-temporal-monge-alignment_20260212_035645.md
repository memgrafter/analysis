---
ver: rpa2
title: Multi-Source and Test-Time Domain Adaptation on Multivariate Signals using
  Spatio-Temporal Monge Alignment
arxiv_id: '2407.14303'
source_url: https://arxiv.org/abs/2407.14303
tags:
- diag
- barycenter
- monge
- alignment
- mapping
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces Spatio-Temporal Monge Alignment (STMA), a
  method for multi-source and test-time domain adaptation of multivariate signals
  using optimal transport. STMA aligns signals' cross-power spectrum density to the
  Wasserstein barycenter of source domains, enabling predictions for new domains without
  retraining.
---

# Multi-Source and Test-Time Domain Adaptation on Multivariate Signals using Spatio-Temporal Monge Alignment

## Quick Facts
- arXiv ID: 2407.14303
- Source URL: https://arxiv.org/abs/2407.14303
- Authors: ThÃ©o Gnassounou; Antoine Collas; RÃ©mi Flamary; Karim Lounici; Alexandre Gramfort
- Reference count: 40
- Key outcome: STMA achieves multi-source and test-time domain adaptation by aligning cross-PSD to Wasserstein barycenter, improving performance on sleep staging and BCI tasks with O(n_l^(-1/2)) variance decay

## Executive Summary
This paper introduces Spatio-Temporal Monge Alignment (STMA), a method for domain adaptation of multivariate signals using optimal transport. STMA aligns signals' cross-power spectrum density to the Wasserstein barycenter of source domains, enabling predictions for new domains without retraining. The method leverages circulant matrix structure and Fourier transforms for efficient computation, with theoretical concentration bounds showing variance decay rates of O(n_l^(-1/2)). Experiments on sleep staging and BCI motor imagery tasks demonstrate significant performance improvements over state-of-the-art methods, particularly for low-performing subjects.

## Method Summary
STMA performs multi-source and test-time domain adaptation by aligning multivariate signals through optimal transport in the Fourier domain. The method estimates covariance matrices of source and target domains, computes the Wasserstein barycenter of source covariances, then learns a Monge mapping (convolution filter) that transforms each domain's covariance to match the barycenter. This alignment is performed efficiently using circulant matrix structure and FFT-based computations. The approach serves as a pre-processing step compatible with both shallow and deep learning methods, enabling domain adaptation without retraining predictors.

## Key Results
- STMA achieves significant performance improvements over state-of-the-art methods in sleep staging tasks, particularly for low-performing subjects
- The method demonstrates successful multi-source and test-time adaptation with theoretical concentration bounds showing variance decay of O(n_l^(-1/2))
- STMA provides a practical solution for aligning multivariate signals with spatial and temporal shifts without requiring retraining for new domains

## Why This Works (Mechanism)

### Mechanism 1
- Claim: STMA aligns the cross-power spectrum density (cross-PSD) of multivariate signals to the Wasserstein barycenter of source domains, enabling test-time adaptation without retraining.
- Mechanism: The method estimates covariance matrices of source and target domains, computes the Wasserstein barycenter of source covariances, then learns a Monge mapping (convolution filter) that transforms each domain's covariance to match the barycenter. This alignment is performed in the Fourier domain using circulant matrix structure for efficiency.
- Core assumption: Signals are stationary and periodic enough that their covariance matrices can be approximated as circulant, enabling diagonalization via FFT and efficient computation.
- Evidence anchors:
  - [abstract]: "STMA aligns signals' cross-power spectrum density to the Wasserstein barycenter of source domains"
  - [section]: "Under the Assumption 2, ðšº is re-written ðšº = ð… diag(ðª1,1) â€¦ diag(ðªð‘›ð‘ ,ð‘›ð‘ )ð…ð–§"
- Break condition: If signals are non-stationary or non-periodic, the circulant matrix assumption breaks and the method loses computational efficiency.

### Mechanism 2
- Claim: STMA achieves multi-source and test-time domain adaptation by performing a single fixed-point iteration to compute the Wasserstein barycenter, which provides good results without requiring iterative convergence.
- Mechanism: Instead of iterating to convergence, STMA initializes the barycenter as the Euclidean mean of source covariances and performs one fixed-point iteration. This provides a sufficiently accurate barycenter for alignment while maintaining computational efficiency.
- Core assumption: One iteration of barycenter computation is sufficient for practical performance, as convergence is fast in practice.
- Evidence anchors:
  - [section]: "In practice, for iterative methods we compute an approximation of the barycenter by initializing with the Euclidean mean over the domain's covariance matrices, and performing one fixed-point iteration"
  - [section]: "In contrast to the concentration bound proposed by [40], this bound includes a bias term resulting from the estimation of cross-PSDs using the Welch method"
- Break condition: If source domains have very different distributions or the signal length is too short, one iteration may not provide adequate barycenter estimation.

### Mechanism 3
- Claim: STMA provides a bias-variance tradeoff controlled by the filter size parameter f, where larger f reduces bias but increases variance in the Monge mapping estimation.
- Mechanism: The filter size f determines how much of the cross-PSD is preserved during alignment. Small f only adjusts high-frequency components (reducing variance but introducing bias), while large f attempts to match the entire cross-PSD (reducing bias but increasing variance). The optimal f balances these effects.
- Core assumption: The bias-variance tradeoff can be controlled by adjusting the filter size, allowing practitioners to tune based on their specific signal characteristics.
- Evidence anchors:
  - [section]: "The bigger the filter size is, the more the cross-PSD are well aligned"
  - [section]: "Figure 6 shows this trade-off with a dotted line, highlighting the optimal filter size"
- Break condition: If the signal has very low temporal correlation (Ï close to 0), the bias term becomes negligible and variance dominates regardless of filter size.

## Foundational Learning

- Concept: Optimal Transport (OT) between Gaussian distributions
  - Why needed here: STMA relies on Monge mappings between Gaussian distributions to align signals in the Fourier domain
  - Quick check question: What is the closed-form solution for the Monge mapping between two centered Gaussian distributions with covariances Î£s and Î£?

- Concept: Circulant matrices and their diagonalization via FFT
  - Why needed here: The method assumes signal covariances are circulant, enabling efficient computation through FFT
  - Quick check question: Why does the circulant structure of covariance matrices enable computational efficiency in STMA?

- Concept: Wasserstein barycenter computation
  - Why needed here: STMA uses the Wasserstein barycenter of source domains as the target for alignment
  - Quick check question: What is the fixed-point equation that defines the Wasserstein barycenter of multiple Gaussian distributions?

## Architecture Onboarding

- Component map: Covariance estimation -> Barycenter computation -> Monge mapping computation -> Predictor training -> Test-time prediction
- Critical path: Covariance estimation â†’ Barycenter computation â†’ Monge mapping â†’ Predictor training â†’ Test-time prediction
- Design tradeoffs:
  - STMA vs TMA vs SMA: STMA handles both spatial and temporal shifts but is most computationally expensive; TMA only handles temporal shifts and is linear in sensor count; SMA only handles spatial shifts and is independent of filter size
  - Filter size f: Larger f reduces bias but increases variance and computation time
  - Fixed-point iterations: More iterations improve barycenter accuracy but increase computation time
- Failure signatures:
  - Poor performance on non-stationary signals (circulant matrix assumption violated)
  - High variance in low SNR conditions (filter size too large)
  - Bias in highly correlated signals (filter size too small)
  - Computational bottlenecks with many sensors (STMA cubic complexity)
- First 3 experiments:
  1. Implement STMA on synthetic multivariate Gaussian signals with known shifts and verify alignment accuracy
  2. Compare STMA, TMA, and SMA on a simple BCI dataset to understand the impact of spatial vs temporal alignment
  3. Perform sensitivity analysis on filter size f using sleep staging data to find the optimal tradeoff for your specific application

## Open Questions the Paper Calls Out
None

## Limitations
- The circulant matrix assumption may not hold for non-stationary or highly non-periodic signals, potentially limiting the method's effectiveness
- The fixed-point iteration for barycenter computation with one iteration may not generalize to cases with highly diverse source domains
- The bias-variance tradeoff through filter size selection requires extensive hyperparameter tuning in practice

## Confidence
- **High confidence**: The core mathematical framework using Wasserstein barycenters and optimal transport for signal alignment is well-established and theoretically sound
- **Medium confidence**: The experimental results showing performance improvements over baselines, as they rely on specific datasets and evaluation protocols
- **Medium confidence**: The computational efficiency claims, as they depend on specific assumptions about signal properties and implementation details

## Next Checks
1. **Synthetic signal validation**: Generate synthetic multivariate signals with controlled spatial and temporal shifts to verify STMA's alignment accuracy under controlled conditions, testing both the circulant matrix assumption and the fixed-point iteration convergence

2. **Cross-dataset generalization**: Evaluate STMA on additional EEG datasets beyond the four used in the paper, particularly focusing on different signal characteristics (different brain states, recording conditions) to assess generalizability

3. **Computational scaling analysis**: Systematically evaluate the computational complexity of STMA versus baselines as the number of sensors increases beyond the 19 used in experiments, measuring both memory usage and runtime to validate the claimed efficiency advantages