---
ver: rpa2
title: What Are Good Positional Encodings for Directed Graphs?
arxiv_id: '2407.20912'
source_url: https://arxiv.org/abs/2407.20912
tags:
- walk
- directed
- graph
- graphs
- layer
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces walk profile, a bidirectional walk counting
  sequence for directed graphs, and proposes Multi-q Magnetic Laplacian PE to provably
  express it. The method uses multiple potential factors q in Magnetic Laplacians
  and extends stable PE frameworks to complex domains.
---

# What Are Good Positional Encodings for Directed Graphs?

## Quick Facts
- arXiv ID: 2407.20912
- Source URL: https://arxiv.org/abs/2407.20912
- Authors: Yinan Huang; Haoyu Wang; Pan Li
- Reference count: 40
- Primary result: Multi-q Magnetic Laplacian PE provably expresses walk profiles and outperforms existing PEs with up to 66% RMSE reduction

## Executive Summary
This paper introduces walk profile, a bidirectional walk counting sequence for directed graphs, and proposes Multi-q Magnetic Laplacian Positional Encoding (PE) to provably express it. The method uses multiple potential factors q in Magnetic Laplacians and extends stable PE frameworks to complex domains. Experiments show multi-q Mag-PE outperforms existing PEs in distance prediction, sorting network satisfiability, and circuit property tasks, with RMSE reductions up to 66% when using stable architectures.

## Method Summary
The paper develops Multi-q Magnetic Laplacian Positional Encoding by computing Magnetic Laplacians with multiple potential factors q, performing eigen-decomposition, and processing the resulting complex eigenvectors through a basis-invariant stable framework. The method provably expresses walk profiles through Fourier phase accumulation across multiple q values. The approach is evaluated on synthetic directed graphs and real-world circuit datasets using various backbone models including MLPs, GIN, Transformers, and SAT solvers.

## Key Results
- Multi-q Mag-PE outperforms existing PE methods in distance prediction with RMSE reductions up to 66%
- The method achieves 8.5% improvement in sorting network satisfiability F1 scores
- For circuit property prediction, multi-q Mag-PE shows significant improvements in gain, bandwidth, and phase margin prediction
- Stable PE frameworks consistently outperform naive concatenation methods when handling complex eigenvectors

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Using multiple potential factors q in Magnetic Laplacians allows lossless encoding of bidirectional walk profiles via Fourier phase accumulation.
- Mechanism: Each q acts as a frequency that records accumulated phase shifts for walks. Different q values give a spectrum of phase shifts that enables unique decoding of walk counts.
- Core assumption: The walk profile can be uniquely recovered from measurements [Aℓ_q] using the Fourier relationship Aℓ_q = exp(-i2πqℓ) * Σ Φ(ℓ,k) * exp(i4πqk).
- Evidence anchors:
  - [abstract]: "The new PE can provably express walk profiles."
  - [section 4.3]: "By the definition, one can find the following key formula that relates walk profile with Aℓ_q"
  - [corpus]: Weak - no direct evidence about Fourier phase accumulation from corpus papers
- Break condition: If q values are not distinct or if the number of q's is less than ⌈L/2⌉ + 1, the linear system becomes underdetermined and recovery fails.

### Mechanism 2
- Claim: The basis-invariant/stable neural architecture ensures consistent processing of complex eigenvectors despite unitary basis transformations.
- Mechanism: By processing real and imaginary parts separately through equivariant functions and then recombining, the framework produces representations invariant to basis transformations.
- Core assumption: The symmetric structure of complex eigenvectors (if v is an eigenvector, ve^iθ for any θ is also an eigenvector) can be handled by treating real and imaginary parts independently.
- Evidence anchors:
  - [section 4.4]: "Our framework will process PEs into stable representations" and "znode, zedge are continuous in the choice of q"
  - [abstract]: "we introduce the first basis-invariant and stable neural architecture to handle complex eigenvectors"
  - [corpus]: Weak - no corpus evidence about handling complex eigenvector basis ambiguity
- Break condition: If the equivariant functions are not properly designed, the invariance property breaks and representations become unstable.

### Mechanism 3
- Claim: Multi-q Mag-PE outperforms single-q methods because it can express structural features that single-q cannot capture.
- Mechanism: Single-q Mag-PE fails to distinguish between graphs with different walk profiles but identical eigenvalues/eigenvectors due to insufficient phase resolution.
- Core assumption: The phase information accumulated over walks contains critical structural information that single frequency cannot resolve.
- Evidence anchors:
  - [section 4.2]: "It turns out that it is impossible to recover Φu,v(m,k) from them" regarding Mag-PE
  - [section 5.1]: "Multi-q Mag-PE constantly outperforms other PE methods" in distance prediction
  - [corpus]: Moderate - "Relaxing Graph Transformers for Adversarial Attacks" suggests positional encodings are critical for graph transformers
- Break condition: If the walk profile features being predicted don't require high phase resolution, single-q might suffice.

## Foundational Learning

- Concept: Directed graph walk profiles
  - Why needed here: Understanding how bidirectional walks with different forward/backward edge combinations capture structural features
  - Quick check question: How does Φu,v(2,1) = (AA^T)u,v + (A^TA)u,v represent common successors/predecessors?

- Concept: Magnetic Laplacian with complex phases
  - Why needed here: The phase encoding mechanism that enables walk profile recovery through Fourier analysis
  - Quick check question: Why does the phase term exp(i2πq(2k-ℓ)) appear in the walk profile formula?

- Concept: Basis ambiguity in eigenvector representations
  - Why needed here: Understanding why stable architectures are needed to handle complex eigenvectors
  - Quick check question: Why does L = VΛV† = (VQ)Λ(VQ)† for any unitary matrix Q create problems for neural networks?

## Architecture Onboarding

- Component map: Graph → Magnetic Laplacians (multiple q) → Eigen-decomposition → Stable PE processing → Backbone model → Task prediction

- Critical path: Graph → Magnetic Laplacians (multiple q) → Eigen-decomposition → Stable PE processing → Backbone model → Task prediction

- Design tradeoffs:
  - Expressivity vs computational cost: More q values increase expressivity but require more eigen-decompositions
  - Stability vs simplicity: Complex basis handling adds implementation complexity but prevents instability
  - Feature dimension vs performance: Higher PE dimensions may help but risk overfitting

- Failure signatures:
  - Poor distance prediction accuracy despite high model capacity → Check if enough q values are used
  - Unstable training with complex eigenvectors → Verify stable PE framework implementation
  - No improvement over baselines → Check if basis-invariant processing is properly implemented

- First 3 experiments:
  1. Distance prediction on synthetic directed graphs with varying q counts (1, 3, 5) to verify expressivity gain
  2. Stability test: Add small perturbations to graph and measure PE consistency
  3. Ablation: Compare single-q vs multi-q on sorting network satisfiability task

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How many potential factors q are needed to perfectly recover walk profiles of length L?
- Basis in paper: [explicit] Theorem 4.2 states Q = ⌈L/2⌉ + 1 distinct q values are required
- Why unresolved: The paper proves this bound but doesn't empirically test whether fewer q values might suffice for practical tasks
- What evidence would resolve it: Experiments showing performance degradation as q values are reduced below ⌈L/2⌉ + 1

### Open Question 2
- Question: Does the choice between evenly-spaced vs randomly sampled q values affect performance in practice?
- Basis in paper: [explicit] Section 4.3 mentions both options but only briefly tests random q
- Why unresolved: The paper shows random q sometimes outperforms evenly-spaced q but doesn't systematically compare the two approaches
- What evidence would resolve it: Large-scale experiments comparing both strategies across multiple graph types and tasks

### Open Question 3
- Question: Can the stable PE framework be extended to handle complex eigenvectors in other graph learning tasks beyond those tested?
- Basis in paper: [explicit] Section 4.4 introduces the first stable PE framework for complex eigenvectors but only applies it to specific tasks
- Why unresolved: The paper demonstrates effectiveness on selected benchmarks but doesn't explore broader applicability
- What evidence would resolve it: Testing the framework on diverse graph learning problems like node classification, link prediction, and graph-level tasks

## Limitations
- The specific selection criteria for optimal q values and the exact implementation details of the stable PE framework remain underspecified
- The paper lacks direct empirical validation of the Fourier phase accumulation mechanism
- Limited scalability testing on large graphs beyond 71 nodes

## Confidence
**High confidence**: The walk profile definition and its mathematical relationship to Magnetic Laplacians is rigorously established. The computational framework for multi-q Mag-PE is clearly specified.

**Medium confidence**: The claims about phase accumulation and basis-invariant processing are theoretically sound but lack direct empirical validation. The downstream performance improvements are demonstrated but could be influenced by other factors beyond the PE improvements.

**Low confidence**: The specific selection criteria for optimal q values and the exact implementation details of the stable PE framework remain underspecified.

## Next Checks
1. **Direct Walk Profile Reconstruction**: Implement a controlled experiment measuring reconstruction error of Φ(ℓ,k) values from multi-q Mag-PE features on synthetic graphs where ground truth walk profiles are known.

2. **Phase Sensitivity Analysis**: Systematically vary the q values and measure how well different combinations can distinguish between graphs with different walk profiles but similar spectral properties.

3. **Basis Stability Testing**: Create pairs of graphs that differ only by unitary transformations of eigenvectors, then measure PE consistency under the stable framework versus naive concatenation methods.