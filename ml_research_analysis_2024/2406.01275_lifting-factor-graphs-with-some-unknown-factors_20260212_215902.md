---
ver: rpa2
title: Lifting Factor Graphs with Some Unknown Factors
arxiv_id: '2406.01275'
source_url: https://arxiv.org/abs/2406.01275
tags:
- factors
- unknown
- factor
- potentials
- known
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: The paper addresses the problem of performing probabilistic inference
  on factor graphs containing unknown factors, which leads to ill-defined semantics.
  The proposed solution is the LIFAGU algorithm, which generalizes the CP algorithm
  to handle unknown factors by identifying symmetric subgraphs and transferring known
  potentials to unknown factors.
---

# Lifting Factor Graphs with Some Unknown Factors

## Quick Facts
- arXiv ID: 2406.01275
- Source URL: https://arxiv.org/abs/2406.01275
- Reference count: 16
- Key outcome: LIFAGU generalizes CP algorithm to handle unknown factors by identifying symmetric subgraphs and transferring known potentials

## Executive Summary
This paper addresses the challenge of performing probabilistic inference on factor graphs with unknown factor potentials, which leads to ill-defined semantics. The proposed LIFAGU algorithm extends the Colour Passing (CP) algorithm by identifying symmetric subgraphs in the factor graph structure and transferring known potentials to unknown factors based on structural similarity. Under the key assumption that every unknown factor has at least one known factor with a symmetric surrounding graph structure, LIFAGU can replace all unknown potentials with known ones, ensuring well-defined semantics. Empirical results demonstrate high accuracy with mean KL divergence close to zero and significant computational speedups when using lifted variable elimination on the output parameterised factor graph.

## Method Summary
The LIFAGU algorithm works by first assigning unique colors to unknown factors and initial colors to known factors based on their potentials. It then computes 2-step neighborhoods for all factors and identifies possibly identical factors based on symmetric neighborhood structures. For each unknown factor, it collects candidate sets of known factors that could be identical, computes maximal subsets meeting a user-defined threshold θ, and transfers potentials from known to unknown factors when sufficient candidates exist. The algorithm then runs the CP algorithm on the modified graph and performs lifted variable elimination on the resulting parameterised factor graph, achieving computational efficiency through symmetry exploitation.

## Key Results
- Mean KL divergence between ground truth and LIFAGU results is close to zero across various graph sizes
- Lifted variable elimination on LIFAGU output is significantly faster than standard variable elimination, especially for larger graphs
- The approach successfully handles graphs with 5-10% unknown factors while maintaining accuracy

## Why This Works (Mechanism)

### Mechanism 1
- Claim: LIFAGU replaces all unknown potentials with known ones by identifying symmetric 2-step neighborhoods
- Mechanism: The algorithm uses the 2-step neighborhood of a factor (all randvars directly connected to it plus all factors connected to those randvars) to detect symmetric subgraphs. If two factors have symmetric 2-step neighborhoods, they are considered possibly identical. Known factors with symmetric structures can transfer their potentials to unknown factors
- Core assumption: For every unknown factor, there exists at least one known factor with a symmetric surrounding graph structure
- Evidence anchors:
  - [abstract]: "Under the assumption that for every unknown factor there exists at least one known factor with a symmetric surrounding graph structure, LIFAGU can replace all unknown potentials with known ones"
  - [section 3]: "Given that for every unknown factor fi there is at least one known factor that is possibly identical to fi in an FG G, LIFAGU is able to replace all unknown potentials in G by known potentials"
- Break condition: The assumption fails when no known factor has a symmetric 2-step neighborhood structure to an unknown factor, leaving some potentials unknown

### Mechanism 2
- Claim: LIFAGU generalizes the Colour Passing (CP) algorithm to handle unknown factors
- Mechanism: LIFAGU extends CP by assigning unique colors to unknown factors initially, then grouping them based on symmetric 2-step neighborhoods. It collects sets of known factors possibly identical to each unknown factor, and transfers potentials from known to unknown factors when a user-defined threshold is met
- Core assumption: The CP algorithm's color passing approach can be extended to handle unknown factors by using structural symmetry instead of potential-based grouping
- Evidence anchors:
  - [section 2.2]: "LIFAGU is a generalisation of the CP algorithm" and "It is easy to see that LIFAGU is a generalisation of CP"
  - [section 3]: "LIFAGU is able to handle arbitrary FGs, regardless of whether all factors are known or not"
- Break condition: If the threshold θ is too high, unknown factors may not be grouped with any known factors, leaving some potentials unknown

### Mechanism 3
- Claim: Lifted variable elimination on LIFAGU output is significantly faster than standard variable elimination
- Mechanism: By grouping symmetric factors and randvars into parameterised representations, LIFAGU creates a more compact PFG. Lifted variable elimination operates on these parameterised representations, reducing computational complexity from exponential in domain size to polynomial in the number of groups
- Core assumption: The symmetry detection and grouping performed by LIFAGU creates sufficiently compact parameterised representations to yield computational savings
- Evidence anchors:
  - [abstract]: "Lifted variable elimination on the output PFG is significantly faster than standard variable elimination, especially for larger graphs"
  - [section 4]: "As expected, lifted variable elimination is faster than variable elimination for larger graphs and the run time of lifted variable elimination increases more slowly with increasing graph sizes"
- Break condition: When the PFG contains many small groups (as in the evaluation), the computational savings diminish and standard variable elimination may be comparable or faster

## Foundational Learning

- Concept: Factor Graphs and Probabilistic Inference
  - Why needed here: The paper builds on factor graphs as the underlying representation for probabilistic models, and the entire method depends on understanding how factors encode probability distributions
  - Quick check question: What is the semantics of a factor graph and how does it represent a joint probability distribution?

- Concept: Lifted Inference and Parameterised Factor Graphs
  - Why needed here: LIFAGU's core contribution is extending lifted inference techniques to handle unknown factors by exploiting symmetries in the graph structure
  - Quick check question: How does lifting exploit symmetries in probabilistic graphical models to enable more efficient inference?

- Concept: Graph Isomorphism and Symmetric Structures
  - Why needed here: The algorithm relies on detecting symmetric 2-step neighborhoods as a computationally tractable proxy for graph isomorphism to group factors
  - Quick check question: Why does LIFAGU use symmetric 2-step neighborhoods instead of exact graph isomorphism, and what computational problem does this avoid?

## Architecture Onboarding

- Component map:
  Input FG with known and unknown factors -> Color assignment module -> 2-step neighborhood detector -> Possibly identical factor detector -> Candidate collection module -> Threshold-based grouping -> CP Algorithm wrapper -> Lifted inference engine

- Critical path:
  1. Initial color assignment
  2. Compute 2-step neighborhoods for all factors
  3. Identify possibly identical factors
  4. Collect candidate sets Cfi
  5. Compute maximal subsets Cℓfi
  6. Apply threshold θ to transfer potentials
  7. Run CP Algorithm on modified graph
  8. Perform lifted inference on resulting PFG

- Design tradeoffs:
  - Using 2-step neighborhoods vs. larger neighborhoods: 2-step is computationally tractable but may miss some symmetries that would be detected with larger neighborhoods
  - Threshold θ selection: Lower thresholds increase the chance of grouping unknowns with knowns but may reduce accuracy; higher thresholds improve accuracy but may leave some unknowns ungrouped
  - Symmetry detection method: Using symmetric 2-step neighborhoods avoids NP-hard graph isomorphism but may be less precise

- Failure signatures:
  - Unknown factors remain uncolored after LIFAGU: indicates threshold too high or insufficient symmetric structures
  - KL divergence significantly above zero: indicates incorrect grouping of factors with different potentials
  - Runtime similar to standard VE: indicates PFG not sufficiently compact (many small groups)
  - LIFAGU runtime dominates total: indicates neighborhood computation or symmetry checking is inefficient for graph size

- First 3 experiments:
  1. Run LIFAGU on a small FG with 5-10 randvars and 2-3 known factors, 20% unknown factors, verify output PFG has no unknown potentials
  2. Test threshold sensitivity: run same FG with θ=0, θ=0.5, θ=1.0, measure KL divergence and check which unknowns get grouped
  3. Performance scaling: create FGs of increasing size (2^d randvars), measure LIFAGU runtime and compare lifted VE vs standard VE runtime on output

## Open Questions the Paper Calls Out

### Open Question 1
- Question: What is the theoretical upper bound on the accuracy of LIFAGU in terms of KL divergence when transferring potentials from known to unknown factors?
- Basis in paper: [inferred] The paper reports mean KL divergence close to zero in empirical evaluation but does not establish theoretical bounds on the maximum possible error
- Why unresolved: The algorithm's accuracy depends on the similarity between unknown and known factor neighborhoods, which varies across different graph structures and potential distributions
- What evidence would resolve it: A formal proof establishing worst-case bounds on KL divergence based on graph structure properties and potential similarity metrics

### Open Question 2
- Question: How does the choice of neighborhood size (currently fixed at 2-step) affect LIFAGU's accuracy and computational efficiency?
- Basis in paper: [explicit] The paper uses 2-step neighborhoods based on "the idea of a single iteration of the colour passing procedure" but does not explore alternative neighborhood sizes
- Why unresolved: The paper does not investigate whether larger or smaller neighborhoods would improve accuracy or whether there's a trade-off between accuracy and computational cost
- What evidence would resolve it: Comparative evaluation of LIFAGU using different neighborhood sizes (1-step, 3-step, etc.) measuring both accuracy and runtime

### Open Question 3
- Question: Can LIFAGU be extended to handle continuous-valued potentials or non-Boolean random variables?
- Basis in paper: [explicit] The paper focuses on Boolean random variables and discrete potentials, with no discussion of continuous domains or non-Boolean variables
- Why unresolved: The symmetric neighborhood detection relies on discrete structure comparisons, and the color-passing mechanism assumes discrete value spaces
- What evidence would resolve it: Modified algorithm implementation and evaluation on continuous or non-Boolean domains, demonstrating whether the symmetry detection and potential transfer mechanisms generalize

## Limitations
- The algorithm's effectiveness critically depends on the assumption that every unknown factor has at least one known factor with a symmetric surrounding graph structure
- Using 2-step neighborhoods as a proxy for graph isomorphism may miss some symmetries that would be detected with more exhaustive approaches
- The empirical evaluation uses randomly generated factor graphs with only 5-10% unknown factors, which may not reflect real-world distributions

## Confidence
- High confidence: The core algorithmic mechanism of using symmetric 2-step neighborhoods to group factors is well-defined and theoretically sound
- Medium confidence: The empirical results showing KL divergence close to zero and runtime improvements for lifted inference are promising but based on synthetic data with specific parameters
- Low confidence: The paper's claim about handling arbitrary factor graphs "regardless of whether all factors are known or not" is conditional on the symmetry assumption, which is not quantified in terms of failure rates or limitations

## Next Checks
1. Create test cases where the symmetry assumption fails (no known factor has a symmetric structure to some unknown factors) and measure what fraction of unknown factors remain ungrouped by LIFAGU, along with the resulting KL divergence degradation
2. Systematically vary θ from 0 to 1 in increments of 0.1 across multiple graph sizes and unknown factor percentages, measuring the tradeoff between grouping success rate and KL divergence accuracy
3. Apply LIFAGU to a real-world probabilistic model (e.g., social network or biological network) with missing potentials, comparing performance against baseline methods when the symmetry assumption is violated or only partially satisfied