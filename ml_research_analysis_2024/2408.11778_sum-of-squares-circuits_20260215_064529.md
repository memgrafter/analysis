---
ver: rpa2
title: Sum of Squares Circuits
arxiv_id: '2408.11778'
source_url: https://arxiv.org/abs/2408.11778
tags:
- circuit
- squared
- complex
- units
- unit
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper explores the expressiveness trade-off in probabilistic
  circuits (PCs), focusing on the power of squared PCs and their sums. While squared
  PCs, which allow negative parameters, can be more expressive than monotonic PCs
  (with only positive parameters), the authors prove that squared PCs can still be
  less expressive than monotonic ones in certain cases.
---

# Sum of Squares Circuits

## Quick Facts
- arXiv ID: 2408.11778
- Source URL: https://arxiv.org/abs/2408.11778
- Authors: Lorenzo Loconte; Stefan Mengel; Antonio Vergari
- Reference count: 40
- Primary result: Introduces sum of squares circuits (Σ2cmp) that can be exponentially more expressive than monotonic and squared probabilistic circuits while preserving tractability

## Executive Summary
This paper addresses the expressiveness limitations of probabilistic circuits (PCs) by introducing a new class called sum of squares circuits (Σ2cmp). While squared PCs, which allow negative parameters, can be more expressive than monotonic PCs (with only positive parameters), the authors prove that squared PCs can still be less expressive than monotonic ones in certain cases. To overcome this limitation, they introduce Σ2cmp, which can be exponentially more expressive than both monotonic and squared PCs. The authors provide theoretical results establishing exponential separations between these classes and empirically validate the effectiveness of sum of squares circuits in distribution estimation tasks, demonstrating better performance than monotonic and squared PCs on real-world datasets.

## Method Summary
The paper introduces sum of squares circuits (Σ2cmp) as a novel class of probabilistic circuits that combine multiple squared circuits through summation. The method involves constructing compatible squared circuits and summing them to form a SOCS PC while preserving tractability. The empirical validation uses PyTorch implementations of tensorized PC architectures with sum, product, and input layers, trained using Adam optimizer on UCI repository datasets and image datasets. The training procedure involves monitoring validation metrics and stopping when no improvement is observed for specified epochs, with results reported as box plots from 5 random seeds.

## Key Results
- Proved that squared PCs can be less expressive than monotonic PCs in certain cases
- Introduced sum of squares circuits (Σ2cmp) that can be exponentially more expressive than both squared and monotonic PCs
- Demonstrated improved performance of Σ2cmp on UCI and image datasets compared to monotonic and squared PCs
- Showed that complex squared PCs can be efficiently reduced to real sum-of-squares PCs

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Sum of squares circuits (Σ2cmp) can be exponentially more expressive than both monotonic and squared PCs.
- Mechanism: By representing a function as a sum of multiple squared circuits, Σ2cmp can encode functions that cannot be compactly represented by a single squared PC or monotonic PC.
- Core assumption: Compatibility of squared circuits is preserved under summation.
- Evidence anchors:
  - [abstract] "we introduce a novel class of PCs -- sum of squares PCs -- that can be exponentially more expressive than both squared and monotonic PCs."
  - [section] "Theorem 2. There is a class of non-negative functions F over d variables that can be represented by a PC in Σ2cmp of size O(d3). However, (i) the smallest PC in +sd computing any F ∈ F has at least size 2Ω(√d), and (ii) the smallest c2 ∈ ±2R computing F obtained by squaring a structured-decomposable circuit c, requires |c| to be at least 2Ω(√d)."
- Break condition: If the squared circuits in the sum are not compatible, the resulting circuit may not preserve tractability.

### Mechanism 2
- Claim: Complex parameters do not provide an expressiveness advantage over real parameters in squared PCs.
- Mechanism: Any complex squared PC can be efficiently reduced to a PC in Σ2cmp with real parameters only.
- Core assumption: Complex squared PCs can be decomposed into real squared PCs.
- Evidence anchors:
  - [abstract] "we prove that squared complex circuits are sum of squares."
  - [section] "Corollary 1. Let c2 ∈ ±2C be a PC over variables X, where c is a structured-decomposable circuit computing a complex function. Then, we can efficiently representc2 as the sum of two compatible PCs in ±2R, thus as a PC in Σ2cmp."
- Break condition: If the reduction algorithm fails to preserve the structural properties of the complex squared PC.

### Mechanism 3
- Claim: Multiplying a monotonic PC with a SOCS PC (µSOCS) allows for compact encoding of an exponential number of squares.
- Mechanism: The product of a monotonic PC and a SOCS PC can be efficiently computed, resulting in a PC that compactly encodes a sum of an exponential number of squares.
- Core assumption: Compatibility between the monotonic PC and the SOCS PC is preserved under multiplication.
- Evidence anchors:
  - [abstract] "we build an expressiveness hierarchy that allows us to precisely unify and separate different tractable model classes such as Born Machines and PSD models."
  - [section] "Definition 5 ( ). A product of monotonic by SOCS (µSOCS) PC c over variables X is a PC encoding c(x) = c1(x)·c2(x), where c1 ∈ +sd and c2 ∈ Σ2cmp are compatible."
- Break condition: If the compatibility condition is violated, the resulting PC may not preserve tractability.

## Foundational Learning

- Concept: Structured-decomposable circuits
  - Why needed here: Structured-decomposability is a key property for efficient squaring and multiplication of circuits.
  - Quick check question: What is the difference between structured-decomposability and decomposability?

- Concept: Compatibility of circuits
  - Why needed here: Compatibility is required for efficient multiplication of circuits, which is used in squaring and summing squared circuits.
  - Quick check question: What are the two conditions for compatibility of circuits?

- Concept: Square root rank of matrices
  - Why needed here: Square root rank is used to prove lower bounds on the expressiveness of squared PCs.
  - Quick check question: How is the square root rank of a matrix defined?

## Architecture Onboarding

- Component map:
  Input units -> Sum units -> Product units -> Compatibility check -> Squaring algorithm -> Summing algorithm

- Critical path:
  1. Construct compatible squared circuits
  2. Sum the squared circuits to form a SOCS PC
  3. Ensure tractability of the resulting SOCS PC

- Design tradeoffs:
  - Expressiveness vs. tractability: Increasing expressiveness by allowing negative parameters or summing multiple circuits may compromise tractability.
  - Model size vs. accuracy: Larger models may achieve better accuracy but require more computational resources.

- Failure signatures:
  - Incompatible circuits: Circuits that cannot be efficiently multiplied due to structural differences.
  - Non-tractable SOCS PCs: SOCS PCs that lose tractability due to incompatible squared circuits in the sum.

- First 3 experiments:
  1. Construct a simple SOCS PC and verify its tractability.
  2. Compare the expressiveness of a SOCS PC with a monotonic PC on a simple function.
  3. Implement the compatibility check and squaring algorithm for circuits.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can any function computed by a polysize PC in +sd be also computed by a polysize PC in Σ2cmp?
- Basis in paper: [explicit] Section 6 discusses this open question, noting that it is unknown if there exists a sub-exponential size upper bound for a SOCS PC computing PCs in +sd.
- Why unresolved: The paper proves that every function computed by a PC in +sd can be encoded by a PC in Σ2cmp of size O(2^d), but it is not known if a polynomial size upper bound exists.
- What evidence would resolve it: A proof showing that for any polysize PC in +sd, there exists a polysize PC in Σ2cmp computing the same function, or a counterexample demonstrating a function that requires exponential size in Σ2cmp but is polysize in +sd.

### Open Question 2
- Question: Can any function computed by a polysize PC in ±sd be also computed by a polysize PC in Σ2cmp?
- Basis in paper: [explicit] Section 6 discusses this open question, noting that it is open to formally show whether any function computed by a structured-decomposable PC can be efficiently computed by a PC in Σ2cmp.
- Why unresolved: The paper shows that certain non-negative polynomials that can be computed by PCs in ±sd cannot be computed by SOCS PCs with polynomial input functions, but it is unknown if this limitation holds when the input functions are not restricted to polynomials.
- What evidence would resolve it: A proof showing that for any polysize PC in ±sd, there exists a polysize PC in Σ2cmp computing the same function, or a counterexample demonstrating a function that requires exponential size in Σ2cmp but is polysize in ±sd.

### Open Question 3
- Question: What is the precise relationship between the expressiveness of monotonic PCs and squared PCs?
- Basis in paper: [explicit] Section 3 proves that squared PCs can be less expressive than monotonic PCs in certain cases, but the paper does not provide a complete characterization of the expressiveness relationship between the two classes.
- Why unresolved: While the paper shows that there are functions that can be efficiently represented by monotonic PCs but require exponential size squared PCs, it does not provide a comprehensive understanding of the expressiveness trade-off between the two classes.
- What evidence would resolve it: A complete characterization of the functions that can be efficiently represented by each class, including a precise description of the class of functions that can be represented by both classes and the class of functions that can only be represented by one of the classes.

## Limitations

- Theoretical exponential separations may not translate to practical advantages in real-world applications
- Memory issues encountered when computing products for µSOCS PCs limit scalability
- Empirical validation relies on synthetic distribution estimation tasks rather than diverse real-world applications

## Confidence

- High confidence: The theoretical proofs establishing exponential separations between circuit classes are mathematically rigorous and well-structured.
- Medium confidence: The empirical results showing improved performance of Σ2cmp on UCI and image datasets, though limited by the absence of comparisons to state-of-the-art deep generative models.
- Medium confidence: The claim that complex squared PCs can be reduced to real sum-of-squares PCs, as the reduction's practical efficiency requires further validation.

## Next Checks

1. **Memory-efficient product computation**: Investigate whether alternative implementations of the LogSumExp semiring or distributed computing approaches can alleviate the memory bottlenecks observed when computing µSOCS PC products.

2. **Expressive efficiency benchmark**: Compare Σ2cmp against modern deep generative models (e.g., normalizing flows, VAEs) on high-dimensional datasets to quantify whether the theoretical expressiveness gains translate to practical advantages.

3. **Compatibility verification**: Systematically test the compatibility conditions across diverse circuit structures to identify scenarios where the tractability of sum-of-squares circuits breaks down in practice.