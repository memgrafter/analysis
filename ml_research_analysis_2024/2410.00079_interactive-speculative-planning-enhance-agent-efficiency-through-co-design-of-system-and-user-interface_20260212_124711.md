---
ver: rpa2
title: 'Interactive Speculative Planning: Enhance Agent Efficiency through Co-design
  of System and User Interface'
arxiv_id: '2410.00079'
source_url: https://arxiv.org/abs/2410.00079
tags:
- planning
- agent
- time
- step
- speculative
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the latency problem in LLM-based agent systems
  caused by large model sizes and complex agent structures. It introduces Interactive
  Speculative Planning, a method that combines an efficient approximation agent with
  a powerful target agent in a speculative decoding-like framework.
---

# Interactive Speculative Planning: Enhance Agent Efficiency through Co-design of System and User Interface

## Quick Facts
- **arXiv ID**: 2410.00079
- **Source URL**: https://arxiv.org/abs/2410.00079
- **Reference count**: 14
- **Primary result**: Up to 42.3% reduction in total generation time and 38.3% reduction in stepwise generation time through speculative planning with user intervention

## Executive Summary
This paper addresses the latency problem in LLM-based agent systems caused by large model sizes and complex agent structures. It introduces Interactive Speculative Planning, a method that combines an efficient approximation agent with a powerful target agent in a speculative decoding-like framework. The approach allows human users to interrupt and intervene during the planning process, making it more user-centric and efficient. Experiments on OpenAGI and TravelPlanner benchmarks show significant latency improvements: up to 42.3% reduction in total generation time and 38.3% reduction in stepwise generation time, depending on the setting. The method balances performance with efficiency and demonstrates that user intervention can further accelerate the process.

## Method Summary
The Interactive Speculative Planning algorithm combines two agent systems: an approximation agent (A) that generates steps quickly but potentially inaccurately, and a target agent (T) that verifies and refines A's steps to ensure accuracy. The method works by having A generate steps sequentially while T asynchronously verifies each step. If A's output matches T's, the process continues; otherwise, T's output replaces A's, and all subsequent steps based on the incorrect prefix are discarded. A user interface presents both A's and T's outputs sequentially, allowing users to interrupt the process and input their own values when they identify slow or incorrect steps. The system incorporates user input into the action trajectory and continues planning, with a rescheduling mechanism ensuring sequential presentation of outputs.

## Key Results
- Up to 42.3% reduction in total generation time across OpenAGI and TravelPlanner benchmarks
- Up to 38.3% reduction in stepwise generation time depending on the setting
- Significant latency improvements while maintaining or improving plan quality
- User intervention further accelerates the process by allowing corrections during prolonged computations

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Speculative planning reduces total generation time by overlapping computation of approximation and target agents.
- Mechanism: The approximation agent (A) generates steps sequentially, while the target agent (T) asynchronously verifies each step. If A's output matches T's, the process continues; otherwise, T's output replaces A's, and all subsequent steps based on the incorrect prefix are discarded.
- Core assumption: A is sufficiently fast that the time saved by overlapping computation outweighs the overhead of asynchronous calls and potential mismatches.
- Evidence anchors:
  - [abstract] "Experiments on OpenAGI and TravelPlanner benchmarks show significant latency improvements: up to 42.3% reduction in total generation time and 38.3% reduction in stepwise generation time, depending on the setting."
  - [section] "Figure 4: Comparing the time taken to generate the first two steps of a task by agent system using speculative planning and normal agent planning."
- Break condition: If A's accuracy is too low or its speed is not significantly faster than T, the overhead of mismatches and discarded computations may negate time savings.

### Mechanism 2
- Claim: User intervention further accelerates the process by providing correct intermediate steps when A or T are slow or incorrect.
- Mechanism: The UI presents both A's and T's outputs sequentially, allowing users to identify slow steps or incorrect outputs. Users can interrupt the process and input their own values, which are then incorporated into the action trajectory.
- Core assumption: Users can accurately identify slow or incorrect steps and provide correct intermediate values.
- Evidence anchors:
  - [abstract] "The approach allows human users to interrupt and intervene during the planning process, making it more user-centric and efficient."
  - [section] "For the second goal, we enable users to actively interrupt the program at any time."
- Break condition: If users are not actively monitoring the process or cannot provide correct intermediate values, the benefits of user intervention are diminished.

### Mechanism 3
- Claim: The co-design of the agent system and UI ensures a user-centric and efficient solution by managing user interactions and interruptions.
- Mechanism: The UI provides a sequential presentation of A's and T's outputs, minimizing perceived latency and allowing users to track the agents' progress. The system supports user interruptions and allows for backtracing to previous steps.
- Core assumption: The UI design effectively manages user interactions and interruptions without introducing significant overhead or complexity.
- Evidence anchors:
  - [abstract] "Our approach advocates for the co-design of the agent system and user interface, underscoring the importance of an agent system that can fluidly manage user interactions and interruptions."
  - [section] "The UI interface, together with the underlying system mechanism design, primarily addresses two key aspects: (1) what the users should see and (2) how the system can handle user interactions."
- Break condition: If the UI design is not intuitive or the system cannot handle user interruptions effectively, the benefits of co-design are diminished.

## Foundational Learning

- Concept: Speculative execution
  - Why needed here: Understanding speculative execution is crucial for grasping the core concept of speculative planning, where A generates steps speculatively while T verifies them.
  - Quick check question: How does speculative execution in hardware relate to speculative planning in LLM-based agents?

- Concept: Human-computer interaction (HCI)
  - Why needed here: HCI principles are essential for designing a user-centric UI that effectively manages user interactions and interruptions.
  - Quick check question: What are the key considerations in HCI for designing an interface that allows users to interrupt and intervene in a planning process?

- Concept: Asynchronous programming
  - Why needed here: Asynchronous programming is necessary for implementing the overlapping computation of A and T, which is a key component of speculative planning.
  - Quick check question: How does asynchronous programming enable the overlapping computation of A and T in speculative planning?

## Architecture Onboarding

- Component map:
  Approximation agent (A) -> Target agent (T) -> User Interface -> Rescheduling mechanism

- Critical path:
  1. User query is handled by speculative planning with A and T.
  2. A generates steps sequentially while T asynchronously verifies each step.
  3. UI presents outputs sequentially, allowing users to identify slow or incorrect steps.
  4. Users can interrupt the process and input their own values.
  5. System incorporates user input into the action trajectory and continues planning.

- Design tradeoffs:
  - Accuracy vs. speed: A is faster but less accurate than T, requiring a balance between speed and accuracy.
  - User intervention vs. automation: Allowing user intervention enhances user experience but may introduce overhead and complexity.
  - UI complexity vs. usability: A more complex UI may provide more features but may also be less intuitive for users.

- Failure signatures:
  - High mismatch rate between A and T: Indicates that A is not sufficiently accurate, leading to frequent discarding of steps.
  - Low user engagement: Suggests that the UI is not effective in encouraging user intervention.
  - High overhead from user interruptions: Indicates that the system is not efficiently managing user interruptions.

- First 3 experiments:
  1. Measure the impact of varying A's accuracy on latency improvement.
  2. Evaluate the effectiveness of different UI designs in encouraging user intervention.
  3. Test the system's performance under different levels of user engagement and interruption frequency.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the effectiveness of Interactive Speculative Planning vary across different domains and task complexities?
- Basis in paper: [inferred] The paper mentions "non-high-stakes areas" as a current limitation and notes that effectiveness varies with A's accuracy, but does not systematically study domain/task variation.
- Why unresolved: The paper only tests on OpenAGI and TravelPlanner benchmarks without exploring how performance scales across domains of varying complexity or requiring different reasoning types.
- What evidence would resolve it: Comprehensive experiments across diverse domains (e.g., medical, legal, creative writing, mathematical reasoning) showing performance patterns relative to task complexity, reasoning depth, and domain-specific knowledge requirements.

### Open Question 2
- Question: What is the optimal balance between approximation agent accuracy and computational speed for maximum time efficiency?
- Basis in paper: [explicit] The paper states "balancing time efficiency and cost efficiency becomes a critical topic" and notes that the current system may incur high additional cost.
- Why unresolved: While the paper explores various combinations of approximation and target agents, it does not provide a systematic framework for determining the optimal accuracy-speed trade-off for different use cases.
- What evidence would resolve it: A mathematical model or empirical framework showing how different accuracy-speed combinations of approximation agents affect overall system efficiency across various task types and user patience thresholds.

### Open Question 3
- Question: How can the security vulnerabilities associated with speculative execution in Interactive Speculative Planning be effectively mitigated?
- Basis in paper: [explicit] The paper dedicates a section to "Spectre" vulnerabilities, noting that "the execution of A's steps that are unverified or inconsistent with T's steps also introduces vulnerabilities."
- Why unresolved: The paper only proposes potential solutions (human-in-the-loop verification, isolated execution environments) without testing their effectiveness or exploring other mitigation strategies.
- What evidence would resolve it: Empirical studies comparing different security mitigation approaches in terms of their effectiveness at preventing malicious actions while maintaining system efficiency, along with formal security guarantees.

### Open Question 4
- Question: What is the optimal user interface design for Interactive Speculative Planning that maximizes both efficiency and user satisfaction?
- Basis in paper: [inferred] The paper notes limitations of the current UI, specifically that "users cannot change the result once it is fully presented" and that users must "closely monitor the algorithm's progress."
- Why unresolved: The paper presents a functional UI design but does not explore alternative designs, conduct user studies, or provide metrics for evaluating UI effectiveness.
- What evidence would resolve it: Comparative user studies with different UI designs measuring task completion time, user satisfaction scores, error rates, and cognitive load, along with A/B testing of various interaction patterns and information presentation formats.

## Limitations
- Speculative planning performance degrades significantly when approximation agent accuracy falls below 0.3-0.4
- User intervention effectiveness depends on active monitoring and accurate judgment, which may not generalize to all users
- Evaluation focuses primarily on time efficiency metrics while leaving performance and accuracy impacts less explored

## Confidence
- **High Confidence**: The core latency reduction mechanism through speculative execution is well-established and the experimental results showing 38.3-42.3% improvements in generation time are statistically robust across multiple benchmarks and settings.
- **Medium Confidence**: The user intervention benefits are demonstrated but the evaluation methodology relies on user study participation and assumes users can effectively identify and correct errors, which may not generalize to all user populations or task complexities.
- **Low Confidence**: The accuracy-preservation claims are not thoroughly validated. While the paper states performance is maintained, there is limited analysis of how often user interventions are needed, whether they improve or degrade outcomes, and how the system handles complex failure cases.

## Next Checks
1. **Accuracy Degradation Analysis**: Systematically measure how the approximation agent's accuracy threshold affects the net latency improvement across the full range of 0-1.0 accuracy values to identify the exact break-even point where speculative planning becomes detrimental.

2. **User Intervention Effectiveness Study**: Conduct a controlled experiment comparing expert vs. novice users' ability to identify and correct planning errors, measuring both intervention frequency and impact on final plan quality to validate the HCI assumptions.

3. **Rate Limit and Scalability Testing**: Implement a production-like deployment with concurrent API calls tracking to measure actual rate limit impacts and test the system's behavior under sustained high-load conditions with varying k values.