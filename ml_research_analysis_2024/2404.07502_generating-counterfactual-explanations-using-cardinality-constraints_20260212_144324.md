---
ver: rpa2
title: Generating Counterfactual Explanations Using Cardinality Constraints
arxiv_id: '2404.07502'
source_url: https://arxiv.org/abs/2404.07502
tags:
- counterfactuals
- features
- cardinality
- example
- original
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces cardinality constraints to improve the interpretability
  of counterfactual explanations. The proposed method extends the CERTIFAI framework
  by penalizing counterfactuals with more than k feature differences from the original
  example.
---

# Generating Counterfactual Explanations Using Cardinality Constraints

## Quick Facts
- arXiv ID: 2404.07502
- Source URL: https://arxiv.org/abs/2404.07502
- Authors: Rubén Ruiz-Torrubiano
- Reference count: 11
- Key outcome: This paper introduces cardinality constraints to improve the interpretability of counterfactual explanations. The proposed method extends the CERTIFAI framework by penalizing counterfactuals with more than k feature differences from the original example. Experiments on two datasets show that the constrained counterfactuals have lower average cardinality (e.g., 2 vs 3.1 features) while remaining effective at flipping predictions. The resulting sparse counterfactuals are more interpretable - for instance, changing just age and NaToK ratio suffices to alter the prediction, compared to the unconstrained case which required more extensive modifications.

## Executive Summary
This paper addresses the interpretability challenge in counterfactual explanations by introducing cardinality constraints to limit the number of features that can be modified. The method extends the CERTIFAI framework, which generates counterfactuals using a genetic algorithm, by adding a penalty term that enforces sparsity. The approach aims to create more actionable and understandable explanations by focusing on a minimal set of changes needed to alter a prediction. Experiments on two datasets demonstrate that the constrained method produces counterfactuals with fewer feature modifications while maintaining effectiveness.

## Method Summary
The method builds upon the CERTIFAI framework by incorporating a cardinality constraint into the genetic algorithm's fitness function. A linear penalty term is added to the optimization objective, with a large coefficient chosen to effectively enforce the constraint as hard. The genetic algorithm searches for counterfactuals that minimize both distance to the original example and cardinality violation. By penalizing solutions with more than k feature differences, the search is guided toward sparse explanations that are easier to interpret and act upon.

## Key Results
- Constrained counterfactuals have significantly lower average cardinality (e.g., 2 vs 3.1 features) compared to unconstrained CERTIFAI
- The cardinality-constrained explanations remain effective at flipping predictions on test datasets
- Sparse counterfactuals provide more interpretable explanations, requiring fewer feature changes to achieve the desired outcome

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Adding cardinality constraints to counterfactual generation forces the search to focus on fewer feature modifications, making explanations easier to interpret.
- Mechanism: The genetic algorithm optimizes a fitness function combining distance minimization and a cardinality penalty term. The penalty term grows linearly with the difference between the current counterfactual's feature count and the target k. This pushes the search away from high-cardinality solutions.
- Core assumption: The genetic algorithm can still find effective counterfactuals within the constrained feature space.
- Evidence anchors:
  - [abstract]: "We propose to explicitly add a cardinality constraint to counterfactual generation limiting how many features can be different from the original example."
  - [section]: "We implemented an additional cardinality constraint by penalizing those individuals with a cardinality (number of modified features with respect to the input example) higher than the target value k."
- Break condition: If no valid counterfactuals exist within the cardinality limit, the algorithm may fail to find any solution.

### Mechanism 2
- Claim: Sparse counterfactuals are more interpretable because fewer feature changes are easier for users to understand and act upon.
- Mechanism: By limiting the number of changed features, the counterfactual explanation becomes a simple statement like "change feature A and B to achieve the desired outcome" rather than a complex list of many changes.
- Core assumption: Interpretability is directly correlated with the number of changed features.
- Evidence anchors:
  - [abstract]: "such counterfactuals can have many different features than the original example, making their interpretation difficult."
  - [section]: "Interpreting such a counterfactual might be difficult, as the only feature that stays with the same value in this case is the gender."
- Break condition: If the original example is very close to the decision boundary, even a single feature change might be sufficient, making sparsity less relevant for interpretability.

### Mechanism 3
- Claim: The cardinality constraint acts as a hard constraint rather than a soft one due to the large coefficient in the penalty term.
- Mechanism: The coefficient ccard is chosen such that ccard*∆ >> max fitness, making any violation of the cardinality constraint extremely costly and effectively preventing the algorithm from considering such solutions.
- Core assumption: The genetic algorithm will avoid any solutions that violate the cardinality constraint due to the penalty.
- Evidence anchors:
  - [section]: "A linear penalty term was then calculated using a coefficient ccard that was chosen in such a way that it effectively resulted in the cardinality constraint being considered as a hard constraint."
- Break condition: If the coefficient is not large enough relative to the fitness function, the constraint may not be enforced strictly.

## Foundational Learning

- Concept: Genetic algorithms
  - Why needed here: The method uses a genetic algorithm to search for counterfactuals that balance proximity to the original example with the cardinality constraint.
  - Quick check question: How does a genetic algorithm balance exploration and exploitation in the search space?

- Concept: Counterfactual explanations
  - Why needed here: The paper extends the CERTIFAI framework for generating counterfactual explanations with cardinality constraints.
  - Quick check question: What makes a counterfactual explanation "valid" in the context of classification tasks?

- Concept: Interpretability metrics
  - Why needed here: The paper argues that sparse counterfactuals are more interpretable, but doesn't provide quantitative measures of interpretability.
  - Quick check question: How could we measure the interpretability of counterfactual explanations objectively?

## Architecture Onboarding

- Component map:
  CERTIFAI framework -> Genetic algorithm -> Distance function + Cardinality penalty -> Base ML model

- Critical path:
  1. Initialize population of counterfactual candidates
  2. Evaluate fitness (distance + cardinality penalty)
  3. Select parents for reproduction
  4. Apply crossover and mutation
  5. Repeat until convergence or max generations

- Design tradeoffs:
  - Sparsity vs. proximity: Tighter cardinality constraints may result in counterfactuals that are farther from the original example
  - Computational cost: More generations or larger population sizes may be needed to find valid counterfactuals within the constraints
  - Constraint flexibility: Hard constraints may fail to find solutions, while soft constraints may produce invalid explanations

- Failure signatures:
  - No valid counterfactuals found within max generations
  - Counterfactuals with high distance to original example
  - Inconsistent results across multiple runs

- First 3 experiments:
  1. Run CERTIFAI without cardinality constraints on a simple dataset to establish baseline performance
  2. Apply cardinality constraint with k=2 and compare the resulting counterfactuals' sparsity and distance
  3. Vary the coefficient ccard to find the minimum value that still enforces the cardinality constraint as hard

## Open Questions the Paper Calls Out
None

## Limitations
- The method's performance on high-dimensional datasets remains untested
- The interpretability claim relies on assumptions about user comprehension without empirical validation
- Computational overhead from the constrained search is not addressed

## Confidence
- High confidence in the mechanism of cardinality constraint enforcement through penalty terms
- Medium confidence in the interpretability benefits of sparse counterfactuals, as this relies on assumptions about user comprehension
- Low confidence in the method's generalizability to complex, high-dimensional datasets without further testing

## Next Checks
1. Test the method on high-dimensional datasets (e.g., >50 features) to evaluate scalability and performance degradation
2. Conduct user studies comparing interpretation accuracy between sparse and dense counterfactuals to empirically validate the interpretability claim
3. Experiment with varying the penalty coefficient ccard to find the optimal balance between constraint enforcement and solution quality across different datasets