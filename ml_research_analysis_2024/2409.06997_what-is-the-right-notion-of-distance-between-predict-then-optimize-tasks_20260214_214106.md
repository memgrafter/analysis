---
ver: rpa2
title: What is the Right Notion of Distance between Predict-then-Optimize Tasks?
arxiv_id: '2409.06997'
source_url: https://arxiv.org/abs/2409.06997
tags:
- distance
- dataset
- decision
- cost
- tasks
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces OTD3, a novel decision-aware dataset distance
  that integrates features, labels, and decisions to measure similarity between Predict-then-Optimize
  (PtO) tasks. Traditional OT-based distances focus on features and labels, but in
  PtO settings where performance is measured by decision regret, these are insufficient.
---

# What is the Right Notion of Distance between Predict-then-Optimize Tasks?

## Quick Facts
- arXiv ID: 2409.06997
- Source URL: https://arxiv.org/abs/2409.06997
- Authors: Paula Rodriguez-Diaz; Lingkai Kong; Kai Wang; David Alvarez-Melis; Milind Tambe
- Reference count: 38
- Primary result: Introduces OTD3, a decision-aware dataset distance that outperforms traditional OT-based distances in predicting transferability for Predict-then-Optimize tasks.

## Executive Summary
This paper addresses a critical gap in transfer learning for Predict-then-Optimize (PtO) tasks by introducing OTD3, a novel dataset distance that incorporates downstream optimization decisions alongside features and labels. Traditional OT-based distances fail to capture transferability in PtO settings because they ignore the decision space where performance is ultimately measured. OTD3 integrates a decision quality disparity function into the optimal transport framework, creating a metric that aligns with the actual objective of minimizing decision regret. The authors prove OTD3 defines a valid metric and derive a domain adaptation bound for PtO tasks using this distance.

## Method Summary
OTD3 extends traditional optimal transport-based dataset distances by incorporating a decision quality disparity function that measures how different decisions perform under different label distributions. The method defines a ground cost function as a convex combination of feature distance, label distance, and decision quality disparity, with weights (αX, αY, αW) that can be tuned to reflect the relative importance of each component. The OTD3 distance is computed by solving an optimal transport problem between two datasets, where each dataset consists of feature-label-decision triplets. The authors demonstrate the method across three diverse PtO tasks and show that optimal weights emphasize the decision component for tasks where decisions are most critical to performance.

## Key Results
- OTD3 better predicts transferability between PtO tasks than traditional feature-label distances alone
- Optimal weights for ground cost components vary by task, with decisions often being most important (αW > αX, αY)
- OTD3 captures task-specific nuances, particularly in complex environments where label changes don't directly correlate with decisions
- The method works across diverse PtO tasks including Linear Model Top-K, Warcraft Shortest Path, and Inventory Stock Problem

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Traditional OT-based dataset distances fail to capture transferability in PtO tasks because they ignore the decision space.
- Mechanism: In PtO, the ultimate performance metric is decision regret, not prediction error. Traditional distances only compare feature-label distributions, missing the critical link between predictions and downstream optimization outcomes. By incorporating a decision quality disparity function that measures how different decisions perform under different labels, the OTD3 distance aligns the similarity metric with the actual task objective.
- Core assumption: The decision quality disparity function (lg) accurately reflects the impact of decisions on the optimization objective.
- Evidence anchors:
  - [abstract]: "In this work, we propose OTD3... that incorporates downstream decisions in addition to features and labels."
  - [section 4.1]: "The metric in Z must accurately reflect decision quality regret... This means the metric should not only measure distances between feature-label-decision triplets but also incorporate the quality and impact of decisions."
- Break condition: If the decision quality disparity function does not correlate with actual decision regret, or if decisions do not meaningfully affect the optimization outcome, the mechanism fails.

### Mechanism 2
- Claim: OTD3 enables better prediction of transferability between PtO tasks by weighting the importance of features, labels, and decisions.
- Mechanism: By allowing flexible weighting of the ground cost components (αX, αY, αW), OTD3 can adapt to the specific importance of each component in a given PtO task. This is crucial because the relative importance of features, labels, and decisions varies across different optimization problems. For example, in the Warcraft Shortest Path task, the decision component is more important than the label component, while in the Inventory Stock problem, the label component is more critical.
- Core assumption: The optimal weights for the ground cost components can be determined through empirical analysis or theoretical considerations.
- Evidence anchors:
  - [section 4.3]: "In our approach, the weights on the ground cost components, α in Eq. 6, are pivotal in defining the dataset distance, offering a flexible framework to account for the varying importance of features, labels, and decisions in PtO tasks."
  - [section 5.2]: "Figure 2 illustrates the correlation strength (measured by the R-squared value from linear regression) between regret transfer and dataset distance for different weighting combinations α."
- Break condition: If the optimal weights cannot be determined or if the task-specific importance of components is not captured by the weighting scheme, the mechanism breaks down.

### Mechanism 3
- Claim: OTD3 provides a learning-free criterion for selecting source datasets for transfer learning in PtO tasks.
- Mechanism: By computing the OTD3 distance between source and target datasets, practitioners can identify the most similar source dataset to the target without requiring any model training or fine-tuning. This is particularly useful when resources are limited and only a single optimization instance is available. The OTD3 distance predicts the regret performance on the target dataset based on the model trained on the source dataset.
- Core assumption: The OTD3 distance is a reliable predictor of transferability in PtO tasks.
- Evidence anchors:
  - [abstract]: "Empirically, we show that our proposed distance measure accurately predicts transferability across three different PtO tasks from the literature."
  - [section 5.2]: "We evaluate how effectively our decision-aware dataset distance measures transferability between PtO tasks, we analyze the correlation between the distance from a source dataset DS to a target dataset DT and the regret achieved on DT by a model trained on DS."
- Break condition: If the OTD3 distance does not correlate with actual regret performance or if the assumption of learning-free transferability assessment is violated, the mechanism fails.

## Foundational Learning

- Concept: Optimal Transport (OT)
  - Why needed here: OT provides the mathematical framework for defining a principled distance between probability distributions, which is the basis for OTD3.
  - Quick check question: What is the Kantorovich formulation of the optimal transport problem?

- Concept: Predict-then-Optimize (PtO) Framework
  - Why needed here: OTD3 is specifically designed for PtO tasks, where predictions are used as inputs for downstream optimization problems.
  - Quick check question: How does the decision quality regret differ from the traditional prediction error in the PtO framework?

- Concept: Decision Quality Disparity
  - Why needed here: The decision quality disparity function is a key component of OTD3, capturing the impact of decisions on the optimization objective.
  - Quick check question: How does the decision quality disparity function differ from a traditional metric on the decision space?

## Architecture Onboarding

- Component map:
  - Feature space (X) -> Label space (Y) -> Decision space (Ω)
  - Ground cost function (cα P tO) -> Optimal transport problem -> OTD3 distance

- Critical path:
  1. Define the feature, label, and decision spaces for the PtO task
  2. Choose appropriate metrics for the feature and label spaces
  3. Define the decision quality disparity function
  4. Set the weights for the ground cost components
  5. Compute the OTD3 distance between datasets using optimal transport

- Design tradeoffs:
  - Flexibility vs. simplicity: Allowing flexible weights for the ground cost components increases the model's adaptability but also adds complexity
  - Accuracy vs. computational cost: Computing the OTD3 distance requires solving an optimal transport problem, which can be computationally expensive for large datasets

- Failure signatures:
  - Poor correlation between OTD3 distance and actual regret performance
  - Inability to capture the task-specific importance of features, labels, and decisions
  - High computational cost for large datasets

- First 3 experiments:
  1. Compute the OTD3 distance between two synthetic datasets with known feature-label-decision distributions
  2. Evaluate the correlation between OTD3 distance and regret performance on the Linear Model Top-K task
  3. Compare the transferability prediction of OTD3 with traditional feature-label distances on the Warcraft Shortest Path task

## Open Questions the Paper Calls Out
None

## Limitations
- The decision quality disparity function requires task-specific definition, limiting generalizability
- Optimal weights for ground cost components are determined empirically, suggesting potential sensitivity to hyperparameter tuning
- Computational complexity of solving the optimal transport problem may hinder scalability to large datasets

## Confidence

| Claim | Confidence Level |
|-------|------------------|
| Theoretical foundation of OTD3 as valid metric and domain adaptation bound derivation | High Confidence |
| Empirical results showing OTD3's superiority over traditional distances in predicting transferability | Medium Confidence |
| Generalizability of weighting scheme across diverse PtO domains and scalability to larger problems | Low Confidence |

## Next Checks
1. Test OTD3 on additional PtO tasks with varying optimization complexity to evaluate generalizability beyond the three studied domains
2. Investigate sensitivity of optimal weights to different distribution shift magnitudes and types to determine robustness of the weighting scheme
3. Benchmark computational efficiency against alternative similarity measures for larger-scale PtO problems to assess practical applicability