---
ver: rpa2
title: Hierarchical Spatio-Temporal State-Space Modeling for fMRI Analysis
arxiv_id: '2408.13074'
source_url: https://arxiv.org/abs/2408.13074
tags:
- mamba
- brain
- fmri
- fst-mamba
- arxiv
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces FST-Mamba, a hierarchical spatiotemporal
  state-space model for analyzing dynamic functional network connectivity (dFNC) from
  fMRI data. The model addresses the unique challenges of FNC data, including its
  symmetric nature and the importance of component-level and network-level topological
  priors.
---

# Hierarchical Spatio-Temporal State-Space Modeling for fMRI Analysis

## Quick Facts
- arXiv ID: 2408.13074
- Source URL: https://arxiv.org/abs/2408.13074
- Authors: Yuxiang Wei; Anees Abrol; Vince Calhoun
- Reference count: 40
- Key outcome: FST-Mamba achieves significant improvements over baseline methods for classifying sex, dementia, age, and fluid intelligence from dynamic functional network connectivity (dFNC) matrices, while identifying crucial brain connectivities and dynamics contributing to predictions.

## Executive Summary
This paper introduces FST-Mamba, a hierarchical spatiotemporal state-space model designed specifically for analyzing dynamic functional network connectivity (dFNC) from fMRI data. The model addresses the unique challenges of FNC data, including its symmetric nature and the importance of component-level and network-level topological priors. By employing separate spatial and temporal branches with component-wise varied-scale aggregation (CVA) and symmetric rotary position encoding (SymRope), FST-Mamba captures inter-network connectivity correlations while maintaining computational efficiency. Experiments on multiple datasets demonstrate significant improvements over baseline methods for various classification and regression tasks, with the model successfully identifying crucial brain connectivities and dynamics contributing to predictions.

## Method Summary
FST-Mamba processes dynamic FNC matrices through a hierarchical architecture with four stages. Each stage contains a connectivity Mamba encoder that processes spatial information using CVA to aggregate component-wise connections, and a temporal Mamba encoder that processes temporal dynamics. The model employs SymRope to encode positional relationships while preserving FNC's symmetric property. After each stage, patch merging with downsampling aggregates information at multiple scales. The final feature map is obtained through global average pooling and used for downstream classification or regression tasks. The model is trained using AdamW optimizer with cosine annealing for 200 epochs.

## Key Results
- FST-Mamba outperforms baseline methods across multiple datasets (HCP, UKB, ADNI) for sex, dementia, age, and fluid intelligence prediction tasks
- The model successfully identifies crucial brain connectivities and dynamics contributing to predictions, revealing potential biomarkers
- Periodogram analysis shows distinct temporal frequency patterns associated with different cognitive states and demographics

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The hierarchical decomposition of spatial and temporal processing allows FST-Mamba to capture multi-scale dynamics without the quadratic complexity of attention mechanisms.
- Mechanism: By processing spatial and temporal dimensions separately through distinct Mamba encoders, the model maintains linear complexity while effectively extracting both spatial connectivity patterns and temporal dynamics. The hierarchical structure with downsampling stages progressively aggregates information at multiple scales.
- Core assumption: Spatial and temporal processing can be effectively decoupled without losing critical inter-dependencies between space and time in brain connectivity data.
- Evidence anchors:
  - [abstract] "propose a hierarchical spatiotemporal Mamba-based network that processes spatial and temporal information separately using Mamba-based encoders"
  - [section] "We propose to individually extract temporal and spatial information to avoid information loss"
  - [corpus] Weak - corpus focuses on other applications of Mamba rather than the spatial-temporal decomposition specifically for fMRI
- Break condition: If brain connectivity patterns show strong non-separable space-time interactions that require joint processing, the decoupled approach may miss critical dependencies.

### Mechanism 2
- Claim: The Component-Wise Varied-Scale Aggregation (CVA) mechanism effectively captures inter-network connectivity correlations by reducing the relative distance between component connections during sequential scanning.
- Mechanism: CVA transforms the N×N connectivity matrix into k sequences where each sequence contains connectivity features across all networks. By using sliding windows with decreasing step sizes across stages, CVA progressively captures both local component-level and global network-level information.
- Core assumption: The topological structure of brain networks can be effectively preserved through this aggregation approach, maintaining meaningful relationships between components.
- Evidence anchors:
  - [section] "we introduce a component-wise varied-scale aggregation (CVA) mechanism to aggregate component-wise connections from networks across the brain"
  - [section] "By reducing the relative distance during sequential scanning, CVA allows the Mamba encoder to effectively capture inter-network connectivity correlations"
  - [corpus] Weak - corpus doesn't provide direct evidence about CVA's effectiveness, though it mentions related work on brain network analysis
- Break condition: If the aggregation process loses critical fine-grained connectivity information between components that are not adjacent in the network structure.

### Mechanism 3
- Claim: Symmetric Rotary Position Encoding (SymRope) preserves the symmetric property of FNC matrices while encoding relative positional relationships between connections.
- Mechanism: SymRope modifies standard rotary position encoding to ensure Rx,y = Ry,x for symmetric entries, maintaining the symmetric nature of the FNC matrix while encoding relative positions. The "unRope" operation after each stage prevents artifacts from accumulating positional encoding.
- Core assumption: The symmetric property of FNC matrices is crucial for maintaining accurate functional relationships between brain components.
- Evidence anchors:
  - [section] "we propose symmetric rotary position encoding (SymRope) to encode relative positional relationships between connections, while tailoring for the symmetric property of FNC"
  - [section] "symmetrical entries should be encoded with the same positional information, i.e., Rx,y = Ry,x"
  - [corpus] Weak - corpus doesn't directly address symmetric position encoding for fMRI data
- Break condition: If the symmetric constraint overly restricts the model's ability to learn asymmetric functional relationships that may exist in certain brain states.

## Foundational Learning

- Concept: State Space Models (SSM) and their discrete formulation
  - Why needed here: Understanding the foundation of Mamba and how SSMs map sequences to responses through latent spaces is crucial for grasping the model's architecture
  - Quick check question: How does the discretization of SSM (Equation 1) transform the continuous system into a discrete-time model?

- Concept: Brain network topology and functional connectivity
  - Why needed here: The FNC matrix's symmetric nature and the importance of component-level and network-level topological priors are central to the model's design
  - Quick check question: Why is the FNC matrix symmetric, and what does this symmetry represent in terms of brain connectivity?

- Concept: Position encoding in sequence models
  - Why needed here: SymRope is a key innovation that addresses the unique challenges of encoding positional information in symmetric matrices
  - Quick check question: How does standard rotary position encoding differ from SymRope in handling symmetric matrices?

## Architecture Onboarding

- Component map:
  Input FNC matrix → Linear embedding → FST-Mamba blocks → Patch merging layers → Average pooling → Feature map

- Critical path:
  1. Input FNC matrix → Linear embedding (channel expansion)
  2. FST-Mamba blocks process spatial and temporal information separately
  3. CVA aggregates component-wise connections across networks
  4. SymRope encodes positional information
  5. Patch merging downsamples and processes at multiple scales
  6. Average pooling produces final feature representation

- Design tradeoffs:
  - Spatial-temporal separation vs. joint processing: The decoupled approach reduces complexity but may miss some space-time interactions
  - CVA aggregation: Balances component-level detail with network-level patterns but may lose some fine-grained connectivity
  - SymRope symmetry constraint: Preserves FNC properties but may limit learning of asymmetric relationships

- Failure signatures:
  - Poor performance on tasks requiring fine-grained component-level distinctions
  - Inability to capture space-time interactions unique to certain brain states
  - Degradation when FNC matrices show significant asymmetry in pathological conditions

- First 3 experiments:
  1. Ablation study removing CVA to assess its contribution to performance
  2. Comparison with joint spatial-temporal processing to evaluate the decoupling approach
  3. Testing with asymmetric FNC matrices to evaluate SymRope's flexibility

## Open Questions the Paper Calls Out

The paper doesn't explicitly call out specific open questions, but based on the limitations section and discussion, several important areas for future work emerge:

- Scalability and pretraining: How to scale FST-Mamba to larger datasets and leverage pretraining strategies for improved performance
- Cross-dataset generalization: How well the model performs across different populations and scanning protocols
- Interpretability of learned representations: Understanding the specific brain connectivities and dynamics that drive predictions
- Integration with other modalities: How to combine fMRI with other imaging or behavioral data for more comprehensive analysis

## Limitations

- Spatial-temporal decoupling may miss critical space-time interactions in brain connectivity patterns
- CVA aggregation parameters and step size reduction strategy are not fully specified
- SymRope's symmetric constraint may limit learning of asymmetric functional relationships
- Limited evaluation to specific demographics and dementia, with unclear generalizability to other cognitive states

## Confidence

- **High Confidence**: The hierarchical architecture design and use of Mamba-based encoders for linear complexity processing
- **Medium Confidence**: The effectiveness of CVA for capturing inter-network connectivity correlations and SymRope for symmetric position encoding
- **Low Confidence**: The generalizability of the decoupled spatial-temporal approach to all types of brain connectivity patterns

## Next Checks

1. **Ablation Study**: Remove CVA and evaluate performance degradation to quantify its contribution to the overall model effectiveness
2. **Joint Processing Comparison**: Implement and compare against a joint spatial-temporal processing variant to assess whether decoupling introduces information loss
3. **Asymmetric FNC Testing**: Test the model on datasets with known asymmetric connectivity patterns to evaluate SymRope's flexibility and identify potential limitations