---
ver: rpa2
title: Training Unbiased Diffusion Models From Biased Dataset
arxiv_id: '2403.01189'
source_url: https://arxiv.org/abs/2403.01189
tags:
- bias
- data
- diffusion
- ratio
- conference
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper tackles the challenge of dataset bias in diffusion models,
  where generated outputs directly suffer from underlying bias in the training data.
  The authors propose a novel method called Time-dependent Importance reWeighting
  (TIW) that leverages a time-dependent density ratio for both reweighting and score
  correction.
---

# Training Unbiased Diffusion Models From Biased Dataset

## Quick Facts
- arXiv ID: 2403.01189
- Source URL: https://arxiv.org/abs/2403.01189
- Authors: Yeongmin Kim; Byeonghu Na; Minsang Park; JoonHo Jang; Dongjun Kim; Wanmo Kang; Il-Chul Moon
- Reference count: 40
- Key outcome: Novel method (TIW) for mitigating dataset bias in diffusion models by leveraging time-dependent density ratios for both reweighting and score correction, achieving lower FID scores and more representative outputs.

## Executive Summary
This paper addresses the challenge of dataset bias in diffusion models, where generated outputs inherit biases from the training data. The authors propose a novel method called Time-dependent Importance reWeighting (TIW) that leverages a time-dependent density ratio for both reweighting and score correction. By using a time-dependent discriminator to estimate the density ratio between perturbed biased and unbiased distributions, TIW enables more accurate density ratio estimation compared to previous approaches. The paper establishes a theoretical connection between TIW and traditional score-matching objectives, ensuring convergence to an unbiased distribution. Experimental results on various datasets demonstrate that TIW outperforms baselines in mitigating dataset bias and generating high-quality, unbiased samples.

## Method Summary
The proposed method, TIW-DSM, consists of two main components: a time-dependent discriminator and a diffusion model trained with a modified score matching objective. The time-dependent discriminator is trained to estimate the density ratio between perturbed biased and unbiased distributions at each diffusion timestep. This density ratio is then used in the TIW-DSM objective for two purposes: reweighting samples to emphasize unbiased ones, and correcting the score direction to point toward the unbiased distribution. The resulting objective is theoretically equivalent to standard score matching on unbiased data, ensuring convergence to an unbiased distribution. The method requires a small unbiased reference dataset (Dref) and a larger biased dataset (Dbias) for training.

## Key Results
- TIW achieves lower FID scores compared to other methods, indicating better sample quality and diversity.
- The proposed method effectively addresses the issue of dataset bias in diffusion models, enabling the generation of more representative and fair outputs.
- Performance improves as the reference size increases for all methods, but TIW shows superior performance even with limited reference data.

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Time-dependent density ratio estimation is more accurate than time-independent approaches because diffusion makes biased and unbiased distributions closer over time.
- Mechanism: The forward diffusion process gradually perturbs both biased and unbiased distributions, reducing their distance. This makes density ratio estimation easier as time progresses.
- Core assumption: The diffusion process makes the two distributions converge toward a shared Gaussian noise distribution.
- Evidence anchors:
  - [abstract]: "We demonstrate that the time-dependent density ratio becomes more precise than previous approaches, thereby minimizing error propagation in generative learning."
  - [section]: "Figure 2 shows the accuracy of density ratio estimation over the diffusion time interval t ∈ [0, T]. The density ratio estimation error decreases rapidly as t increases."
  - [corpus]: Weak evidence - related papers focus on diffusion and importance sampling but don't directly address time-dependent density ratios.
- Break condition: If the diffusion process doesn't sufficiently reduce the distributional distance, or if perturbation destabilizes density ratio estimation.

### Mechanism 2
- Claim: Dual use of time-dependent density ratio (reweighting + score correction) enables tractable unbiased score matching.
- Mechanism: The time-dependent density ratio serves two purposes: reweighting samples to emphasize unbiased ones, and correcting the score direction to point toward the unbiased distribution.
- Core assumption: The time-dependent density ratio can be accurately estimated and simultaneously used for both reweighting and score correction without introducing intractable terms.
- Evidence anchors:
  - [abstract]: "While directly applying it to score-matching is intractable, we discover that using the time-dependent density ratio both for reweighting and score correction can lead to a tractable form of the objective function to regenerate the unbiased data density."
  - [section]: "By utilizing these dual roles by density ratios, simultaneously; we render the objective function tractable and establish a theoretical equivalence with existing score-matching objectives from unbiased distributions."
  - [corpus]: Weak evidence - related work discusses density ratio estimation but not in the context of dual-purpose use in diffusion models.
- Break condition: If the density ratio estimation is inaccurate or if the dual roles create computational intractability.

### Mechanism 3
- Claim: The proposed objective is theoretically equivalent to standard score matching on unbiased data, ensuring convergence to unbiased distribution.
- Mechanism: The TIW-DSM objective can be shown to be equivalent to the standard denoising score matching objective up to a constant, which guarantees that optimization converges to the unbiased data distribution.
- Core assumption: The mathematical equivalence holds under optimal density ratio estimation and that the optimization landscape preserves this property.
- Evidence anchors:
  - [abstract]: "Furthermore, we theoretically establish a connection with traditional score-matching, and we demonstrate its convergence to an unbiased distribution."
  - [section]: "Theorem 1. LTIW-DSM(θ; pbias, wt
ϕ∗(·)) = LSM(θ; pdata) + C, where C is a constant w.r.t. θ."
  - [corpus]: Weak evidence - related papers discuss theoretical analysis of diffusion models but not specifically the equivalence proof for time-dependent importance reweighting.
- Break condition: If the equivalence proof doesn't hold under practical conditions or if optimization deviates from theoretical guarantees.

## Foundational Learning

- Concept: Diffusion models and score matching
  - Why needed here: The paper uses diffusion models as the generative framework and score matching as the training objective.
  - Quick check question: What is the relationship between the forward diffusion process and the reverse generative process in diffusion models?

- Concept: Density ratio estimation and importance reweighting
  - Why needed here: The paper uses density ratio estimation to estimate the ratio between biased and unbiased distributions, and uses importance reweighting to adjust the training objective.
  - Quick check question: How does density ratio estimation enable importance reweighting in the context of dataset bias?

- Concept: Time-dependent discriminators
  - Why needed here: The paper uses a time-dependent discriminator to estimate the time-dependent density ratio between perturbed biased and unbiased distributions.
  - Quick check question: How does a time-dependent discriminator differ from a time-independent one in terms of input and output?

## Architecture Onboarding

- Component map:
  - Score network (diffusion model) -> Time-dependent discriminator -> Objective function (TIW-DSM) -> Generated samples
  - Reference dataset (Dref) and biased dataset (Dbias) feed into discriminator and objective function

- Critical path:
  1. Train time-dependent discriminator on Dref and Dbias
  2. Estimate time-dependent density ratio wt
ϕ∗(xt) from discriminator output
  3. Train score network using TIW-DSM objective with wt
ϕ∗(xt) for reweighting and score correction
  4. Generate unbiased samples from trained score network

- Design tradeoffs:
  - Time-dependent vs. time-independent density ratio: Time-dependent is more accurate but requires additional training of discriminator
  - Reweighting vs. score correction: Both are needed for tractable unbiased score matching, but increase complexity
  - Dref size: Larger Dref improves performance but increases data collection cost

- Failure signatures:
  - Poor FID scores: Indicates model not converging to unbiased distribution
  - High bias metrics: Indicates latent subgroup proportions not balanced in generated samples
  - Overfitting: Indicates model memorizing limited Dref data

- First 3 experiments:
  1. Reproduce CIFAR-10 LT experiment with 5% reference size: Compare FID and bias metrics between TIW-DSM and baselines
  2. Reproduce FFHQ gender bias experiment with 12.5% reference size: Compare FID and bias metrics between TIW-DSM and baselines
  3. Ablation study on score correction component: Remove score correction term and compare performance to full TIW-DSM

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the performance of TIW-DSM scale with increasingly large reference datasets (Dref) compared to smaller ones?
- Basis in paper: [explicit] The paper mentions that performance improves as the reference size increases for all methods, but doesn't extensively explore the scaling behavior with very large Dref.
- Why unresolved: The experiments only tested reference sizes up to 50% of the biased dataset, leaving open the question of how performance scales with even larger reference sets.
- What evidence would resolve it: Conducting experiments with Dref sizes significantly larger than 50% of Dbias and comparing the resulting FID scores and bias metrics to those obtained with smaller reference sets.

### Open Question 2
- Question: Can the time-dependent importance reweighting approach be effectively applied to other generative modeling frameworks beyond diffusion models, such as GANs or VAEs?
- Basis in paper: [inferred] The paper focuses on diffusion models but mentions that Choi et al. (2020) proposed importance reweighting for GANs. The authors also discuss related work on fairness in ML and generative modeling, suggesting potential applicability to other frameworks.
- Why unresolved: The paper doesn't provide experimental results or theoretical analysis for applying TIW to other generative models.
- What evidence would resolve it: Implementing and evaluating TIW-DSM or a similar approach for GANs or VAEs, comparing performance to baseline methods on benchmark datasets with known biases.

### Open Question 3
- Question: How sensitive is the performance of TIW-DSM to the choice of perturbation kernel and its parameters in the diffusion process?
- Basis in paper: [explicit] The paper mentions using the Variance Preserving (VP) SDE and discusses the benefits of perturbation for density ratio estimation, but doesn't explore the impact of different kernels or parameters.
- Why unresolved: The experiments only use one type of perturbation kernel (VP SDE) and don't investigate how changes to its parameters affect the accuracy of density ratio estimation and subsequent model performance.
- What evidence would resolve it: Systematically varying the perturbation kernel type (e.g., VP SDE, sub-VP SDE, Variance Exploding SDE) and its parameters (e.g., noise schedule) in TIW-DSM, and measuring the resulting impact on density ratio estimation accuracy and generated sample quality (FID scores, bias metrics).

## Limitations
- The paper's claims about the superiority of time-dependent density ratio estimation over time-independent approaches are not fully substantiated by empirical evidence.
- The impact of reference dataset size on performance is not thoroughly explored, leaving open questions about scalability.
- The paper doesn't thoroughly explore failure modes when the reference dataset is extremely small or when the bias is highly complex and multimodal.

## Confidence
- High Confidence: The core theoretical framework connecting time-dependent density ratios to tractable unbiased score matching is well-established and mathematically sound.
- Medium Confidence: The empirical results showing improved FID scores and reduced bias in generated samples are convincing, but could benefit from more extensive ablation studies and comparisons with alternative debiasing methods.
- Low Confidence: The paper's claims about the superiority of time-dependent density ratio estimation over time-independent approaches are not fully substantiated by empirical evidence, and the impact of reference dataset size on performance is not thoroughly explored.

## Next Checks
1. **Ablation study on time-dependence:** Train and evaluate the model using both time-dependent and time-independent density ratio estimators on the same datasets to quantify the performance difference.
2. **Reference dataset size sensitivity:** Systematically vary the size of the reference dataset (Dref) from very small (1-2%) to larger proportions and measure the impact on both FID scores and bias metrics.
3. **Failure mode analysis:** Intentionally create scenarios where the density ratio estimation fails (e.g., by using a corrupted reference dataset) and observe how the model performance degrades, identifying specific failure signatures.