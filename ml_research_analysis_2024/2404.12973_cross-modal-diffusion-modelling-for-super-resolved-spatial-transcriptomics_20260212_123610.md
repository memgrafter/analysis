---
ver: rpa2
title: Cross-modal Diffusion Modelling for Super-resolved Spatial Transcriptomics
arxiv_id: '2404.12973'
source_url: https://arxiv.org/abs/2404.12973
tags:
- histology
- diffusion
- maps
- images
- spatial
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the challenge of super-resolving spatial transcriptomics
  (ST) maps, which suffer from low spatial resolution that limits in-depth understanding
  of gene expression patterns. The proposed Diff-ST method integrates histology images
  with low-resolution ST maps using a cross-modal conditional diffusion model.
---

# Cross-modal Diffusion Modelling for Super-resolved Spatial Transcriptomics

## Quick Facts
- **arXiv ID**: 2404.12973
- **Source URL**: https://arxiv.org/abs/2404.12973
- **Reference count**: 34
- **Key outcome**: Diff-ST achieves RMSE improvements of 0.103-0.26 and PCC improvements of 0.075-0.08 over state-of-the-art methods at 5× and 10× scales

## Executive Summary
This paper addresses the challenge of super-resolving spatial transcriptomics (ST) maps, which suffer from low spatial resolution that limits in-depth understanding of gene expression patterns. The proposed Diff-ST method integrates histology images with low-resolution ST maps using a cross-modal conditional diffusion model. The key innovation lies in three components: a multi-modal disentangling network with cross-modal adaptive modulation to leverage complementary information from histology and gene expression, a dynamic cross-attention strategy to extract hierarchical cell-to-tissue features from histology images, and a co-expression-based gene-correlation graph network to model relationships among multiple genes. Experiments on three public datasets (Xenium, SGE, and Breast-ST) demonstrate that Diff-ST significantly outperforms state-of-the-art methods, achieving RMSE improvements of 0.103-0.26 and PCC improvements of 0.075-0.08 at 5× and 10× scales. The method shows strong generalizability on external validation datasets without fine-tuning.

## Method Summary
The Diff-ST method uses a conditional diffusion model that integrates histology images with low-resolution spatial transcriptomics maps. The architecture consists of four main components: a multi-modal disentangling network with cross-modal adaptive modulation for integrating histology and gene expression features, a dynamic cross-attention modeling strategy for extracting hierarchical cell-to-tissue features from histology, a co-expression intensity-based gene-correlation graph network (CIGC-Graph) for modeling gene relationships, and the diffusion model backbone. The method is trained using AdamW optimizer for 200 epochs with a batch size of 4 on NVIDIA RTX A5000 24GB GPUs, using 1,000 diffusion steps. The model is evaluated on three public datasets with histology images at 0.5µm/px and paired low-resolution ST maps (26×26 at 100µm/px) and high-resolution ST maps (256×256 at 10µm/px for 10×, 128×128 at 20µm/px for 5×).

## Key Results
- Achieves RMSE improvements of 0.103-0.26 over state-of-the-art methods at 5× and 10× scales
- Shows PCC improvements of 0.075-0.08 compared to existing approaches
- Demonstrates strong generalizability on external validation datasets without fine-tuning

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Cross-modal adaptive modulation enables effective integration of histology and gene expression information by learning spatially-varying modulation filters.
- Mechanism: The model learns a modulation filter fh2y(w,h) for each pixel in the low-resolution spatial transcriptomics (LR ST) map that references an adjacent region in the histology features. This allows local spatial dependencies between histology and gene expression to be captured, with the filter acting as a bridge that adapts the histology information to the ST domain.
- Core assumption: Local spatial patterns in histology images contain predictive information about gene expression patterns at corresponding tissue locations.
- Evidence anchors: [abstract] "we design a multi-modal disentangling network with cross-modal adaptive modulation to utilize complementary information from histology images and spatial gene expression"; [section 2.2] "we propose a cross-modal adaptive modulation strategy to share the modal-specific information with each other, i.e., cellular and tissue information from histology to ST, and gene expression patterns from ST to histology"
- Break condition: If local histology-gene expression correlations are tissue-specific or the spatial relationships are too complex for simple adjacent region filtering to capture effectively.

### Mechanism 2
- Claim: Dynamic cross-attention modeling extracts hierarchical cell-to-tissue level features from histology images.
- Mechanism: The model uses a curriculum learning-inspired approach to select patches from histology images based on image complexity (entropy). Complex patches are progressively included during training. Cell-level features from selected patches are then integrated with tissue-level features using cross-attention, allowing the model to learn both fine-grained cellular and broader tissue-level representations.
- Core assumption: Different tissue regions require different levels of feature abstraction, and complex cellular regions contain more informative features for gene expression prediction.
- Evidence anchors: [abstract] "we propose a dynamic cross-attention modelling strategy to extract hierarchical cell-to-tissue information from histology images"; [section 2.2] "Due to the varied cellular complexity across patches, we propose a dynamic patch selection strategy based on curriculum learning... the screened cell-level features are further integrated with the tissue-level features via the cross-attention modelling"
- Break condition: If the curriculum learning schedule is not properly tuned, leading to either insufficient feature diversity or excessive computational overhead.

### Mechanism 3
- Claim: Co-expression intensity-based gene-correlation graph network models relationships among multiple genes to enable joint reconstruction.
- Mechanism: The model constructs a correlation matrix based on co-expression intensity between genes, then applies graph convolution to update gene features while preserving their relationships. This allows the diffusion model to generate multiple gene expression maps simultaneously while maintaining biological consistency.
- Core assumption: Gene expression patterns are not independent but exhibit co-expression relationships that should be preserved during super-resolution.
- Evidence anchors: [abstract] "we propose a co-expression-based gene-correlation graph network to model the co-expression relationship of multiple genes"; [section 2.2] "Given the encoded features of the noised HR ST maps of N genes... we construct a co-expression intensity based correlation matrix I to reflect the relationships among each node feature"
- Break condition: If gene co-expression relationships are too tissue-specific or the correlation matrix fails to capture meaningful biological relationships.

## Foundational Learning

- Concept: Diffusion probabilistic models
  - Why needed here: The paper uses a conditional diffusion model for the super-resolution task, which requires understanding how diffusion models work and how conditioning is applied.
  - Quick check question: What is the difference between the forward diffusion process (q) and the reverse diffusion process (p) in diffusion models?

- Concept: Cross-modal learning
  - Why needed here: The method integrates histology images with gene expression data, requiring understanding of how to effectively combine information from different modalities.
  - Quick check question: How does cross-modal adaptive modulation differ from simple feature concatenation in multimodal learning?

- Concept: Graph neural networks
  - Why needed here: The CIGC-Graph network uses graph convolution to model gene-gene relationships, requiring understanding of graph neural network architectures and message passing.
  - Quick check question: In the CIGC-Graph network, what is the role of the correlation matrix I in the graph convolution operation?

## Architecture Onboarding

- Component map: Histology images and LR ST maps → Dynamic cross-attention → Cell-level and tissue-level features → Multi-modal disentangling with cross-modal adaptive modulation → CIGC-Graph → Conditional diffusion model → HR ST maps

- Critical path: The critical path for training involves: 1) Extracting cell-level and tissue-level features from histology images using the dynamic cross-attention strategy, 2) Integrating these features with LR ST features using cross-modal adaptive modulation and multi-modal disentangling, 3) Processing the resulting features through the CIGC-Graph network to capture gene relationships, and 4) Using the processed features as conditioning information in the reverse diffusion process to reconstruct HR ST maps.

- Design tradeoffs: The model trades computational complexity for performance by using multiple specialized components (cross-modal modulation, hierarchical feature extraction, gene correlation graphs) rather than a simpler end-to-end approach. This increases model complexity but allows for more effective integration of multimodal information and preservation of biological relationships.

- Failure signatures: Common failure modes include: 1) Poor integration of histology and gene expression information (evidenced by performance similar to single-modality baselines), 2) Failure to capture hierarchical features from histology (evidenced by similar performance with or without cell-level feature extraction), 3) Inability to model gene relationships effectively (evidenced by similar performance when treating genes independently), and 4) Training instability in the diffusion model (evidenced by mode collapse or excessive variance in generated outputs).

- First 3 experiments:
  1. Test the cross-modal adaptive modulation component in isolation by comparing performance with and without this module while keeping other components fixed.
  2. Evaluate the impact of the hierarchical feature extraction by comparing performance with different patch sizes and complexity thresholds in the curriculum learning approach.
  3. Assess the effectiveness of the CIGC-Graph network by comparing performance when genes are treated independently versus when gene relationships are modeled.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How does the performance of Diff-ST vary when applied to other spatial transcriptomics platforms beyond Visium, Stereo-seq, Xenium, and SGE?
- Basis in paper: [inferred] The paper evaluates Diff-ST on three specific datasets (Xenium, SGE, and Breast-ST) but does not explore its performance on other platforms.
- Why unresolved: The paper does not provide data or analysis on the generalizability of Diff-ST to other spatial transcriptomics platforms, which could reveal limitations or strengths in different contexts.
- What evidence would resolve it: Testing Diff-ST on a diverse set of spatial transcriptomics datasets from various platforms and comparing its performance metrics (RMSE, PCC) across these datasets.

### Open Question 2
- Question: What is the impact of varying the number of cell-level patches (M) on the model's ability to capture detailed spatial information?
- Basis in paper: [explicit] The paper mentions that M is set to 256, with each patch of 320 pixels, but does not explore the effect of changing this parameter.
- Why unresolved: The choice of M is not justified through experimentation, and its impact on model performance and computational efficiency is not discussed.
- What evidence would resolve it: Conducting experiments with different values of M and analyzing the trade-offs between model accuracy and computational cost.

### Open Question 3
- Question: How does the model handle the integration of additional modalities, such as protein expression data, alongside histology images and gene expression?
- Basis in paper: [inferred] The paper focuses on integrating histology images and gene expression but does not address the potential inclusion of other data types.
- Why unresolved: The model's architecture and conditioning mechanisms are designed for two modalities, and extending it to more could reveal limitations or require significant modifications.
- What evidence would resolve it: Modifying the model to incorporate additional modalities and evaluating its performance on datasets that include these extra data types.

### Open Question 4
- Question: What are the limitations of the current hierarchical feature extraction approach in capturing long-range dependencies across the entire tissue section?
- Basis in paper: [explicit] The paper describes a hierarchical feature extraction approach but does not discuss its limitations in capturing long-range dependencies.
- Why unresolved: The focus is on cell-to-tissue level features, and the potential loss of information from long-range interactions is not addressed.
- What evidence would resolve it: Comparing the performance of Diff-ST with and without modifications to enhance long-range dependency capture, using metrics that assess spatial coherence and biological plausibility.

## Limitations
- The effectiveness of cross-modal adaptive modulation depends on consistent local histology-gene expression correlations across tissue types
- The computational cost of the method, requiring large GPUs for training with 1,000 diffusion steps, may limit practical applicability
- The generalizability claims for external validation datasets are based on limited testing

## Confidence
- **High confidence**: The overall performance improvements (RMSE 0.103-0.26, PCC 0.075-0.08) are well-supported by experimental results across three datasets
- **Medium confidence**: The specific design choices for each component are justified through ablation studies, but individual contributions to overall performance are difficult to isolate
- **Low confidence**: The generalizability claims for external validation datasets are based on limited testing

## Next Checks
1. Component isolation tests: Systematically disable each of the three novel components (cross-modal modulation, dynamic cross-attention, gene correlation graph) to quantify their individual contributions to performance improvements.
2. Tissue-type generalization: Test the model on spatial transcriptomics data from tissue types not represented in the training set to validate the generalizability claims, particularly for complex tissues with different cellular architectures.
3. Computational efficiency analysis: Evaluate the trade-off between performance gains and computational cost by testing the model with reduced diffusion steps and comparing results to the full 1,000-step implementation.