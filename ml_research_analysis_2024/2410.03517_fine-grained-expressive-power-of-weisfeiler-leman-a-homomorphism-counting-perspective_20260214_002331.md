---
ver: rpa2
title: 'Fine-Grained Expressive Power of Weisfeiler-Leman: A Homomorphism Counting
  Perspective'
arxiv_id: '2410.03517'
source_url: https://arxiv.org/abs/2410.03517
tags:
- move
- round
- lemma
- pebbles
- putting
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper addresses the problem of characterizing the expressive
  power of graph neural networks (GNNs) by their ability to count homomorphisms. While
  previous works have investigated this for specific GNN families, a unified framework
  was lacking.
---

# Fine-Grained Expressive Power of Weisfeiler-Leman: A Homomorphism Counting Perspective

## Quick Facts
- arXiv ID: 2410.03517
- Source URL: https://arxiv.org/abs/2410.03517
- Reference count: 40
- Primary result: A unified framework that algorithmically determines the homomorphism counting power of any GNN within the GFWL design space using game-theoretic equivalence

## Executive Summary
This paper addresses the problem of characterizing the expressive power of graph neural networks (GNNs) by their ability to count homomorphisms. While previous works have investigated this for specific GNN families, a unified framework was lacking. The authors propose generalized folklore Weisfeiler-Leman (GFWL) algorithms as a flexible design basis for expressive GNNs and provide a theoretical framework to algorithmically determine the homomorphism counting power of any GNN within the GFWL design space. The key insight is establishing equivalence between GFWL indistinguishability and identity in homomorphism counts from specific query graphs, which is validated through implementation and comparison with previous theoretical results.

## Method Summary
The authors introduce the concept of generalized folklore Weisfeiler-Leman (GFWL) algorithms, which encompasses most existing variants of WL algorithms, and provide a theoretical framework to algorithmically determine the homomorphism counting power of an arbitrary class of GNNs within the GFWL design space. The method relies on relating GFWL algorithms to Ehrenfeucht-Fraïssé games and Cops-Robber games to derive the exact set of query graphs whose homomorphisms a GFWL algorithm can count. The core result is a meta-algorithm that can determine the homomorphism counting power of any GFWL algorithm by simulating these games and enumerating the distinguishing query graphs.

## Key Results
- Introduces GFWL framework that unifies most existing WL-based GNN variants
- Establishes equivalence between GFWL indistinguishability and homomorphism identity via game-theoretic tools
- Provides a meta-algorithm that automatically determines homomorphism counting power for any GFWL instance
- Validates the framework by comparing results with previous theoretical bounds and implements it as an open-source tool

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Generalized folklore Weisfeiler-Leman (GFWL) algorithms provide a flexible design space that encompasses most powerful GNNs.
- Mechanism: GFWL extends the folklore WL framework by introducing parameters k, t, and flexible neighborhood aggregation rules. This allows the framework to capture both k-FWL and local k-FWL, as well as other variants like δ-DRFWL(2).
- Core assumption: The neighborhood and aggregation functions can be chosen to match the expressive power of existing WL-based GNNs.
- Evidence anchors:
  - [abstract] "We introduce the concept of generalized folklore Weisfeiler-Leman (GFWL) algorithms, which encompasses most existing variants of WL algorithms..."
  - [section] "Many other variants of WL algorithms [26, 27, 31] can be unified into the GFWL framework, as is shown in Appendix A."
  - [corpus] Weak; no direct citation of this unification in related papers, only general mention of GFWL extensions.
- Break condition: If a new WL variant introduces a non-iterative, non-color-refinement update rule, it may fall outside the GFWL scope.

### Mechanism 2
- Claim: The equivalence between GFWL indistinguishability and homomorphism identity provides a practical measure of expressive power.
- Mechanism: The paper proves that two graphs are indistinguishable by a GFWL algorithm if and only if they have the same homomorphism counts from a specific set of query graphs. This equivalence is established via Ehrenfeucht-Fraïssé and Cops-Robber games.
- Core assumption: Both the invariant set R(·) and equivariant set F(·, ·) are closed under homomorphisms, ensuring that the WL refinement preserves homomorphism structure.
- Evidence anchors:
  - [abstract] "We then provide a theoretical framework to algorithmically determine the homomorphism counting power of an arbitrary class of GNN within the GFWL design space."
  - [section] "Our main theoretical result is the following theorem... G and H get different colors W(G) and W(H)... if and only if there exists F such that Cops win the Cops-Robber game on F and Hom(F, G) ≠ Hom(F, H)."
  - [corpus] Weak; neighboring papers discuss homomorphism expressivity but not the specific game-theoretic equivalence.
- Break condition: If R(·) or F(·, ·) are not closed under homomorphisms, the equivalence fails and the counting framework no longer applies.

### Mechanism 3
- Claim: The meta-algorithm can automatically determine homomorphism counting power for any GFWL algorithm.
- Mechanism: By simulating the Ehrenfeucht-Fraïssé and Cops-Robber games, the algorithm enumerates the set of query graphs whose homomorphism counts are preserved by the GFWL instance. This is implemented as a concrete tool.
- Core assumption: The game simulations terminate and correctly capture the indistinguishability relation induced by the GFWL algorithm.
- Evidence anchors:
  - [abstract] "Our main result, Theorem 4.10, actually provides us with a meta-algorithm to automate the procedure of determining the homomorphism counting power of any GFWL algorithm."
  - [section] "We implement the meta-algorithm and validate its correctness by comparing its output with previous theoretical results in [1, 12, 16, 21, 26, 27, 31]."
  - [corpus] Weak; related works mention homomorphism counting but do not cite an automated meta-algorithm.
- Break condition: If the game trees are infinite or the pebble game rules are not correctly encoded, the meta-algorithm may fail to terminate or produce incorrect results.

## Foundational Learning

- Concept: Graph isomorphism and homomorphism counting
  - Why needed here: The entire expressive power analysis hinges on being able to count homomorphisms from small query graphs and relate that to WL indistinguishability.
  - Quick check question: Given graphs G and H, can you construct a homomorphism from G to H that is not surjective? What does this tell you about Spasm(G)?

- Concept: Ehrenfeucht-Fraïssé and Cops-Robber pebble games
  - Why needed here: These games provide the combinatorial tools to characterize the expressive power of GFWL algorithms in terms of graph properties.
  - Quick check question: In a Cops-Robber game on a tree, what is the minimum number of cops needed to win? How does this relate to tree-width?

- Concept: k-invariant and (ℓ, k)-equivariant sets
  - Why needed here: These properties ensure that the neighborhood aggregation rules respect the symmetry of the graph, which is essential for maintaining the WL refinement.
  - Quick check question: Is the set {(u, v) ∈ V²_G : d(u, v) ≤ 2} k-invariant for any k? Why or why not?

## Architecture Onboarding

- Component map: GFWL framework definition -> Meta-algorithm -> Validation suite
- Critical path:
  1. Define GFWL instance via hyperparameters.
  2. Simulate Ehrenfeucht-Fraïssé game to find distinguishable graph pairs.
  3. For each distinguishable pair, run Cops-Robber game to find minimal query graph.
  4. Output set of query graphs whose homomorphism counts separate the GFWL class.
- Design tradeoffs:
  - Larger k, t → higher expressive power but exponential growth in state space.
  - More complex neighborhood functions → better expressiveness but harder to analyze.
  - Strict closure under homomorphisms → cleaner theory but may exclude some useful variants.
- Failure signatures:
  - Infinite loops in game simulation → likely due to missing termination condition.
  - Empty query graph set → possible if GFWL is too weak or hyperparameters are mis-specified.
  - Mismatch with literature results → suggests bug in game encoding or equivalence proof.
- First 3 experiments:
  1. Run meta-algorithm on (k=1, t=1)-FWL+ and verify it matches standard 1-WL homomorphism power.
  2. Compare δ-DRFWL(2) output against the distance-restricted counting results in [30].
  3. Test local k-FWL for k=3 and confirm it distinguishes graphs that 2-FWL cannot.

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Can the homomorphism counting power framework be extended to k-WL, sparse k-WL, and subgraph WL algorithms?
- Basis in paper: [explicit] The paper explicitly states these variants are not currently covered by the GFWL framework and are listed as future directions.
- Why unresolved: These algorithms have different design paradigms that require modifications to the GFWL definitions and pebble games.
- What evidence would resolve it: A theoretical proof showing the homomorphism counting power of these algorithms can be characterized using generalized pebble games, or a counterexample demonstrating fundamental incompatibility.

### Open Question 2
- Question: Is there a general equivalence between homomorphism counting power and substructure counting power for all GFWL algorithms?
- Basis in paper: [explicit] The paper conjectures this connection exists but states difficulty proving it for general GFWL algorithms.
- Why unresolved: The key challenge is proving monotonicity of the Cops-Robber game for arbitrary GFWL instances, which existing proof techniques for specific WL variants cannot easily generalize to.
- What evidence would resolve it: A proof establishing that for any GFWL algorithm, being able to count subgraph isomorphisms from a query graph H is equivalent to being able to count homomorphisms from all graphs in Spasm(H).

### Open Question 3
- Question: What is the exact computational complexity of determining the homomorphism counting power for an arbitrary GFWL algorithm?
- Basis in paper: [inferred] While the paper provides a meta-algorithm, it doesn't analyze its computational complexity or whether it's polynomial-time.
- Why unresolved: The algorithm involves exploring all possible Spoiler action sequences and checking Cops-Robber game outcomes, which could be exponential in worst case.
- What evidence would resolve it: A complexity analysis proving the algorithm runs in polynomial time relative to the size of the GFWL algorithm specification, or a proof that the problem is computationally hard (e.g., PSPACE-complete).

## Limitations
- The GFWL framework may not capture all possible GNN architectures, particularly those with non-iterative update rules or attention mechanisms.
- The equivalence proofs rely on closure properties of the invariant and equivariant sets that may not hold for all GFWL instantiations.
- The computational complexity of the meta-algorithm is not fully analyzed, and may be exponential in worst case.

## Confidence
- **High confidence**: The theoretical framework connecting GFWL indistinguishability to homomorphism counting is sound, as it builds on well-established game-theoretic tools (Ehrenfeucht-Fraïssé and Cops-Robber games).
- **Medium confidence**: The meta-algorithm correctly determines homomorphism counting power, though the implementation details and computational complexity are not fully explored.
- **Medium confidence**: The claim that GFWL encompasses most existing WL-based GNNs, as this unification is stated but not exhaustively proven.

## Next Checks
1. Verify the closure properties of R(·) and F(·, ·) under homomorphisms for specific GFWL instantiations beyond the theoretical proof.
2. Implement and test the meta-algorithm on GFWL variants that are known to be outside the scope of previous frameworks (e.g., δ-DRFWL(2)) to ensure correct behavior.
3. Conduct a systematic study of the computational complexity of the meta-algorithm for different hyperparameter settings (k, t, N, M) to understand practical limitations.