---
ver: rpa2
title: 'Reframing the Expected Free Energy: Four Formulations and a Unification'
arxiv_id: '2402.14460'
source_url: https://arxiv.org/abs/2402.14460
tags:
- energy
- expected
- free
- states
- distribution
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper formalizes the unification problem of deriving multiple
  formulations of expected free energy (EFE) in active inference from a single root
  definition. The authors identify two settings, each with its own root EFE definition.
---

# Reframing the Expected Free Energy: Four Formulations and a Unification

## Quick Facts
- arXiv ID: 2402.14460
- Source URL: https://arxiv.org/abs/2402.14460
- Reference count: 10
- This paper formalizes the unification problem of deriving multiple formulations of expected free energy (EFE) in active inference from a single root definition, identifying two settings with different recoverability properties and compatibility constraints.

## Executive Summary
This paper addresses the challenge of unifying four different formulations of expected free energy (EFE) in active inference by identifying two distinct settings with their own root EFE definitions. In the first setting, all four formulations can be recovered but only limited prior preferences over observations are compatible with the likelihood mapping. In the second setting, a justified root EFE definition exists but only two formulations can be recovered. The authors identify a fundamental tension between theoretical justification and practical recoverability of EFE formulations.

## Method Summary
The authors analyze two generative model settings to derive EFE formulations. Setting 1 uses risk over observations plus ambiguity as the root definition, allowing recovery of all four formulations but requiring constrained prior preferences. Setting 2 uses risk over states plus ambiguity, providing theoretical justification but limiting recoverability to two formulations. The analysis reveals that prior preferences must satisfy compatibility conditions with the likelihood mapping, specifically that desired prior preferences must lie in the column space of the likelihood matrix.

## Key Results
- Two settings identified with different root EFE definitions and recoverability properties
- Prior preferences over observations must be compatible with likelihood mapping (Co = ACs)
- Setting 1 recovers all four formulations but with constrained prior preferences
- Setting 2 provides justified EFE definition but only recovers two formulations

## Why This Works (Mechanism)

### Mechanism 1
The dual meaning of P(o) as both prior preferences and marginal likelihood introduces hidden inconsistencies in active inference formulations. When P(o) is used to denote both the prior preferences over observations and the marginal likelihood, the two interpretations conflict because the marginal likelihood changes over time with new observations, while prior preferences are typically fixed. This inconsistency propagates through Bayes' theorem applications, where P(o) in the denominator should represent the marginal likelihood but could be misinterpreted as prior preferences.

### Mechanism 2
Two settings emerge with different root EFE definitions, each with distinct recoverability properties for the four formulations. In the first setting, the root EFE is defined as risk over observations plus ambiguity, which allows recovery of all four formulations but requires constrained prior preferences over observations. In the second setting, a justified root EFE definition (risk over states plus ambiguity) only allows recovery of two formulations, but provides theoretical justification for the EFE concept itself.

### Mechanism 3
The linear transformation perspective reveals the class of valid prior preferences over observations. Prior preferences over observations Co must be expressible as Co = ACs, where A is the likelihood matrix and Cs represents valid prior preferences over states. Geometrically, this means Co must lie in the column space of A, which corresponds to the image of the state simplex under the likelihood transformation.

## Foundational Learning

- Concept: Partially Observable Markov Decision Process (POMDP)
  - Why needed here: The entire active inference framework is built on POMDP assumptions, where observations depend on hidden states and states depend on previous states and actions.
  - Quick check question: In a POMDP, are observations conditionally independent of actions given the current state? (Answer: Yes, due to d-separation)

- Concept: Variational Free Energy and its relationship to KL divergence
  - Why needed here: The EFE derivation builds directly on VFE concepts. Understanding that minimizing VFE is equivalent to minimizing KL divergence between variational and true posteriors is crucial for grasping the unification approach.
  - Quick check question: What are the two terms that compose the variational free energy, and what do they represent? (Answer: Complexity - distance from prior, Accuracy - negative log-likelihood of observations)

- Concept: KL divergence properties and bounds
  - Why needed here: The unification proofs rely heavily on KL divergence properties, including that it's always non-negative and equals zero only when distributions are identical.
  - Quick check question: Is the KL divergence between two distributions always non-negative? (Answer: Yes, and it equals zero only when the distributions are identical)

## Architecture Onboarding

- Component map: Generative model P(o,s|a) -> Variational distribution Q(s|a) -> Forecast distribution F(o,s|a) -> Grt(a) -> Action selection
- Critical path: P(o,s|a) → Q(s|a) → F(o,s|a) → Grt(a) → Action selection
- Design tradeoffs:
  - Setting 1: All four formulations recoverable but constrained prior preferences (requires compatibility check)
  - Setting 2: Justified EFE definition but only two formulations recoverable (theoretical foundation vs practical completeness)
- Failure signatures:
  - Incompatible prior preferences: When Co = ACs has no valid solution, typically when desired Co is outside A's column space
  - Broken unification: When attempting to derive all four formulations from a single root definition fails due to mathematical constraints
- First 3 experiments:
  1. Verify compatibility check: Given a specific A matrix and desired Co, determine if valid Cs exists and compute it if possible
  2. Test formulation recoverability: Implement both settings and verify which EFE formulations can be recovered in each case
  3. Evaluate planning performance: Compare action selection quality when using unified EFE vs individual formulations in a simple navigation task

## Open Questions the Paper Calls Out

### Open Question 1
Can all four formulations of expected free energy (EFE) be recovered from a single root definition without restricting the prior preferences over observations? The paper shows that recovering all four formulations requires a restriction on prior preferences over observations, creating a conflict between the likelihood mapping and the target distribution.

### Open Question 2
What is the justification for defining the expected free energy as the risk over observations plus ambiguity, rather than the risk over states plus ambiguity? The paper highlights that while the risk over states plus ambiguity formulation is justified, the risk over observations plus ambiguity lacks a first-principles derivation.

### Open Question 3
How can the expected free energy be computed using deep neural networks in the context of deep active inference? The paper mentions that implementing the proposed expected free energy definition in deep neural networks requires additional research, as it does not explain how to compute it using deep learning techniques.

## Limitations
- Fundamental tension between recovering all formulations and maintaining theoretical justification
- Strict constraints on prior preferences over observations may limit practical applicability
- Compatibility requirements between prior preferences and likelihood mapping may be difficult to satisfy

## Confidence

- High confidence: The mathematical derivations showing the incompatibility between arbitrary prior preferences and the likelihood mapping
- Medium confidence: The theoretical justification for the two settings and their respective recoverability properties
- Medium confidence: The geometric interpretation of valid prior preferences as lying in the column space of A

## Next Checks

1. **Compatibility verification**: For a range of likelihood matrices A and desired prior preferences Co, systematically test whether the compatibility equation Co = ACs has valid solutions and characterize the conditions under which it fails.

2. **Formulation recovery test**: Implement both settings in a simple POMDP and verify that all four formulations can be recovered in Setting 1 (with compatible priors) while only two are recoverable in Setting 2.

3. **Planning performance comparison**: Compare action selection quality when using unified EFE formulations versus individual formulations in a navigation task, measuring both convergence speed and final performance metrics.