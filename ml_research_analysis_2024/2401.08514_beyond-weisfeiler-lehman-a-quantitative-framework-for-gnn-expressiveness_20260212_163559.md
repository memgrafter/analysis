---
ver: rpa2
title: 'Beyond Weisfeiler-Lehman: A Quantitative Framework for GNN Expressiveness'
arxiv_id: '2401.08514'
source_url: https://arxiv.org/abs/2401.08514
tags:
- graph
- graphs
- such
- tree
- local
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces homomorphism expressivity as a quantitative
  measure for analyzing the expressive power of Graph Neural Networks (GNNs). By characterizing
  the substructures a GNN can encode under homomorphism, this framework enables precise
  comparisons between different GNN architectures.
---

# Beyond Weisfeiler-Lehman: A Quantitative Framework for GNN Expressiveness

## Quick Facts
- arXiv ID: 2401.08514
- Source URL: https://arxiv.org/abs/2401.08514
- Authors: Bohang Zhang; Jingchu Gai; Yiheng Du; Qiwei Ye; Di He; Liwei Wang
- Reference count: 40
- Primary result: Introduces homomorphism expressivity as a quantitative measure for GNN expressive power using nested ear decomposition

## Executive Summary
This paper introduces homomorphism expressivity as a quantitative measure for analyzing the expressive power of Graph Neural Networks (GNNs). By characterizing the substructures a GNN can encode under homomorphism, this framework enables precise comparisons between different GNN architectures. The authors derive elegant descriptions of homomorphism expressivity for four classes of GNNs—MPNN, Subgraph GNN, Local GNN, and Folklore-type GNN—using the concept of nested ear decomposition (NED). This approach provides deeper insights into prior work, answers open questions, and reveals the subgraph counting capabilities of GNNs at graph, node, and edge levels. Experiments on synthetic and real-world tasks validate the theory, showing strong alignment between practical performance and the proposed metric.

## Method Summary
The paper introduces homomorphism expressivity as a framework for evaluating GNN expressive power. For a GNN model M, its homomorphism expressivity family F_M consists of all graph patterns that M can count under homomorphism. The framework establishes that two graphs have identical GNN representations if and only if they have identical homomorphism counts for all patterns in F_M, making it a complete expressivity measure. The authors characterize F_M for four GNN architectures using nested ear decomposition (NED) variants and prove maximality using pebble game techniques. This enables precise expressivity comparisons and analysis of subgraph counting capabilities.

## Key Results
- Homomorphism expressivity provides a complete and practical assessment tool for comparing GNN expressivity
- NED variants elegantly characterize homomorphism expressivity for MPNN, Subgraph GNN, Local GNN, and Folklore-type GNN
- The framework reveals that Local 2-(F)GNN has the same subgraph counting ability as 2-FGNN for moderate-sized structures
- Experiments on synthetic and real-world tasks validate the theory, showing alignment between practical performance and homomorphism expressivity

## Why This Works (Mechanism)

### Mechanism 1
- Claim: Homomorphism expressivity serves as a complete expressivity measure because it captures all structural information that determines GNN outputs.
- Mechanism: The framework establishes that two graphs have identical GNN representations if and only if they have identical homomorphism counts for all patterns in the model's expressivity family. This bidirectional relationship means the homomorphism information is both necessary and sufficient.
- Core assumption: The "iff" condition holds for the defined homomorphism expressivity family F_M, making it a complete characterization.
- Evidence anchors:
  - [abstract] "homomorphism expressivity offers a complete and practical assessment tool: the completeness enables direct expressivity comparisons between GNN models"
  - [section 2] Definition 3.1 states the "iff" condition explicitly
  - [corpus] Weak - corpus lacks direct evidence about the "iff" condition
- Break condition: If there exist graphs with identical homomorphism counts for all F_M patterns but different GNN representations, the measure would not be complete.

### Mechanism 2
- Claim: Nested Ear Decomposition (NED) provides an elegant characterization of homomorphism expressivity for practical GNN architectures.
- Mechanism: Different variants of NED (endpoint-shared, strong, almost-strong) correspond to the expressivity families of different GNN architectures. The framework proves that a graph F is in F_M if and only if it has the appropriate NED structure.
- Core assumption: The NED variants correctly capture the counting capabilities of the corresponding GNN architectures.
- Evidence anchors:
  - [section 3.2] Theorem 3.4 establishes the connection between NED variants and F_M for each architecture
  - [section 3.2] The proof sketch mentions that NED provides "simple, unified, and elegant descriptions"
  - [corpus] Weak - corpus lacks direct evidence about NED's role in expressivity characterization
- Break condition: If a graph with the correct NED structure cannot be counted by the corresponding GNN, or if a graph without the NED structure can be counted, the characterization would fail.

### Mechanism 3
- Claim: The pebble game technique enables proving the maximality of homomorphism expressivity, ensuring the "iff" condition is both necessary and sufficient.
- Mechanism: The pebble game models the computational process of GNNs. By showing that Alice (the GNN) cannot win the game for graphs outside F_M, the framework proves these graphs cannot be counted. Conversely, if Alice can win, a tree decomposition exists showing the graph is in F_M.
- Core assumption: The pebble game accurately models the expressive power of the GNN architectures.
- Evidence anchors:
  - [section C.4] The pebble game is described as a technique to prove maximality
  - [section C.4] Proposition C.49 connects pebble game outcomes to GNN representations
  - [corpus] Weak - corpus lacks direct evidence about the pebble game's role
- Break condition: If the pebble game model does not accurately reflect the GNN's computational process, the maximality proof would be invalid.

## Foundational Learning

- Concept: Graph homomorphism and subgraph counting
  - Why needed here: The framework is built on understanding what substructures GNNs can count under homomorphism, which requires distinguishing between homomorphism and subgraph counting
  - Quick check question: What is the key difference between hom(F, G) and sub(F, G), and why does this distinction matter for GNN expressivity?

- Concept: Nested Ear Decomposition (NED) and its variants
  - Why needed here: NED provides the mathematical structure that characterizes which graphs each GNN architecture can count
  - Quick check question: How does a strong NED differ from an almost-strong NED, and which GNN architecture corresponds to each?

- Concept: Tree decomposition and treewidth
  - Why needed here: Tree decomposition is used as an intermediate step to connect GNN expressivity to NED, and treewidth provides a bound for certain GNN architectures
  - Quick check question: What is the relationship between treewidth and the expressive power of k-FGNN?

## Architecture Onboarding

- Component map: F_M definition -> Tree decomposition -> NED characterization -> Pebble game maximality proof
- Critical path:
  1. Define homomorphism expressivity F_M for a GNN model
  2. Characterize F_M using NED variants
  3. Prove maximality using pebble game technique
  4. Apply to compare expressivity and analyze subgraph counting

- Design tradeoffs:
  - Completeness vs. practicality: The framework is theoretically complete but may be complex to compute for large graphs
  - Generality vs. specificity: NED provides elegant characterizations but may not capture all architectural nuances
  - Abstraction level: The framework operates at a high level of abstraction, which may obscure low-level implementation details

- Failure signatures:
  - If F_M is not maximal, the expressivity measure is incomplete
  - If NED characterization is incorrect, the expressivity comparisons will be wrong
  - If pebble game does not accurately model GNN computation, maximality proofs fail

- First 3 experiments:
  1. Verify the NED characterization for a simple graph G and MPNN (should be a forest)
  2. Test homomorphism counting for a cycle graph with Subgraph GNN (should count cycles up to a certain length)
  3. Apply the framework to compare expressivity between Local 2-GNN and 2-FGNN using counterexample graphs

## Open Questions the Paper Calls Out

### Open Question 1
- Question: Under what conditions does homomorphism expressivity exist for general color refinement-based GNN architectures?
- Basis in paper: Explicit - "we suspect that, for any GNN characterized by a color refinement algorithm that outputs stable colors, the homomorphism expressivity always exists"
- Why unresolved: The paper only conjectures this condition exists but does not prove it. A general theorem characterizing when homomorphism expressivity exists would be needed.
- What evidence would resolve it: A proof that for any GNN defined via color refinement with stable outputs, homomorphism expressivity exists, or a counterexample GNN where it doesn't exist.

### Open Question 2
- Question: What is the homomorphism expressivity of Local k-FGNN for k ≥ 3?
- Basis in paper: Explicit - "it remains unclear how to give a simple description of the homomorphism expressivity for Local k-FGNN that can generalize the concept of almost-strong NED for k = 2"
- Why unresolved: The paper derives NED-based descriptions for other GNN types but cannot extend to higher-order Local FGNN.
- What evidence would resolve it: A characterization of Local k-FGNN homomorphism expressivity using a generalized NED concept, or proof that no such simple description exists.

### Open Question 3
- Question: What fundamental performance gaps exist between Local 2-(F)GNN and 2-FGNN in practical applications?
- Basis in paper: Inferred - "we surprisingly find that the subgraph counting ability of Local 2-(F)GNN matches that of 2-FGNN for all structures within a moderate size...although the former is much more efficient"
- Why unresolved: Despite theoretical expressivity gaps, practical performance appears similar for many tasks.
- What evidence would resolve it: Empirical studies showing cases where Local 2-(F)GNN fails but 2-FGNN succeeds, or theoretical analysis of practical performance differences.

## Limitations
- The completeness of homomorphism expressivity as a characterization of GNN representational power has not been empirically validated across diverse architectures
- The pebble game technique may not capture all practical aspects of GNN computation, particularly for architectures with complex aggregation schemes
- The NED characterization may not extend to architectures beyond the four classes studied

## Confidence
- High confidence: The basic homomorphism expressivity framework and its utility for expressivity comparisons (well-defined mathematical foundation)
- Medium confidence: The NED characterization of specific GNN architectures (proven for studied cases but may not generalize)
- Medium confidence: The maximality proofs using pebble games (theoretical but limited empirical validation)
- Low confidence: Practical implications for real-world GNN design decisions (primarily theoretical contributions)

## Next Checks
1. **Expressivity Gap Verification**: Construct explicit graph pairs that demonstrate the theoretical expressivity gaps between MPNN, Subgraph GNN, and Local GNN architectures to empirically validate the framework's predictions.
2. **Pebble Game Accuracy**: Test whether the pebble game model accurately predicts the counting capabilities of practical GNN implementations by comparing theoretical predictions with empirical results on subgraph counting tasks.
3. **Framework Generalization**: Apply the homomorphism expressivity framework to newer GNN architectures (e.g., Graph Attention Networks, Graph Transformers) to assess whether NED characterization remains valid or requires modification.