---
ver: rpa2
title: Flow Priors for Linear Inverse Problems via Iterative Corrupted Trajectory
  Matching
arxiv_id: '2405.18816'
source_url: https://arxiv.org/abs/2405.18816
tags:
- should
- flow
- problems
- inverse
- answer
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper proposes ICTM, a novel algorithm for efficiently approximating
  the MAP solution in linear inverse problems using flow priors. The key challenge
  addressed is the computational inefficiency of computing log-likelihoods via ODE
  solvers in high-dimensional settings.
---

# Flow Priors for Linear Inverse Problems via Iterative Corrupted Trajectory Matching

## Quick Facts
- **arXiv ID**: 2405.18816
- **Source URL**: https://arxiv.org/abs/2405.18816
- **Reference count**: 40
- **Primary result**: ICTM outperforms flow-based methods on super-resolution, inpainting, deblurring, and compressed sensing with improved PSNR and SSIM metrics.

## Executive Summary
This paper introduces ICTM, a novel algorithm for solving linear inverse problems using flow priors. The key innovation is decomposing the MAP objective into a sum of local MAP objectives that can be optimized sequentially without expensive ODE solver backpropagation. By leveraging Tweedie's formula, ICTM efficiently computes gradients for the prior term while maintaining data consistency. Experiments demonstrate that ICTM achieves state-of-the-art performance on various inverse problems while significantly reducing computational cost compared to existing flow-based approaches.

## Method Summary
ICTM approximates the MAP solution for linear inverse problems by decomposing the global objective into N sequential local MAP problems. Each local objective optimizes the current trajectory point to fit an auxiliary corrupted path while maintaining likelihood under the local prior. The algorithm uses Tweedie's formula to efficiently compute gradients without expensive Jacobian trace calculations. The method sequentially optimizes trajectory points using gradient descent, with the final solution approximating the true MAP estimate as N increases. ICTM is mathematically justified through theoretical bounds showing convergence to the global MAP objective.

## Key Results
- ICTM outperforms OT-ODE and DPS-ODE on CelebA-HQ for super-resolution, inpainting, and deblurring tasks
- ICTM achieves competitive performance on compressed sensing with HCP T2w dataset, matching ΠGDM while being more efficient
- PSNR improvements of 0.1-0.3 dB and SSIM improvements of 0.01-0.02 over baseline methods on natural images
- Superior performance on scientific images (HCP T2w) compared to flow-based methods, matching diffusion-based approaches

## Why This Works (Mechanism)

### Mechanism 1
- **Claim**: The MAP objective can be efficiently approximated by a weighted sum of "local MAP" objectives.
- **Mechanism**: Decomposes global MAP into N sequential problems, each depending only on current trajectory point and next step, enabling efficient Tweedie-based gradient computation.
- **Core assumption**: Trajectory follows interpolation path exactly, velocity field has uniformly bounded Jacobian spectrum.
- **Evidence anchors**: Theorem 1 proves approximation holds as N→∞, Proposition 1 provides Tweedie's formula, toy example validation shows proximity to closed-form MAP.
- **Break condition**: Significant trajectory deviation from interpolation path or unbounded Jacobian spectrum degrades approximation quality.

### Mechanism 2
- **Claim**: Tweedie's formula enables efficient gradient computation for prior term.
- **Mechanism**: Provides closed-form gradient expression for log p(xt) in terms of velocity field and interpolation coefficients, avoiding expensive Jacobian trace computations.
- **Core assumption**: Gaussian noise structure and valid interpolation path conditions.
- **Evidence anchors**: Proposition 1 establishes exact relationship, abstract confirms gradient step feasibility via Tweedie's formula.
- **Break condition**: Non-Gaussian noise structure or invalid interpolation path prevents Tweedie's formula application.

### Mechanism 3
- **Claim**: Sequential optimization converges to solution close to true MAP estimate.
- **Mechanism**: Each local MAP ensures intermediate trajectory fits corrupted path while maintaining local prior likelihood, building up solution satisfying both data consistency and prior constraints.
- **Core assumption**: Local MAP objectives capture sufficient global MAP structure when optimized sequentially.
- **Evidence anchors**: Strong empirical performance across inverse problems, toy example validation, abstract claims outperforming flow matching methods.
- **Break condition**: Poorly chosen local objectives or local minima in sequential optimization cause divergence from true MAP.

## Foundational Learning

- **Concept: Flow Matching Models**
  - Why needed here: ICTM relies on pretrained flow models as priors, requiring understanding of trajectory generation and likelihood computation
  - Quick check question: How does a flow matching model transform Gaussian noise into data samples, and what mathematical property enables direct likelihood computation?

- **Concept: Maximum A Posteriori (MAP) Estimation**
  - Why needed here: ICTM's approach builds around approximating MAP solution for linear inverse problems
  - Quick check question: What are the two main terms in MAP objective for linear inverse problems, and why is prior term computationally expensive?

- **Concept: Tweedie's Formula**
  - Why needed here: ICTM uses Tweedie's formula for efficient gradient computation of log-likelihood for prior term
  - Quick check question: What relationship does Tweedie's formula establish between score function and velocity field in flow matching models?

## Architecture Onboarding

- **Component map**: Pretrained flow model → Linear forward operator A → Measurement y → Interpolation coefficients {αt}, {βt} → Local MAP optimizer → Trajectory tracker

- **Critical path**:
  1. Initialize x0 from Gaussian noise
  2. Generate auxiliary path yt = αty + βtA(x0)
  3. For each timestep t=0,∆t,...,1-∆t:
     - Compute xt+∆t = xt + vθ(xt,t)∆t
     - Optimize xt to fit A(xt+∆t) ≈ yt+∆t and maintain local prior likelihood
  4. Return final x1 as reconstructed image

- **Design tradeoffs**:
  - N (NFEs) vs computational cost: Higher N gives better MAP approximation but increases computation
  - Step size η vs convergence: Larger η speeds convergence but risks instability
  - Guidance weight λ vs data fit: Higher λ enforces measurement consistency more strongly
  - Local prior inclusion vs speed: Including prior term improves quality but adds computation

- **Failure signatures**:
  - Poor reconstruction quality: Check trajectory deviation from interpolation path or λ mis-tuning
  - Slow convergence: Try reducing step size η or increasing K (local optimization iterations)
  - Unstable optimization: Check gradient computation in Tweedie's formula or try different ODE solver

- **First 3 experiments**:
  1. **Toy denoising validation**: Implement Gaussian toy example to verify ICTM finds solutions close to closed-form MAP
  2. **Simple super-resolution**: Apply ICTM to 2× super-resolution on small images to validate full pipeline
  3. **Ablation study**: Test ICTM with and without local prior term to confirm its contribution to reconstruction quality

## Open Questions the Paper Calls Out

### Open Question 1
- **Question**: How does ICTM performance compare to diffusion-based methods in terms of computational efficiency and reconstruction quality?
- **Basis in paper**: Paper compares ICTM to OT-ODE and DPS-ODE but lacks direct comparison with RED-Diff and ΠGDM on same tasks
- **Why unresolved**: While ICTM outperforms OT-ODE and DPS-ODE, direct comparison with RED-Diff and ΠGDM is not provided
- **What evidence would resolve it**: Experiments comparing ICTM to RED-Diff and ΠGDM on same datasets and tasks

### Open Question 2
- **Question**: Can compliance measure S_α,β({zt}) theoretically bound trajectory deviation from interpolation path for general interpolation scenarios beyond Rectified Flow?
- **Basis in paper**: Paper defines compliance measure with bounds for Rectified Flow, but question remains open for other interpolation paths
- **Why unresolved**: Theoretical analysis limited to specific interpolation paths (optimal transport and straight paths)
- **What evidence would resolve it**: Extending theoretical analysis to wider range of interpolation paths with corresponding compliance bounds

### Open Question 3
- **Question**: How does choice of interpolation path affect ICTM performance on linear inverse problems?
- **Basis in paper**: Uses optimal transport interpolation coefficients but doesn't explore impact of different interpolation paths
- **Why unresolved**: Paper doesn't investigate sensitivity to interpolation path choice
- **What evidence would resolve it**: Experiments with different interpolation paths and performance comparison

## Limitations
- Theoretical justification relies on trajectory exactly following interpolation path and velocity field having uniformly bounded Jacobian spectrum
- Performance heavily depends on quality of pretrained flow model with no systematic analysis of prior model mismatch effects
- Computational complexity still scales linearly with N and K, potentially limiting scalability to very high-dimensional problems

## Confidence
- **High Confidence**: Decomposition of MAP objective into local objectives is well-supported by Theorem 1 and Proposition 1 with clear mathematical derivation; experimental PSNR/SSIM improvements are directly reported and statistically significant
- **Medium Confidence**: Tweedie's formula enables efficient gradient computation without ODE solver backpropagation is theoretically justified but relies on specific interpolation structure; sequential optimization convergence is supported by empirical results but lacks extensive theoretical analysis
- **Low Confidence**: Pretrained flow model provides good prior for diverse inverse problems is not thoroughly validated; paper doesn't address domain shift between flow model training data and target inverse problem datasets

## Next Checks
1. **Robustness to Flow Model Quality**: Systematically evaluate ICTM performance across flow models trained on different datasets and varying quality levels to understand sensitivity to prior model mismatch
2. **Theoretical Convergence Analysis**: Extend theoretical analysis to provide convergence rate bounds for sequential optimization procedure and characterize conditions under which local MAP objectives provide good global MAP approximations
3. **Scalability Benchmarking**: Test ICTM on increasingly high-dimensional inverse problems (medical imaging volumes, video sequences) to empirically validate claimed computational efficiency improvements and identify practical scaling limits