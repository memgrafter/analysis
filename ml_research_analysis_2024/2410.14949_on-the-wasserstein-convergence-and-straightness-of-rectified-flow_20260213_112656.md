---
ver: rpa2
title: On the Wasserstein Convergence and Straightness of Rectified Flow
arxiv_id: '2410.14949'
source_url: https://arxiv.org/abs/2410.14949
tags:
- flow
- distribution
- straightness
- have
- also
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper provides theoretical analysis of Rectified Flow (RF),
  a generative model that learns straight flow trajectories between distributions.
  The authors establish Wasserstein convergence rates between RF sampling distributions
  and target distributions, showing these rates depend on flow straightness and discretization
  error.
---

# On the Wasserstein Convergence and Straightness of Rectified Flow

## Quick Facts
- arXiv ID: 2410.14949
- Source URL: https://arxiv.org/abs/2410.14949
- Authors: Vansh Bansal; Saptarshi Roy; Purnamrita Sarkar; Alessandro Rinaldo
- Reference count: 40
- One-line primary result: Theoretical analysis establishing Wasserstein convergence rates for Rectified Flow generative models based on flow straightness and discretization error

## Executive Summary
This paper provides a rigorous theoretical analysis of Rectified Flow (RF), a generative model that learns straight flow trajectories between distributions. The authors establish Wasserstein convergence rates between RF sampling distributions and target distributions, showing these rates depend on both the straightness of the flow and the discretization error in sampling. They prove that 1-Rectified Flow produces straight couplings under certain conditions and, in one dimension, yields the Monge map. The work also shows that 1-RF produces optimal transport plans for Gaussian-to-Gaussian and certain Gaussian mixture cases. Experiments validate that flow straightness improves with fewer discretization steps and that Wasserstein distance increases with the number of mixture components.

## Method Summary
The paper analyzes Rectified Flow (RF), a generative model that learns transport maps between distributions through a sequence of convex optimization problems. RF starts with an independent coupling between source (typically standard Gaussian) and target distributions, then iteratively estimates a drift function that minimizes kinetic energy while preserving marginal distributions. The resulting ODE flow is discretized using Euler integration for sampling. The theoretical analysis focuses on bounding the 2-Wasserstein distance between the generated distribution and target distribution in terms of the estimation error of the velocity function and a novel formulation of flow straightness.

## Key Results
- Establishes Wasserstein convergence rates for Rectified Flow that depend on both discretization error (scaling as 1/T² for straight flows) and flow straightness
- Proves that 1-Rectified Flow produces straight couplings under conditions including positive semi-definite symmetric part of the Jacobian matrix
- Shows that 1-RF yields the Monge map in one dimension and optimal transport plans for Gaussian-to-Gaussian and certain Gaussian mixture cases
- Demonstrates empirically that flow straightness improves with fewer discretization steps and that Wasserstein distance increases with the number of mixture components

## Why This Works (Mechanism)

### Mechanism 1
- **Claim**: Flow straightness reduces the number of discretization steps needed for accurate sampling.
- **Mechanism**: Straight flows follow linear trajectories between source and target distributions. When flows are straight, the Euler discretization error decreases as 1/T², where T is the number of discretization steps. Near-straight flows have small piecewise straightness parameter γ₂,T(Z), allowing fewer steps to achieve the same accuracy.
- **Core assumption**: The drift function is Lipschitz continuous and the flow trajectories become increasingly straight through rectification procedures.
- **Evidence anchors**:
  - [abstract] "Our error rate is characterized by the number of discretization steps and a novel formulation of straightness stronger than that in the original work"
  - [section 3.2] "Theorem 3.5 indicates that if the flow is a near-straight flow (i.e., γ₂,T(Z) ≈ 0), then accurate estimation of the data distribution can be achieved with a very few discretization steps"
  - [corpus] "Integration Flow Models" discusses discretization error in ODE-based generative models
- **Break condition**: If the flow develops curvature during rectification or if the drift function becomes non-Lipschitz, the 1/T² error bound no longer holds and many more discretization steps are required.

### Mechanism 2
- **Claim**: 1-Rectified Flow produces straight couplings under certain regularity conditions on the target distribution.
- **Mechanism**: The 1-RF procedure iteratively learns the drift function that minimizes transport cost. Under conditions like positive semi-definite symmetric part of the Jacobian matrix (Assumption 4.6) and non-explosivity of the ODE solution, the resulting coupling becomes straight. In one dimension, 1-RF always yields the Monge map, which is inherently straight.
- **Core assumption**: The velocity function is C¹,¹ (continuously differentiable with locally Lipschitz Jacobian) and the ODE solution exists and is unique.
- **Evidence anchors**:
  - [abstract] "we present general conditions guaranteeing uniqueness and straightness of 1-RF, which is in line with previous empirical findings"
  - [section 4.2] "Theorem 4.7(1-RF is straight). Under the conditions of Theorem 4.5 and Assumption 4.6, 1-RF yields a straight coupling"
  - [corpus] "Order-Optimal Sample Complexity of Rectified Flows" studies theoretical properties of RF
- **Break condition**: If the Jacobian matrix J₁ + J₁ᵀ has negative eigenvalues or if the ODE solution explodes, the straightness guarantee fails and the coupling may remain curved.

### Mechanism 3
- **Claim**: Wasserstein convergence rate depends on both estimation error of the velocity function and flow straightness.
- **Mechanism**: The 2-Wasserstein distance between the generated distribution and target distribution is bounded by a term involving the estimation error εᵥₗ and the straightness parameter γ₂,T(Z). When the flow is straight (γ₂,T(Z) ≈ 0), fewer discretization steps are needed to achieve a desired Wasserstein error, making the sampling process more efficient.
- **Core assumption**: The estimated drift function is Lipschitz continuous and provides accurate approximation of the true drift at discrete time points.
- **Evidence anchors**:
  - [abstract] "Our error rate is characterized by the number of discretization steps and a novel formulation of straightness stronger than that in the original work"
  - [section 3.1] "Theorem 3.2... bounds the error between the actual data distribution ρ₁ and the estimated distribution by following the exact ODE"
  - [corpus] "Convergence analysis of OT-Flow for sample generation" studies theoretical convergence of flow-based models
- **Break condition**: If the estimated drift function has large errors at discrete time points or if the flow becomes highly curved, the Wasserstein error bound increases significantly and more discretization steps are required.

## Foundational Learning

- **Concept**: Optimal Transport and Wasserstein Distance
  - **Why needed here**: The paper analyzes convergence of rectified flow using Wasserstein distance as the metric, and connects rectified flow to optimal transport problems.
  - **Quick check question**: What is the difference between the Monge and Kantorovich formulations of optimal transport, and when do they coincide?

- **Concept**: Ordinary Differential Equations and Numerical Integration
  - **Why needed here**: Rectified flow is defined through ODEs, and the paper analyzes convergence rates of Euler discretization schemes for sampling.
  - **Quick check question**: How does the Euler discretization error scale with step size for Lipschitz continuous vector fields?

- **Concept**: Probability Flow and Fokker-Planck Equation
  - **Why needed here**: The paper uses the Fokker-Planck equation to establish that the ODE flow preserves marginal distributions, which is crucial for understanding rectified flow.
  - **Quick check question**: What is the relationship between the continuity equation and the Fokker-Planck equation for probability flows?

## Architecture Onboarding

- **Component map**: Standard Gaussian -> Drift function estimation -> Rectification procedure -> ODE solver -> Target distribution approximation
- **Critical path**:
  1. Initialize independent coupling between source and target
  2. Estimate drift function by minimizing kinetic energy objective
  3. Apply rectification procedure to obtain straight flow
  4. Sample using discretized ODE solver
  5. Evaluate Wasserstein distance between generated and target distributions
- **Design tradeoffs**:
  - More iterations of rectification → straighter flow but higher computational cost
  - Fewer discretization steps → faster sampling but larger discretization error
  - Complex drift function estimation → better approximation but potential overfitting
  - Choice of target distribution complexity → affects straightness and convergence rates
- **Failure signatures**:
  - Large Wasserstein distance despite many discretization steps → flow is not straight enough
  - Numerical instability in ODE solver → drift function may not be Lipschitz
  - Slow convergence during rectification → poor initialization or difficult target distribution
  - Exploding gradients in drift function estimation → need regularization or simpler architecture
- **First 3 experiments**:
  1. **Straightness verification**: Implement the piecewise straightness parameter γ₂,T(Z) calculation and verify that it decreases with rectification iterations on a simple Gaussian mixture target
  2. **Discretization error scaling**: Plot W₂ distance vs number of discretization steps T on log-log scale for different target distributions, verifying the 1/T² scaling
  3. **Target distribution impact**: Test rectified flow on targets with increasing number of modes (1, 2, 3, 4 Gaussians) and measure how straightness and Wasserstein error scale with mode count

## Open Questions the Paper Calls Out

- **Open Question 1**: Under what general conditions on the target distribution is 1-RF guaranteed to produce a straight coupling without requiring Assumption 4.6?
  - Basis in paper: Explicit - The paper states that Assumption 4.6 is sufficient but likely not necessary, and conjectures that Ht(·) is globally invertible almost surely for standard Gaussian source and general Gaussian mixture targets.
  - Why unresolved: The authors note that while Assumption 4.6 can be verified for specific examples (like certain Gaussian mixtures), proving global invertibility of Ht(·) for general mixture distributions remains a challenging open problem.
  - What evidence would resolve it: A proof showing that the Jacobian of the map z0 ↦ (1-t)z0 + tZ1(z0) is always invertible almost surely for standard Gaussian source and any Gaussian mixture target distribution.

- **Open Question 2**: How does the Lipschitz constant bL of the estimated drift function affect the convergence rate of rectified flow, and can this dependence be improved?
  - Basis in paper: Explicit - Theorem 3.5 shows that the Wasserstein error bound includes a term e4bL/bL2 that can explode as bL → 0, suggesting the bound is not tight for small Lipschitz constants.
  - Why unresolved: The authors note that the current analysis handles the bL < 1 case separately with a less optimal bound, and improving this dependence remains an open direction.
  - What evidence would resolve it: A refined analysis that provides a tighter dependence on bL for all values, potentially showing a more favorable relationship between Lipschitz constant and convergence rate.

- **Open Question 3**: What is the generalization error of rectified flow when the true drift function is estimated from finite samples, and how does this affect the Wasserstein convergence bounds?
  - Basis in paper: Explicit - Assumption 3.1(a) requires the estimated drift function to approximate the true drift well at discrete time points, but the paper notes this is a strong assumption and mentions generalization error as a future research direction.
  - Why unresolved: The paper focuses on the approximation error of the ODE solution but does not address how well the drift function estimated from finite samples generalizes to the true underlying distribution.
  - What evidence would resolve it: Sample complexity bounds showing how many samples are needed to achieve a desired level of accuracy in the estimated drift function, and how this translates to Wasserstein error bounds.

## Limitations

- The theoretical results assume Lipschitz continuity of drift functions and specific regularity conditions on target distributions, which may not hold in practice for complex real-world data
- While the paper proves straightness for 1-RF under certain conditions, it remains unclear whether higher-order rectification procedures maintain similar guarantees
- The computational complexity of calculating straightness parameters γ₁(Z) and γ₂,T(Z) is not analyzed, potentially limiting practical applicability

## Confidence

- High confidence: The 1/T² scaling of discretization error for straight flows (Theorem 3.5) - supported by rigorous ODE analysis
- Medium confidence: The claim that 1-RF produces straight couplings for Gaussian mixtures - proven theoretically but requires validation on more complex distributions
- Medium confidence: The empirical observation that fewer mixture components lead to straighter flows - observed in experiments but theoretical explanation is incomplete

## Next Checks

1. **Cross-distribution validation**: Test RF convergence rates on non-Gaussian targets (e.g., Swiss roll, crescent moons) to verify whether straightness-based bounds hold beyond the theoretical assumptions
2. **Higher-order rectification analysis**: Implement 2-RF and 3-RF procedures and measure whether straightness and convergence rates improve compared to 1-RF
3. **Scalability assessment**: Evaluate RF performance on high-dimensional real-world datasets (CIFAR-10, ImageNet) to determine if the theoretical advantages translate to practical gains beyond synthetic and simple image data