---
ver: rpa2
title: Coarse-to-fine Dynamic Uplift Modeling for Real-time Video Recommendation
arxiv_id: '2410.16755'
source_url: https://arxiv.org/abs/2410.16755
tags:
- online
- treatment
- modeling
- user
- uplift
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: 'The paper addresses the challenge of applying uplift modeling
  to real-time video recommendation by designing treatments based on adjusting video
  duration distributions and proposing a coarse-to-fine dynamic approach. The method,
  CDUM, consists of two modules: CPM, which models long-term user preferences using
  offline features with a multi-treatment learning paradigm, and FIC, which captures
  real-time user interests using online features to dynamically adjust treatment assignments.'
---

# Coarse-to-fine Dynamic Uplift Modeling for Real-time Video Recommendation

## Quick Facts
- arXiv ID: 2410.16755
- Source URL: https://arxiv.org/abs/2410.16755
- Reference count: 37
- Key outcome: CDUM achieves significant improvements in retention metrics (0.048%/0.041% increase in Enter LT7/LT30) and is now fully deployed on Kuaishou platform serving hundreds of millions of users daily

## Executive Summary
This paper addresses the challenge of applying uplift modeling to real-time video recommendation by proposing a coarse-to-fine dynamic approach called CDUM. The method consists of two modules: CPM, which models long-term user preferences using offline features with a multi-treatment learning paradigm, and FIC, which captures real-time user interests using online features to dynamically adjust treatment assignments. The approach was evaluated on public datasets (CRITEO, LAZADA) and an industrial Kuaishou dataset, showing superior performance over baseline uplift modeling methods. Online A/B testing on the Kuaishou platform demonstrated significant improvements in key retention and consumption metrics.

## Method Summary
CDUM is a two-module uplift modeling system for real-time video recommendation. CPM uses offline daily-level features to model long-term user preferences across multiple video duration treatments, employing a multi-treatment learning paradigm with guidance and indicator embeddings. FIC captures real-time user interests using online contextual features and request-level candidates, calculating treatment-specific labels based on long/short play video ratios. The modules work together to dynamically adjust treatment assignments: CPM provides baseline preference scores while FIC refines these with real-time interest scores to make treatment enablement decisions using a threshold-based approach.

## Key Results
- CDUM outperforms baseline uplift modeling methods on public datasets (CRITEO, LAZADA) with improvements in QINI, AUUC, and LIFT@30 metrics
- Online A/B testing on Kuaishou platform shows 0.048% increase in Enter LT7 and 0.041% increase in Slide LT7 retention metrics
- The system is now fully deployed on Kuaishou platform serving hundreds of millions of users daily
- Multi-treatment learning with guidance/indicator embeddings demonstrates effectiveness through ablation studies

## Why This Works (Mechanism)

### Mechanism 1
- Claim: The coarse-to-fine paradigm effectively addresses both long-term user preference modeling and real-time interest capture in video recommendation.
- Mechanism: CPM module uses offline daily-level features to model coarse-grained long-term preferences, while FIC module uses online real-time contextual features and request-level candidates to capture fine-grained real-time interests. These two modules work together to dynamically adjust treatment assignments.
- Core assumption: Offline daily-level features can adequately represent long-term user preferences, and real-time features can effectively capture immediate user interests for dynamic adjustment.
- Evidence anchors:
  - [abstract]: "CPM, which models long-term user preferences using offline features with a multi-treatment learning paradigm, and FIC, which captures real-time user interests using online features to dynamically adjust treatment assignments."
  - [section 4.2.3]: "We define ˆrk i ∗ ˆyk i − ˆy0 i as the decision score for the k-th treatment. We then define ξ as the threshold for whether the treatment takes effect."
  - [corpus]: The corpus contains related work on uplift modeling for short video recommendations, suggesting this is a relevant application area, but specific evidence for the coarse-to-fine approach effectiveness is not directly provided in the corpus.
- Break condition: If either offline features cannot adequately capture long-term preferences or online features fail to capture real-time interests, the dynamic adjustment capability would be compromised.

### Mechanism 2
- Claim: The multi-treatment learning paradigm with guidance and indicator embeddings enhances the model's ability to generalize across different video duration treatments.
- Mechanism: The treatment embedding is refined into guidance and indicator parts. The guidance part filters and extracts information from user features, while the indicator part enhances the model's generalization across different treatments.
- Core assumption: Different treatments (video duration categories) require different feature importance weighting, and the guidance/indicator separation helps capture these differences.
- Evidence anchors:
  - [section 4.1.2]: "we further refine treatment embedding into indicator embedding and guidance embedding. We consider these two forms of embeddings as interest generalization under different effects of treatment."
  - [section 5.3]: "removing any design will cause performance degradation. This demonstrates the rationality and effectiveness of our proposed module."
  - [corpus]: The corpus shows related work on heterogeneous multi-treatment uplift modeling, supporting the relevance of this approach, but specific evidence for the guidance/indicator separation effectiveness is not directly provided in the corpus.
- Break condition: If the guidance/indicator separation doesn't provide meaningful differentiation between treatments or if the model cannot effectively learn from these separate representations.

### Mechanism 3
- Claim: Dynamic adjustment of treatment assignments based on real-time interest scores improves user experience and key retention metrics.
- Mechanism: The model calculates real-time interest scores (ˆrk i) for different video duration categories and combines them with offline preference scores (ˆyk i) to create a decision score (ˆrk i ∗ ˆyk i − ˆy0 i). Treatments are enabled when this score exceeds a threshold (ξ).
- Core assumption: The combination of real-time interest and offline preference scores can accurately identify users who will benefit from specific treatments (video duration adjustments).
- Evidence anchors:
  - [section 4.2.3]: "We define ˆrk i ∗ ˆyk i − ˆy0 i as the decision score for the k-th treatment. We then define ξ as the threshold for whether the treatment takes effect."
  - [section 6.3.1]: "our model achieves significant improvements of 0.048%/0.041% and 0.041%/0.039% with respect to Enter LT7/LT30 and Slide LT7/LT30 respectively."
  - [corpus]: The corpus contains related work on robust uplift modeling with large-scale contexts, supporting the relevance of real-time adjustment approaches, but specific evidence for the dynamic threshold-based decision making effectiveness is not directly provided in the corpus.
- Break condition: If the decision threshold (ξ) is not properly calibrated or if the real-time interest scores are not accurately capturing user preferences.

## Foundational Learning

- Concept: Uplift Modeling
  - Why needed here: The paper applies uplift modeling to video recommendation, which is different from traditional applications in online marketing. Understanding the fundamental concepts of uplift modeling (estimating individual treatment effects) is crucial to grasp the paper's approach.
  - Quick check question: What is the key difference between uplift modeling and traditional supervised learning in terms of the target variable?

- Concept: Multi-Treatment Learning
  - Why needed here: The paper designs multiple treatments based on video duration categories. Understanding how to model multiple treatments simultaneously is essential to understand the CPM module's architecture.
  - Quick check question: How does the multi-treatment learning paradigm differ from single-treatment uplift modeling in terms of model architecture and training?

- Concept: Coarse-to-Fine Modeling
  - Why needed here: The paper proposes a two-stage approach with CPM (coarse-grained) and FIC (fine-grained). Understanding the benefits and implementation of coarse-to-fine modeling is crucial to grasp the overall architecture.
  - Quick check question: What are the advantages of using a coarse-to-fine approach compared to a single-stage modeling approach in terms of capturing both long-term preferences and real-time interests?

## Architecture Onboarding

- Component map: User request → FIC inference with real-time features → CPM lookup of daily-level preference scores → Decision score calculation (ˆrk i ∗ ˆyk i − ˆy0 i) → Treatment enablement decision based on threshold (ξ) → Video duration adjustment in recommendation pipeline

- Critical path: User request → FIC inference with real-time features → CPM lookup of daily-level preference scores → Decision score calculation (ˆrk i ∗ ˆyk i − ˆy0 i) → Treatment enablement decision based on threshold (ξ) → Video duration adjustment in recommendation pipeline

- Design tradeoffs: The paper trades off between model complexity and real-time performance by using a two-stage approach. CPM can be computed offline daily, while FIC must be computed online for each request. The multi-treatment learning with guidance/indicator embeddings adds complexity but may improve generalization across treatments.

- Failure signatures: If the model shows poor performance on retention metrics (Enter LT7/LT30, Slide LT7/LT30), it could indicate issues with either the offline preference modeling or real-time interest capture. If online inference latency is too high, it could indicate issues with the FIC module complexity.

- First 3 experiments:
  1. Implement CPM module only (without FIC) and evaluate on offline datasets to verify long-term preference modeling capability
  2. Implement FIC module only (without CPM) and evaluate on online simulation to verify real-time interest capture capability
  3. Implement full CDUM system and conduct A/B test on a small percentage of users to verify the dynamic adjustment mechanism improves retention metrics

## Open Questions the Paper Calls Out

### Open Question 1
- Question: How do the performance metrics of the Coarse-to-fine Dynamic Uplift Modeling (CDUM) compare when applied to different stages of the recommendation pipeline, such as ranking or retrieval?
- Basis in paper: [inferred] The paper mentions the potential benefits of enhancing modeling at other stages of the recommendation pipeline in the conclusions section.
- Why unresolved: The paper does not provide any experimental results or comparisons of the model's performance when applied to different stages of the recommendation pipeline.
- What evidence would resolve it: Experimental results comparing the performance of CDUM when applied to different stages of the recommendation pipeline, such as ranking or retrieval, using metrics like AUUC, QINI, and LIFT@30.

### Open Question 2
- Question: What is the impact of different treatment designs on the performance of uplift modeling in video recommendation scenarios?
- Basis in paper: [explicit] The paper discusses the design and utilization of treatments as one of the main challenges in implementing uplift modeling in video recommendation scenarios.
- Why unresolved: The paper does not provide a detailed comparison of different treatment designs and their impact on the performance of uplift modeling in video recommendation scenarios.
- What evidence would resolve it: A comparative analysis of different treatment designs and their impact on the performance of uplift modeling in video recommendation scenarios, using metrics like AUUC, QINI, and LIFT@30.

### Open Question 3
- Question: How does the Coarse-to-fine Dynamic Uplift Modeling (CDUM) handle the trade-off between different response types, such as watch time, app usage duration, and video view count?
- Basis in paper: [explicit] The paper mentions that user responses are diverse and complex, and often constrain each other, which makes it challenging to effectively align and associate treatments with responses.
- Why unresolved: The paper does not provide a detailed explanation of how CDUM handles the trade-off between different response types.
- What evidence would resolve it: A detailed explanation of how CDUM handles the trade-off between different response types, along with experimental results demonstrating its effectiveness in balancing these trade-offs.

## Limitations
- The effectiveness of the coarse-to-fine paradigm relies heavily on assumptions about offline feature adequacy and real-time feature capture quality that require further validation
- The guidance/indicator embedding separation lacks empirical comparison with alternative multi-treatment architectures to establish definitive superiority
- Online A/B testing results are limited to one platform (Kuaishou) and may not generalize to other video recommendation systems with different user behaviors

## Confidence
- Mechanism 1 (coarse-to-fine approach): Medium - The concept is well-motivated but lacks direct empirical validation of the two-stage architecture's effectiveness
- Mechanism 2 (guidance/indicator embeddings): Low - The theoretical justification exists but lacks ablation studies comparing against alternative multi-treatment architectures
- Mechanism 3 (dynamic adjustment effectiveness): Medium - Online results show improvements but are limited to one platform and specific metrics

## Next Checks
1. Conduct ablation studies comparing CDUM against single-stage uplift modeling approaches and against CPM-only or FIC-only implementations to isolate the contribution of each component
2. Perform cross-platform validation by implementing the approach on a different video recommendation system to test generalizability of the online performance improvements
3. Design experiments to test the robustness of the dynamic threshold (ξ) calibration across different user segments and time periods to ensure consistent treatment assignment quality