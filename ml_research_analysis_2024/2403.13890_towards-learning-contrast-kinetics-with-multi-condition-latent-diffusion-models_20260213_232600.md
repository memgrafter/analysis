---
ver: rpa2
title: Towards Learning Contrast Kinetics with Multi-Condition Latent Diffusion Models
arxiv_id: '2403.13890'
source_url: https://arxiv.org/abs/2403.13890
tags:
- contrast
- image
- real
- diffusion
- imaging
- transformers
- self-attention
- retrieval-augmented-generation
- instruction-tuning
- parameter-efficient-finetuning
- mixture-of-experts
- chain-of-thought
core_contribution: This paper introduces ContrastControlNet (CC-Net), a multi-conditional
  latent diffusion model for synthesizing dynamic contrast-enhanced (DCE) MRI sequences
  from pre-contrast images. The method leverages text conditioning, acquisition time,
  and pre-contrast image guidance via ControlNet to generate realistic post-contrast
  breast MRI with simulated lesion contrast kinetics.
---

# Towards Learning Contrast Kinetics with Multi-Condition Latent Diffusion Models

## Quick Facts
- arXiv ID: 2403.13890
- Source URL: https://arxiv.org/abs/2403.13890
- Authors: Richard Osuala; Daniel M. Lang; Preeti Verma; Smriti Joshi; Apostolia Tsirikoglou; Grzegorz Skorupko; Kaisar Kushibar; Lidia Garrucho; Walter H. L. Pinaya; Oliver Diaz; Julia A. Schnabel; Karim Lekadir
- Reference count: 26
- Primary result: Multi-conditional latent diffusion model generates realistic DCE-MRI with simulated lesion contrast kinetics, achieving FRD of 22.50 in phase 1

## Executive Summary
This paper introduces ContrastControlNet (CC-Net), a multi-conditional latent diffusion model for synthesizing dynamic contrast-enhanced (DCE) MRI sequences from pre-contrast images. The method leverages text conditioning, acquisition time, and pre-contrast image guidance via ControlNet to generate realistic post-contrast breast MRI with simulated lesion contrast kinetics. The authors also propose the Frchet radiomics distance (FRD), a radiology-specific metric based on biomarker variability between real and synthetic images. Results show that CC-Net significantly outperforms pre-contrast baselines in terms of FRD, FID, LPIPS, and MSE across multiple DCE phases, with FRD achieving values as low as 22.50 in phase 1. The study demonstrates the potential of deep learning to reduce reliance on gadolinium-based contrast agents in MRI.

## Method Summary
The method involves a multi-stage training process using the Duke-Breast-Cancer-MRI Dataset. First, a 2D convolutional autoencoder is trained to reduce dimensionality. Then, a denoising U-Net for latent diffusion models (LDM) is trained with text conditioning via cross-attention and acquisition time conditioning. ControlNet is trained subsequently to condition on pre-contrast images while preserving the pretrained LDM. The final model generates post-contrast images from random latents conditioned on pre-contrast images, text metadata, and acquisition time. Evaluation uses the proposed FRD metric along with FID, LPIPS, and MSE.

## Key Results
- CC-Net achieves FRD scores as low as 22.50 in phase 1, significantly outperforming pre-contrast baselines
- The model successfully simulates lesion contrast enhancement patterns across multiple DCE phases
- Text conditioning and ControlNet integration contribute to realistic image generation consistent with acquisition protocols

## Why This Works (Mechanism)

### Mechanism 1
The multi-conditional latent diffusion model can learn the complex relationship between pre-contrast images and time-dependent contrast kinetics. The model conditions on pre-contrast images via ControlNet and on acquisition time as a continuous variable. The denoising U-Net learns to iteratively remove noise while preserving anatomical structure and simulating lesion contrast enhancement patterns. Core assumption: The spatial and temporal patterns of contrast enhancement are learnable from the paired pre- and post-contrast images in the training data.

### Mechanism 2
The Fréchet radiomics distance (FRD) provides a domain-specific evaluation metric that captures clinically relevant differences between synthetic and real images. FRD extracts a standardized set of radiomics features from real and synthetic images, normalizes them, and computes the Fréchet distance between the resulting feature distributions. This captures biomarker variability that reflects clinical utility. Core assumption: Radiomics features extracted from synthetic images will have similar distributional properties to those from real images if the synthetic images are clinically realistic.

### Mechanism 3
Conditioning on textual metadata via cross-attention improves the model's ability to generate images consistent with specific acquisition protocols. Clinical metadata (manufacturer, scanner, field strength, contrast agent, bolus volume) is parsed into text prompts and incorporated through the denoising U-Net's cross-attention mechanism, allowing the model to capture protocol-specific image characteristics. Core assumption: The textual metadata contains sufficient information to influence the image generation process in meaningful ways.

## Foundational Learning

- **Concept**: Diffusion models and latent diffusion models
  - Why needed here: The paper uses a latent diffusion model as the core generative architecture, so understanding the forward diffusion and reverse denoising processes is essential
  - Quick check question: What are the two main processes in a diffusion model and what do they do?

- **Concept**: ControlNet architecture
  - Why needed here: ControlNet is used to condition the model on pre-contrast images while preserving the pretrained LDM, so understanding how the encoder outputs are integrated through zero-convolutional layers is important
  - Quick check question: How does ControlNet integrate conditioning information into a pretrained diffusion model?

- **Concept**: Radiomics feature extraction
  - Why needed here: The FRD metric relies on extracting and comparing radiomics features, so understanding what these features represent and how they're computed is necessary
  - Quick check question: What types of radiomics features are commonly used in medical imaging and what do they capture?

## Architecture Onboarding

- **Component map**: Autoencoder -> Denoising U-Net (LDM) -> ControlNet -> Text embedding layers -> Time embedding layers. The FRD metric uses a radiomics feature extractor.

- **Critical path**: During training, the denoising U-Net and ControlNet are trained consecutively on paired pre- and post-contrast images with conditioning information. During inference, the ControlNet is discarded, and the model generates post-contrast images from random latents conditioned on pre-contrast images, text, and time.

- **Design tradeoffs**: Using a pretrained LDM (fine-tuning vs training from scratch) versus a smaller, custom architecture; using ControlNet versus integrating pre-contrast conditioning directly into the U-Net; using FRD versus traditional metrics like FID.

- **Failure signatures**: Poor contrast enhancement patterns (suggesting the model didn't learn the kinetics well); unrealistic anatomical details (suggesting the ControlNet didn't properly preserve structure); low FRD but high FID (suggesting radiomics features don't align with perceptual quality).

- **First 3 experiments**:
  1. Train the denoising U-Net with ControlNet on a small subset of data, varying the ControlNet guidance weight to observe its effect on image quality
  2. Compare FRD, FID, LPIPS, and MSE metrics on the validation set to understand which best correlates with visual quality
  3. Generate images for different time points and visualize the contrast enhancement patterns to verify they follow expected kinetics

## Open Questions the Paper Calls Out

### Open Question 1
How can multi-conditional latent diffusion models be extended to generate joint images of multiple DCE-MRI timepoints? The authors state "In future investigations, we aim to generate images of multiple DCE-MRI timepoints jointly" in the Discussion section. This remains unresolved as the current model only generates single timepoints. A follow-up study demonstrating the generation of multiple DCE-MRI timepoints using a modified version of the CC-Net model, with quantitative evaluation of the quality and consistency of the generated sequences, would resolve this.

### Open Question 2
How can the mapping from 3D autoencoders to 2D-trained latent diffusion models be optimized for better DCE-MRI synthesis? The authors mention "to map from the latent space of 3D autoencoders to the one from 2D-trained latent diffusion models" as a future investigation. The current model uses 2D autoencoders, and the potential benefits and challenges of using 3D autoencoders are not yet explored. A comparative study evaluating the performance of DCE-MRI synthesis using both 2D and 3D autoencoders would resolve this.

### Open Question 3
How does the choice of radiomics features impact the performance of the Fr´ echet radiomics distance (FRD) as a quality metric for synthetic DCE-MRI images? The authors note that "FRD feature inclusion choice is flexible" but do not explore the impact of different feature sets on the FRD metric. The sensitivity of the FRD metric to the choice of features is not yet investigated. A sensitivity analysis of the FRD metric to different sets of radiomics features would resolve this.

## Limitations

- Model generalization to other DCE-MRI datasets or different imaging protocols remains uncertain
- Clinical relevance of the FRD metric requires further validation
- Reliance on pre-contrast images may limit applicability in clinical scenarios where pre-contrast imaging is not available
- Ethical considerations around generating synthetic medical images are not addressed

## Confidence

**High Confidence**:
- The multi-conditional latent diffusion model architecture is sound and well-implemented
- The proposed FRD metric provides a novel approach to evaluating synthetic medical image quality

**Medium Confidence**:
- The model's ability to accurately simulate contrast kinetics and generate clinically realistic post-contrast images
- The relative performance improvements compared to baseline methods

**Low Confidence**:
- The model's generalization to unseen data and different imaging protocols
- The clinical utility and diagnostic relevance of the synthetic images generated by CC-Net

## Next Checks

1. **Cross-Dataset Validation**: Evaluate CC-Net's performance on a separate, independent DCE-MRI dataset to assess its generalization capabilities and robustness to different imaging protocols.

2. **Radiologist Study**: Conduct a reader study with experienced radiologists to compare the diagnostic quality of synthetic and real post-contrast images, establishing the clinical relevance of the generated images and the FRD metric.

3. **Ablation Study on Conditioning Factors**: Perform a systematic ablation study to quantify the contribution of each conditioning factor (pre-contrast image, text metadata, acquisition time) to the final image quality, helping to identify the most critical components of the model.